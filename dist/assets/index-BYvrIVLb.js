import{r,j as e,c as ds}from"./react-core-Jg-jSC1t.js";import{c as xs}from"./supabase-CLUUFHN5.js";import{t as N,C as ms,W as us,T as hs}from"./vendor-BzdtLw9u.js";import{E as pe,a as Pe,T as Fe,A as De,b as Ue,R as ve,S as Se,Z as Y,W as te,C as re,P as Ne,c as Re,d as je,e as Ce,L as ee,f as ye,I as be,g as ie,h as ps,i as bs,D as es,j as le,k as se,l as de,m as gs,U as Be,n as ss,X as ge,H as js,o as fs,B as Ie,p as ys,F as ts,q as as,r as fe,s as Ns,M as Le,t as he,u as rs,v as qe,w as vs,x as we,y as ws,z as _s,G as Me,J as Oe,K as Ee,N as Ss,O as _e,Q as Cs,V as $e,Y as ks,_ as Is,$ as Es,a0 as As,a1 as Ts,a2 as Ve,a3 as Ds,a4 as Ke,a5 as He,a6 as Us,a7 as Ls,a8 as $s}from"./lucide-icons-CyfKB-9r.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))b(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const y of h.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&b(y)}).observe(document,{childList:!0,subtree:!0});function i(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function b(o){if(o.ep)return;o.ep=!0;const h=i(o);fetch(o.href,h)}})();const Ps="https://mzoeeqmtvlnyonicycvg.supabase.co",Fs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16b2VlcW10dmxueW9uaWN5Y3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MjIyNzcsImV4cCI6MjA3ODQ5ODI3N30.oo7FsWjthtBtM-Xa1VFJieMGQ4mG__V8w7r9qGBPzaI",p=xs(Ps,Fs),ls=r.createContext(void 0);function Rs({children:t}){const[s,i]=r.useState(null),[b,o]=r.useState(!0);r.useEffect(()=>{const v=localStorage.getItem("user");if(v)try{i(JSON.parse(v))}catch(k){console.error("Error parsing saved user:",k),localStorage.removeItem("user")}o(!1)},[]);const h=async(v,k)=>{const l=window.location.pathname.startsWith("/admin"),{data:m,error:g}=await p.from("users").select("*").eq("email",v).maybeSingle();if(g)throw console.error("Login error:",g),new Error("로그인 중 오류가 발생했습니다");if(!m)throw new Error("등록되지 않은 이메일입니다");if(m.password_hash!==k)throw new Error("비밀번호가 올바르지 않습니다");const j={id:m.user_id,email:m.email,username:m.username,role:m.role||"user"};if(l&&j.role!=="admin")throw new Error("관리자 권한이 필요합니다");return i(j),localStorage.setItem("user",JSON.stringify(j)),await p.from("users").update({last_login:new Date().toISOString()}).eq("user_id",m.user_id),console.log("Login successful:",j),j},y=()=>{i(null),localStorage.removeItem("user")};return e.jsx(ls.Provider,{value:{user:s,login:h,logout:y,isLoading:b},children:t})}function K(){const t=r.useContext(ls);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}function Bs({wallets:t,transactions:s,onNavigate:i,onSelectCoin:b}){const{user:o}=K(),[h,y]=r.useState(!0),[v,k]=r.useState(0),[f,l]=r.useState(0),[m,g]=r.useState({}),[j,d]=r.useState(!1);r.useEffect(()=>{(async()=>{if(!o?.id)return;const{data:n}=await p.from("users").select("account_verification_status").eq("user_id",o.id).single();n&&d(n.account_verification_status==="verified")})()},[o]),r.useEffect(()=>{const x=async()=>{const{data:_}=await p.from("supported_tokens").select("symbol, price_usd");if(_){const I={};_.forEach(a=>{I[a.symbol]=(a.price_usd||0)*1350}),g(I)}};x();const n=setInterval(x,3e4);return()=>clearInterval(n)},[]),r.useEffect(()=>{const x=p.channel("wallet-changes").on("postgres_changes",{event:"*",schema:"public",table:"wallets",filter:`user_id=eq.${o?.id}`},()=>{window.location.reload()}).subscribe();return()=>{p.removeChannel(x)}},[o]),r.useEffect(()=>{const x=t.reduce((n,_)=>{const I=m[_.coin_type]||0;return n+_.balance*I},0);k(x),l(Math.random()*10-5)},[t,m]);const C=s.slice(0,3);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 rounded-2xl opacity-30 group-hover:opacity-40 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 to-slate-900 border border-cyan-500/30 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"총 자산"}),e.jsx("button",{onClick:()=>y(!h),className:"text-slate-400 hover:text-cyan-400 transition-colors",children:h?e.jsx(pe,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]}),h?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-white text-3xl mb-2",children:["₩",v.toLocaleString()]}),e.jsxs("div",{className:`flex items-center gap-1 text-sm ${f>=0?"text-green-400":"text-red-400"}`,children:[e.jsx(Fe,{className:`w-4 h-4 ${f<0?"rotate-180":""}`}),e.jsxs("span",{children:[f>=0?"+":"",f.toFixed(2),"%"]}),e.jsx("span",{className:"text-slate-500",children:"오늘"})]})]}):e.jsx("div",{className:"text-white text-3xl mb-2",children:"••••••••"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-6",children:[e.jsxs("button",{onClick:()=>i("deposit"),className:"relative group overflow-hidden rounded-2xl transition-all active:scale-98",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-500 to-blue-600 opacity-100"}),e.jsxs("div",{className:"relative px-6 py-5 flex flex-col items-center justify-center gap-2",children:[e.jsx(De,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white",children:"입금하기"})]})]}),e.jsxs("button",{onClick:()=>i("withdrawal"),className:"relative group overflow-hidden rounded-2xl transition-all active:scale-98",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600 opacity-100"}),e.jsxs("div",{className:"relative px-6 py-5 flex flex-col items-center justify-center gap-2",children:[e.jsx(Ue,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white",children:"출금하기"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3 mt-3",children:e.jsxs("button",{onClick:()=>i("swap"),className:"flex items-center justify-center gap-2 p-3 rounded-xl bg-cyan-500/10 border border-cyan-500/30 hover:bg-cyan-500/20 transition-all active:scale-95",children:[e.jsx(ve,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-cyan-400",children:"스왑"})]})})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white",children:"내 코인"}),e.jsx("button",{onClick:()=>i("wallets"),className:"text-cyan-400 text-sm hover:text-cyan-300 transition-colors",children:"전체보기"})]}),e.jsx("button",{onClick:()=>{i(j?"coin-purchase":"settings")},className:`w-full mb-3 p-4 rounded-xl transition-all active:scale-98 group ${j?"bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border-2 border-cyan-500/30 hover:border-cyan-500/50":"bg-gradient-to-r from-slate-700/10 to-slate-800/10 border-2 border-slate-600/30 hover:border-slate-600/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform ${j?"bg-gradient-to-br from-cyan-500 to-purple-500":"bg-gradient-to-br from-slate-600 to-slate-700"}`,children:e.jsx(Se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("p",{className:j?"text-white":"text-slate-400",children:["코인 구매 요청",!j&&" (인증 필요)"]}),e.jsx("p",{className:`text-sm ${j?"text-cyan-400":"text-slate-500"}`,children:j?"관리자 승인 후 즉시 입금":"1원 인증을 먼저 완료해주세요"})]})]}),e.jsx("div",{className:j?"text-cyan-400":"text-slate-500",children:"→"})]})}),e.jsx("div",{className:"space-y-3",children:t.length===0?e.jsx("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700/50 rounded-xl",children:e.jsx("p",{className:"text-slate-400",children:"지갑이 없습니다"})}):t.slice(0,5).map(x=>e.jsx("button",{onClick:()=>{b(x.coin_type),i("wallet-detail")},className:"w-full bg-slate-800/50 border border-slate-700/50 hover:border-cyan-500/50 rounded-xl p-4 transition-all active:scale-98",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-700 border-2 border-cyan-500/50 flex items-center justify-center",style:{boxShadow:"0 0 10px rgba(6, 182, 212, 0.3)"},children:e.jsx("span",{className:"text-cyan-400",children:x.coin_type})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-white",children:x.coin_type}),e.jsxs("p",{className:"text-slate-400 text-sm",children:[x.balance.toFixed(8)," ",x.coin_type]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white",children:["₩",(x.balance*(m[x.coin_type]||0)).toLocaleString()]}),e.jsx("p",{className:"text-green-400 text-sm",children:"+2.5%"})]})]})},x.wallet_id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white",children:"최근 거래"}),e.jsx("button",{onClick:()=>i("transactions"),className:"text-cyan-400 text-sm hover:text-cyan-300 transition-colors",children:"전체보기"})]}),e.jsx("div",{className:"space-y-3",children:C.length===0?e.jsx("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700/50 rounded-xl",children:e.jsx("p",{className:"text-slate-400",children:"거래 내역이 없습니다"})}):C.map(x=>e.jsx("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${x.type==="deposit"?"bg-green-500/20 text-green-400":"bg-purple-500/20 text-purple-400"}`,children:x.type==="deposit"?e.jsx(De,{className:"w-5 h-5"}):e.jsx(Ue,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:x.type==="deposit"?"입금":"출금"}),e.jsx("p",{className:"text-slate-400 text-xs",children:x.coin_type})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white",children:[x.type==="deposit"?"+":"-",x.amount," ",x.coin_type]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${x.status==="confirmed"?"bg-green-500/20 text-green-400":x.status==="pending"?"bg-amber-500/20 text-amber-400":"bg-cyan-500/20 text-cyan-400"}`,children:x.status==="confirmed"?"완료":x.status==="pending"?"대기":"처리중"})]})]})},x.id))})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl opacity-30 blur"}),e.jsx("div",{className:"relative bg-gradient-to-r from-purple-900/50 to-pink-900/50 border border-purple-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(Y,{className:"w-6 h-6 text-purple-400 animate-pulse"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm mb-1",children:"스마트 거래 사용중"}),e.jsx("p",{className:"text-purple-300 text-xs",children:"빠르고 안전한 거래를 경험하세요"})]})]})})]})]})}let ns={};const cs=t=>ns[t]||0,We=async()=>{const{data:t}=await p.from("supported_tokens").select("symbol, price_usd");t&&t.forEach(s=>{ns[s.symbol]=(s.price_usd||0)*1350})};function qs({wallets:t,onNavigate:s,onSelectCoin:i}){const[b,o]=r.useState(!0),[h,y]=r.useState(0),[v,k]=r.useState({});return r.useEffect(()=>{We().then(()=>{const f={};t.forEach(l=>{f[l.coin_type]=cs(l.coin_type)}),k(f)})},[t]),r.useEffect(()=>{const f=t.reduce((l,m)=>{const g=v[m.coin_type]||0;return l+m.balance*g},0);y(f)},[t,v]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 rounded-2xl opacity-30 group-hover:opacity-40 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-800 to-slate-900 border border-cyan-500/30 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"총 자산 평가액"}),e.jsx("button",{onClick:()=>o(!b),className:"text-slate-400 hover:text-cyan-400 transition-colors",children:b?e.jsx(pe,{className:"w-5 h-5"}):e.jsx(Pe,{className:"w-5 h-5"})})]}),b?e.jsxs("div",{className:"text-white text-3xl mb-2",children:["₩",h.toLocaleString()]}):e.jsx("div",{className:"text-white text-3xl mb-2",children:"••••••••"}),e.jsxs("div",{className:"text-slate-400 text-sm",children:[t.length,"개 지갑"]})]})]}),t.length===0&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500/20 to-purple-500/20 rounded-2xl blur"}),e.jsx("div",{className:"relative bg-slate-800/50 border-2 border-dashed border-cyan-500/30 rounded-2xl p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-slate-700/50 border-2 border-cyan-500/30 flex items-center justify-center mx-auto mb-6",children:e.jsx(te,{className:"w-10 h-10 text-cyan-400/50"})}),e.jsx("h3",{className:"text-white mb-2",children:"아직 지갑이 없습니다"}),e.jsx("p",{className:"text-slate-400 text-sm mb-6",children:"관리자에게 요청하여 지갑을 생성하세요"}),e.jsxs("div",{className:"bg-slate-900/50 border border-cyan-500/20 rounded-xl p-4 text-left",children:[e.jsx("h4",{className:"text-cyan-400 mb-3 text-sm",children:"지갑 생성 방법"}),e.jsxs("ul",{className:"space-y-2 text-slate-300 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"1."}),e.jsx("span",{children:"관리자에게 지갑 생성을 요청합니다"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"2."}),e.jsx("span",{children:"승인 후 지갑이 자동으로 생성됩니다"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"3."}),e.jsx("span",{children:"생성된 지갑으로 입금/출금이 가능합니다"})]})]})]}),e.jsx("button",{onClick:()=>s("home"),className:"mt-6 w-full bg-gradient-to-r from-cyan-500 to-purple-500 text-white py-3 rounded-xl hover:shadow-lg hover:shadow-cyan-500/50 transition-all",children:"홈으로 돌아가기"})]})})]}),t.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white",children:"내 지갑 목록"}),e.jsxs("span",{className:"text-slate-400 text-sm",children:[t.length,"개"]})]}),e.jsx("div",{className:"space-y-3",children:t.map(f=>{const l=v[f.coin_type]||0,m=f.balance*l;return e.jsx("button",{onClick:()=>{i(f.coin_type),s("wallet-detail")},className:"w-full group",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500/0 to-purple-500/0 group-hover:from-cyan-500/30 group-hover:to-purple-500/30 rounded-xl blur transition-all"}),e.jsxs("div",{className:"relative bg-slate-800/50 border border-slate-700/50 group-hover:border-cyan-500/50 rounded-xl p-4 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-700 border-2 border-cyan-500/30 group-hover:border-cyan-500 flex items-center justify-center transition-all",style:{boxShadow:"0 0 15px rgba(6, 182, 212, 0.3)"},children:e.jsx("span",{className:"text-cyan-400 group-hover:text-cyan-300",style:{filter:"drop-shadow(0 0 3px rgba(6, 182, 212, 0.8))"},children:f.coin_type})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"text-white mb-1",children:[b?f.balance.toString():"••••••"," ",f.coin_type]}),e.jsx("div",{className:"text-slate-400 text-sm",children:b?`≈ ₩${m.toLocaleString()}`:"••••••"})]})]}),e.jsx(re,{className:"w-5 h-5 text-slate-500 group-hover:text-cyan-400 transition-colors"})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-md text-xs ${f.status==="active"?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}`,children:f.status==="active"?"활성":"비활성"}),e.jsxs("span",{className:"text-xs text-slate-500 truncate",children:[f.address.slice(0,6),"...",f.address.slice(-4)]})]})]})]})},f.wallet_id)})})]}),t.length>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>s("deposit"),className:"relative overflow-hidden rounded-2xl transition-all active:scale-98",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-500 to-blue-600"}),e.jsxs("div",{className:"relative px-6 py-4 flex flex-col items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white",children:"입금하기"})]})]}),e.jsxs("button",{onClick:()=>s("withdrawal"),className:"relative overflow-hidden rounded-2xl transition-all active:scale-98",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600"}),e.jsxs("div",{className:"relative px-6 py-4 flex flex-col items-center justify-center gap-2",children:[e.jsx(Fe,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white",children:"출금하기"})]})]})]})]})}function Ms({wallets:t,transactions:s,selectedCoin:i,onNavigate:b}){const o=t.find(f=>f.coin_type===i),[h,y]=r.useState(0);if(r.useEffect(()=>{We().then(()=>{o&&y(cs(o.coin_type))})},[o]),!o)return e.jsx("div",{className:"text-slate-400 text-center p-8",children:"지갑을 찾을 수 없습니다"});const v=parseFloat(o.balance.toString())*h,k=async f=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(f),N.success("주소가 복사되었습니다");else{const l=document.createElement("textarea");l.value=f,l.style.position="fixed",l.style.opacity="0",document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),N.success("주소가 복사되었습니다")}}catch(l){N.error("자동 복사가 지원되지 않습니다. 주소를 직접 복사해주세요."),console.error("Copy failed:",l)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>b("wallets"),className:"flex items-center gap-2 text-cyan-400 hover:text-cyan-300",children:[e.jsx(re,{className:"w-4 h-4 rotate-180"}),e.jsx("span",{children:"뒤로"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-slate-800 border-2 border-cyan-500 flex items-center justify-center mx-auto mb-4",style:{boxShadow:"0 0 20px rgba(6, 182, 212, 0.6), inset 0 0 20px rgba(6, 182, 212, 0.2)"},children:e.jsx("span",{className:"text-cyan-400 text-2xl",style:{filter:"drop-shadow(0 0 5px rgba(6, 182, 212, 1))"},children:o.coin_type})}),e.jsxs("div",{className:"text-3xl text-white mb-2",children:[o.balance.toString()," ",o.coin_type]}),e.jsxs("div",{className:"text-slate-400",children:["≈ ₩",v.toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>b("deposit"),className:"relative overflow-hidden rounded-2xl transition-all active:scale-98",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-500 to-blue-600"}),e.jsxs("div",{className:"relative px-6 py-4 flex flex-col items-center justify-center gap-2",children:[e.jsx(De,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white",children:"입금하기"})]})]}),e.jsxs("button",{onClick:()=>b("withdrawal"),className:"relative overflow-hidden rounded-2xl transition-all active:scale-98",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600"}),e.jsxs("div",{className:"relative px-6 py-4 flex flex-col items-center justify-center gap-2",children:[e.jsx(Ue,{className:"w-6 h-6 text-white"}),e.jsx("span",{className:"text-white",children:"출금하기"})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-cyan-500/20 rounded-xl p-4",children:[e.jsx("div",{className:"text-slate-300 mb-3",children:"내 지갑 주소"}),e.jsx("div",{className:"bg-slate-900/50 rounded-lg p-4 mb-3 flex justify-center",children:e.jsx("div",{className:"p-3 bg-white rounded-xl",children:e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=128x128&data=${encodeURIComponent(o.address)}`,alt:"QR Code",className:"w-32 h-32"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-slate-900/50 rounded-lg p-3 text-slate-300 text-sm truncate",children:o.address}),e.jsx("button",{onClick:()=>k(o.address),className:"bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/50 text-cyan-400 px-4 py-3 rounded-lg transition-all",children:e.jsx(Re,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-slate-300 mb-3",children:"최근 거래"}),e.jsx("div",{className:"space-y-2",children:s.filter(f=>f.coin_type===i).slice(0,5).map(f=>e.jsx("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-white",children:[f.type==="deposit"?"입금":"출금"," ",f.status==="confirmed"||f.status==="completed"?"완료":"대기"]}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(f.created_at).toLocaleString()})]}),e.jsxs("div",{className:f.type==="deposit"?"text-green-400":"text-red-400",children:[f.type==="deposit"?"+":"-",f.amount]})]})},f.id))})]})]})}function Os({wallets:t,selectedCoin:s,onNavigate:i,onSelectCoin:b}){const{user:o}=K(),[h,y]=r.useState(!1),[v,k]=r.useState([]),[f,l]=r.useState(!1),[m,g]=r.useState([]);r.useEffect(()=>{(async()=>{const{data:_,error:I}=await p.from("supported_tokens").select("symbol").eq("is_active",!0).order("symbol");if(_&&!I){const a=t.map(S=>S.coin_type),w=_.map(S=>S.symbol).filter(S=>a.includes(S));g(w)}})()},[t]);const j=t.find(n=>n.coin_type===s);r.useEffect(()=>{l(!0);const n=async()=>{const{data:I}=await p.from("deposits").select("*").eq("user_id",o?.id).eq("coin_type",s).order("created_at",{ascending:!1}).limit(5);I&&k(I)};n();const _=p.channel("deposit-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"deposits",filter:`user_id=eq.${o?.id}`},I=>{N.success("새로운 입금이 감지되었습니다!"),n()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"deposits",filter:`user_id=eq.${o?.id}`},I=>{I.new.status==="confirmed"&&N.success("입금이 확인되었습니다!"),n()}).subscribe();return()=>{l(!1),p.removeChannel(_)}},[o,s]);const d=async()=>{if(j?.address)try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(j.address),y(!0),N.success("주소가 복사되었습니다"),setTimeout(()=>y(!1),2e3);else{const n=document.createElement("textarea");n.value=j.address,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),y(!0),N.success("주소가 복사되었습니다"),setTimeout(()=>y(!1),2e3)}}catch(n){N.error("자동 복사가 지원되지 않습니다. 주소를 직접 복사해주세요."),console.error("Copy failed:",n)}},C=n=>({BTC:"Bitcoin Network",ETH:"Ethereum (ERC-20)",USDT:"Ethereum (ERC-20)",USDC:"Ethereum (ERC-20)",BNB:"BNB Smart Chain",KRWQ:"KRWQ Network"})[n]||"Unknown",x=n=>({BTC:"0.0001",ETH:"0.01",USDT:"10",USDC:"10",BNB:"0.01",KRWQ:"1000"})[n]||"0";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>i("home"),className:"w-10 h-10 rounded-full bg-slate-800 border border-cyan-500/30 flex items-center justify-center hover:border-cyan-500/50 transition-all active:scale-95",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white text-xl",children:"입금"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"코인을 입금하세요"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"코인 선택"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:m.map(n=>e.jsx("button",{onClick:()=>b(n),className:`p-3 rounded-xl border-2 transition-all active:scale-95 ${s===n?"border-cyan-500 bg-cyan-500/10":"border-slate-700 bg-slate-800/50 hover:border-slate-600"}`,children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:`text-sm ${s===n?"text-cyan-400":"text-slate-400"}`,children:n})})},n))})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-amber-400 text-sm mb-1",children:"네트워크 확인"}),e.jsxs("p",{className:"text-amber-300 text-xs",children:[C(s)," 네트워크만 지원합니다. 다른 네트워크로 전송시 자산을 잃을 수 있습니다."]})]})]})}),j?e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-2xl opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-800 border border-cyan-500/30 rounded-2xl p-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("div",{className:"p-4 bg-white rounded-2xl",children:j?.address?e.jsx("img",{src:`https://api.qrserver.com/v1/create-qr-code/?size=192x192&data=${encodeURIComponent(j.address)}`,alt:"QR Code",className:"w-48 h-48"}):e.jsx("div",{className:"w-48 h-48 flex items-center justify-center",children:e.jsx(ee,{className:"w-8 h-8 text-cyan-400 animate-spin"})})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"입금 주소"}),e.jsx("div",{className:"flex items-center gap-2",children:f&&e.jsxs("div",{className:"flex items-center gap-1 text-green-400 text-xs",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),"실시간 감지중"]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-lg p-4 pr-12 break-all text-cyan-400 text-sm",children:j.address}),e.jsx("button",{onClick:d,className:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center hover:bg-cyan-500/30 transition-all active:scale-95",children:h?e.jsx(ye,{className:"w-5 h-5 text-green-400"}):e.jsx(Re,{className:"w-5 h-5 text-cyan-400"})})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-slate-900/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"최소 입금액"}),e.jsxs("span",{className:"text-white",children:[x(s)," ",s]})]})})]})]}):e.jsx("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700/50 rounded-xl",children:e.jsx("p",{className:"text-slate-400",children:"선택한 코인의 지갑이 없습니다"})}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-4",children:[e.jsx("h3",{className:"text-white text-sm mb-3",children:"입금 안내"}),e.jsxs("div",{className:"space-y-2 text-xs text-slate-400",children:[e.jsxs("p",{children:["• 위 주소로만 ",s,"을 전송하세요"]}),e.jsx("p",{children:"• 최소 입금액 미만은 입금되지 않습니다"}),e.jsxs("p",{children:["• 네트워크 확인 후 ",C(s),"로만 전송하세요"]}),e.jsx("p",{children:"• 입금은 실시간으로 자동 감지됩니다"}),e.jsx("p",{children:"• 블록체인 확인 후 자동으로 지갑에 반영됩니다"})]})]}),v.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white mb-3",children:"최근 입금 내역"}),e.jsx("div",{className:"space-y-2",children:v.map(n=>e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-white",children:["+",n.amount," ",n.coin_type]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${n.status==="confirmed"?"bg-green-500/20 text-green-400":n.status==="pending"?"bg-amber-500/20 text-amber-400":"bg-cyan-500/20 text-cyan-400"}`,children:n.status==="confirmed"?"확인 완료":n.status==="pending"?"확인 중":"처리 중"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[e.jsx("span",{children:new Date(n.created_at).toLocaleString("ko-KR")}),n.tx_hash&&e.jsx("span",{className:"truncate max-w-[120px]",children:n.tx_hash})]})]},n.deposit_id))})]})]})}async function Ws(t){try{const{data:s,error:i}=await p.from("users").select("level").eq("user_id",t).single();if(i||!s)return console.error("User fetch error:",i),{sponsor:!1,token:"USDC"};const b=s.level||"Basic",{data:o,error:h}=await p.from("gas_sponsorship_policies").select("*").eq("user_level",b).eq("is_active",!0).single();if(h||!o)return console.error("Policy fetch error:",h),{sponsor:!1,token:"USDC"};switch(o.sponsor_mode){case"operator":return{sponsor:!0};case"partial":return{sponsor:!0,token:o.gas_token,maxUserPayment:o.max_user_payment?.toString()||"1"};case"user":default:return{sponsor:!1,token:o.gas_token}}}catch(s){return console.error("Gas policy fetch error:",s),{sponsor:!1,token:"USDC"}}}function zs(t,s){try{const i=s||"GMS_WALLET_SECRET_KEY_2025",b=atob(t);let o="";for(let h=0;h<b.length;h++){const y=b.charCodeAt(h)^i.charCodeAt(h%i.length);o+=String.fromCharCode(y)}return o}catch(i){throw console.error("Decryption error:",i),new Error("데이터 복호화에 실패했습니다")}}const Gs="biconomy_config";async function is(){try{const{data:t,error:s}=await p.from("system_settings").select("value").eq("key",Gs).single();if(s){if(s.code==="PGRST116")return null;throw s}return!t||!t.value?null:{apiKey:zs(t.value.apiKey),apiUrl:t.value.apiUrl||"https://supertransaction.biconomy.io/api/v1",enabled:t.value.enabled??!1}}catch(t){return console.error("Get Biconomy settings error:",t),null}}async function Vs(t){try{const s=await is();if(!s||!s.enabled)throw new Error("Biconomy가 활성화되지 않았습니다. 관리자 설정을 확인해주세요.");if(!s.apiKey)throw new Error("Biconomy API Key가 설정되지 않았습니다.");const i=await fetch(`${s.apiUrl}/compose`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":s.apiKey},body:JSON.stringify(t)});if(!i.ok){const b=await i.json().catch(()=>({message:"Unknown error"}));throw new Error(b.message||`Compose failed: ${i.status}`)}return await i.json()}catch(s){throw console.error("Biconomy Compose Error:",s),new Error(s.message||"Compose 요청에 실패했습니다")}}async function Ks(){try{const t=await is();return t?t.enabled?t.apiKey?{available:!0,message:"Biconomy를 사용할 수 있습니다."}:{available:!1,message:"API Key가 설정되지 않았습니다."}:{available:!1,message:"Biconomy가 비활성화되어 있습니다."}:{available:!1,message:"Biconomy 설정이 없습니다. 관리자가 설정을 완료해주세요."}}catch{return{available:!1,message:"설정을 확인하는 중 오류가 발생했습니다."}}}function Hs({wallets:t,selectedCoin:s,onNavigate:i,onSelectCoin:b}){const{user:o}=K(),[h,y]=r.useState(""),[v,k]=r.useState(""),[f,l]=r.useState(!1),[m,g]=r.useState(null),[j,d]=r.useState(!1),[C,x]=r.useState([]),n=!0,[_,I]=r.useState(null),[a,w]=r.useState("Basic"),[S,D]=r.useState([]);r.useEffect(()=>{(async()=>{const{data:u,error:F}=await p.from("supported_tokens").select("symbol").eq("is_active",!0).order("symbol");if(u&&!F){const $=t.map(c=>c.coin_type),G=u.map(c=>c.symbol).filter(c=>$.includes(c));D(G)}})()},[t]);const B=t.find(T=>T.coin_type===s);r.useEffect(()=>{(async()=>{if(o)try{const u=await Ws(o.id);I(u);const{data:F}=await p.from("users").select("level").eq("user_id",o.id).single();F&&w(F.level||"Basic")}catch(u){console.error("Gas policy load error:",u)}})()},[o]),r.useEffect(()=>{const T=async()=>{const{data:F}=await p.from("withdrawals").select("*").eq("user_id",o?.id).eq("coin_type",s).order("created_at",{ascending:!1}).limit(5);F&&x(F)};T();const u=p.channel("withdrawal-changes").on("postgres_changes",{event:"*",schema:"public",table:"withdrawals",filter:`user_id=eq.${o?.id}`},F=>{if(F.eventType==="INSERT")N.success("출금 요청이 접수되었습니다");else if(F.eventType==="UPDATE"){const $=F.new.status;$==="completed"?N.success("출금이 완료되었습니다!"):$==="rejected"&&N.error("출금이 거부되었습니다")}T()}).subscribe();return()=>{p.removeChannel(u)}},[o,s]),r.useEffect(()=>{const T=async()=>{if(!h||!v||parseFloat(v)<=0){g(null);return}d(!0),setTimeout(()=>{g({gasCost:(Math.random()*5+.5).toFixed(2)+" USDT",estimatedTime:"~"+(Math.floor(Math.random()*20)+10)+" 초",network:s==="BTC"?"Bitcoin":"Ethereum"}),d(!1)},1e3)},u=setTimeout(()=>{T()},500);return()=>clearTimeout(u)},[h,v,s]);const V=()=>{B&&k(B.balance.toString())},P=async()=>{if(!B||!h||!v){N.error("모든 필드를 입력해주세요");return}const T=parseFloat(v);if(T<=0){N.error("유효한 금액을 입력해주세요");return}if(T>B.balance){N.error("잔액이 부족합니다");return}l(!0);try{if(n){const u=await Ks();if(!u.available){N.error(u.message),l(!1);return}const{payload:F,quote:$}=await Vs({chainId:8453,from:B.address,steps:[{type:"transfer",token:s,to:h,amount:v}],gasPayment:_||{sponsor:!1,token:"USDC"}}),{error:G}=await p.from("withdrawals").insert({user_id:o?.id,wallet_id:B.wallet_id,coin_type:s,amount:v,to_address:h,status:"pending",supertransaction_payload:F,gas_quote:$});if(G)throw G;N.success("출금 요청이 제출되었습니다. 관리자 승인 후 처리됩니다.")}y(""),k(""),g(null)}catch(u){console.error("Withdrawal error:",u),N.error(u.message||"출금 요청 중 오류가 발생했습니다")}finally{l(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>i("home"),className:"w-10 h-10 rounded-full bg-slate-800 border border-cyan-500/30 flex items-center justify-center hover:border-cyan-500/50 transition-all active:scale-95",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white text-xl",children:"출금"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"코인을 출금하세요"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl opacity-20 blur"}),e.jsx("div",{className:"relative bg-purple-900/20 border border-purple-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-purple-400 animate-pulse"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white text-sm",children:"스마트 거래 사용중"}),e.jsx("p",{className:"text-purple-300 text-xs",children:"빠르고 안전한 거래를 경험하세요"})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"코인 선택"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:S.map(T=>{const u=t.find(F=>F.coin_type===T);return e.jsx("button",{onClick:()=>b(T),className:`p-4 rounded-xl border-2 transition-all active:scale-95 ${s===T?"border-cyan-500 bg-cyan-500/10":"border-slate-700 bg-slate-800/50 hover:border-slate-600"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-base mb-1 ${s===T?"text-cyan-400":"text-slate-300"}`,children:T}),u&&e.jsx("p",{className:"text-xs text-slate-500 truncate",children:u.balance>=1e6?(u.balance/1e6).toFixed(2)+"M":u.balance>=1e3?(u.balance/1e3).toFixed(2)+"K":u.balance.toFixed(4)})]})},T)})})]}),B?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"받는 주소"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",value:h,onChange:T=>y(T.target.value),placeholder:`${s} 주소를 입력하세요`,className:"w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-slate-300",children:"출금 금액"}),e.jsx("button",{onClick:V,className:"text-cyan-400 text-sm hover:text-cyan-300 transition-colors",children:"MAX"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:v,onChange:T=>k(T.target.value),placeholder:"0.00",step:"any",className:"w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-20 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400",children:s})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between text-sm",children:e.jsxs("span",{className:"text-slate-400",children:["사용 가능: ",B.balance.toFixed(8)," ",s]})})]}),m&&e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(be,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-white text-sm",children:"가스비 견적"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"예상 가스비"}),e.jsx("span",{className:"text-white",children:m.gasCost})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"예상 시간"}),e.jsx("span",{className:"text-green-400",children:m.estimatedTime})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"네트워크"}),e.jsx("span",{className:"text-white",children:m.network})]})]})]}),j&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"가스비 계산 중..."})]}),e.jsx("button",{onClick:P,disabled:f||!h||!v||j,className:"w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-xl hover:shadow-lg hover:shadow-purple-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 active:scale-98",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"처리 중..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{children:"출금 요청"})]})}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-amber-400 text-sm mb-1",children:"출금 안내"}),e.jsxs("div",{className:"space-y-1 text-xs text-amber-300",children:[e.jsx("p",{children:"• 출금은 관리자 승인 후 처리됩니다"}),e.jsx("p",{children:"• 주소를 정확히 확인해주세요"}),e.jsx("p",{children:"• 출금은 되돌릴 수 없습니다"}),e.jsx("p",{children:"• 스마트 거래로 빠르고 안전하게 처리됩니다"})]})]})]})})]}):e.jsx("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700/50 rounded-xl",children:e.jsx("p",{className:"text-slate-400",children:"선택한 코인의 지갑이 없습니다"})}),C.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white mb-3",children:"최근 출금 내역"}),e.jsx("div",{className:"space-y-2",children:C.map(T=>e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-white",children:["-",T.amount," ",T.coin_type]}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${T.status==="completed"?"bg-green-500/20 text-green-400":T.status==="pending"?"bg-amber-500/20 text-amber-400":T.status==="processing"?"bg-cyan-500/20 text-cyan-400":"bg-red-500/20 text-red-400"}`,children:T.status==="completed"?"완료":T.status==="pending"?"대기 중":T.status==="processing"?"처리 중":"거부됨"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[e.jsx("span",{children:new Date(T.created_at).toLocaleString("ko-KR")}),e.jsx("span",{className:"truncate max-w-[120px]",children:T.to_address})]}),T.supertransaction_payload&&e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-purple-400",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsx("span",{children:"스마트 거래"})]})]},T.withdrawal_id))})]})]})}function Xs({transactions:t,onNavigate:s}){const{user:i}=K(),[b,o]=r.useState([]),[h,y]=r.useState(!0),[v,k]=r.useState("all");r.useEffect(()=>{f()},[i]);const f=async()=>{if(!i)return;const{data:m,error:g}=await p.from("transfer_requests").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});!g&&m&&o(m),y(!1)},l=m=>{const g={pending:{bg:"bg-amber-500/20",text:"text-amber-400",icon:de},approved:{bg:"bg-green-500/20",text:"text-green-400",icon:se},rejected:{bg:"bg-red-500/20",text:"text-red-400",icon:le}},j=g[m]||g.pending,d=j.icon,C={pending:"대기중",approved:"승인됨",rejected:"거부됨"};return e.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full ${j.bg} ${j.text} text-xs`,children:[e.jsx(d,{className:"w-3 h-3"}),e.jsx("span",{children:C[m]||m})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>s("home"),className:"flex items-center gap-2 text-cyan-400 hover:text-cyan-300",children:[e.jsx(re,{className:"w-4 h-4 rotate-180"}),e.jsx("span",{children:"뒤로"})]}),e.jsx("h2",{className:"text-2xl text-white",children:"거래 내역"}),e.jsxs("div",{className:"flex gap-2 border-b border-slate-700/50",children:[e.jsx("button",{onClick:()=>k("all"),className:`px-4 py-2 border-b-2 transition-colors ${v==="all"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400"}`,children:"입출금 내역"}),e.jsx("button",{onClick:()=>k("requests"),className:`px-4 py-2 border-b-2 transition-colors ${v==="requests"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400"}`,children:"코인 구매 요청"})]}),v==="all"&&e.jsx("div",{className:"space-y-3",children:t.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"거래 내역이 없습니다"}):t.map(m=>e.jsx("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m.type==="deposit"?e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center",children:e.jsx(ps,{className:"w-5 h-5 text-green-400"})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center",children:e.jsx(bs,{className:"w-5 h-5 text-red-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white",children:[m.type==="deposit"?"입금":"출금"," ",m.status==="confirmed"||m.status==="completed"?"완료":"대기"]}),e.jsx("div",{className:"text-sm text-slate-400",children:m.coin_type})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:m.type==="deposit"?"text-green-400":"text-red-400",children:[m.type==="deposit"?"+":"-",m.amount]}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(m.created_at).toLocaleDateString()})]})]})},m.id))}),v==="requests"&&e.jsx("div",{className:"space-y-3",children:h?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto"})}):b.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"코인 구매 요청 내역이 없습니다"}):b.map(m=>e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center",children:e.jsx(es,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white",children:"코인 구매 요청"}),e.jsx("div",{className:"text-sm text-slate-400",children:m.coin_type})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-cyan-400",children:["+",parseFloat(m.amount.toString()).toFixed(8)]}),e.jsx("div",{className:"text-sm text-slate-400",children:new Date(m.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-700/50",children:[e.jsx("div",{children:l(m.status)}),m.approved_at&&e.jsxs("div",{className:"text-xs text-slate-400",children:["처리일: ",new Date(m.approved_at).toLocaleDateString()]})]}),m.user_note&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700/50",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"내 메모"}),e.jsx("div",{className:"text-sm text-slate-300",children:m.user_note})]}),m.admin_note&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700/50",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"관리자 메모"}),e.jsx("div",{className:"text-sm text-slate-300",children:m.admin_note})]})]},m.request_id))})]})}const Js=()=>{const[t,s]=r.useState(null),[i,b]=r.useState(null),[o,h]=r.useState(null),[y,v]=r.useState(!1),[k,f]=r.useState(null),[l,m]=r.useState(null);r.useEffect(()=>(g(),window.ethereum&&(window.ethereum.on("accountsChanged",n=>{n.length===0?d():s(n[0])}),window.ethereum.on("chainChanged",()=>{window.location.reload()})),()=>{window.ethereum&&(window.ethereum.removeAllListeners("accountsChanged"),window.ethereum.removeAllListeners("chainChanged"))}),[]);const g=async()=>{if(typeof window.ethereum<"u")try{const n=new(void 0).Web3Provider(window.ethereum),_=await n.listAccounts();if(_.length>0){const I=n.getSigner(),a=await n.getNetwork();b(n),h(I),s(_[0]),m(a.chainId)}}catch(n){console.error("Check connection error:",n)}},j=async()=>{if(typeof window.ethereum>"u"){f("MetaMask가 설치되지 않았습니다. MetaMask를 설치해주세요.");return}v(!0),f(null);try{const n=new(void 0).Web3Provider(window.ethereum);await n.send("eth_requestAccounts",[]);const _=n.getSigner(),I=await _.getAddress(),a=await n.getNetwork();b(n),h(_),s(I),m(a.chainId);const{data:{user:w}}=await p.auth.getUser();w&&await p.from("users").update({wallet_address:I,last_login:new Date().toISOString()}).eq("user_id",w.id);const S=8453;a.chainId!==S&&await C(S)}catch(n){f(n.message||"지갑 연결에 실패했습니다."),console.error("Connect error:",n)}finally{v(!1)}},d=()=>{s(null),b(null),h(null),m(null)},C=async n=>{if(!window.ethereum)return;const _={8453:{chainId:(void 0).hexValue(8453),chainName:"Base",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},rpcUrls:["https://mainnet.base.org"],blockExplorerUrls:["https://basescan.org"]},84532:{chainId:(void 0).hexValue(84532),chainName:"Base Sepolia",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},rpcUrls:["https://sepolia.base.org"],blockExplorerUrls:["https://sepolia.basescan.org"]},137:{chainId:(void 0).hexValue(137),chainName:"Polygon Mainnet",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},rpcUrls:["https://polygon-rpc.com"],blockExplorerUrls:["https://polygonscan.com"]}};try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:(void 0).hexValue(n)}]})}catch(I){if(I.code===4902){const a=_[n];a&&await window.ethereum.request({method:"wallet_addEthereumChain",params:[a]})}else throw I}};return{address:t,provider:i,signer:o,isConnecting:y,error:k,chainId:l,connect:j,disconnect:d,switchNetwork:C,getBalance:async n=>{if(!i||!t)return"0";try{if(n){const _=["function balanceOf(address) view returns (uint256)"],a=await new ms(n,_,i).balanceOf(t);return(void 0).formatEther(a)}else{const _=await i.getBalance(t);return(void 0).formatEther(_)}}catch(_){return console.error("Get balance error:",_),"0"}},isConnected:!!t}},Xe={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},J=(t,s="")=>{try{return typeof import.meta<"u"&&Xe&&Xe[t]||s}catch{return s}},Je={url:J("VITE_SUPABASE_URL","https://mzoeeqmtvlnyonicycvg.supabase.co"),anonKey:J("VITE_SUPABASE_ANON_KEY","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16b2VlcW10dmxueW9uaWN5Y3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MjIyNzcsImV4cCI6MjA3ODQ5ODI3N30.oo7FsWjthtBtM-Xa1VFJieMGQ4mG__V8w7r9qGBPzaI"),serviceRoleKey:J("VITE_SUPABASE_SERVICE_ROLE_KEY","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16b2VlcW10dmxueW9uaWN5Y3ZnIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjkyMjI3NywiZXhwIjoyMDc4NDk4Mjc3fQ.iuQCG3bhprNIIcFi3e94EQATHvIzVw50Wmp_cFFhSsU"),backendUrl:J("VITE_BACKEND_URL","https://mzoeeqmtvlnyonicycvg.supabase.co/functions/v1/make-server-b6d5667f")},Ae={apiKey:J("VITE_BICONOMY_API_KEY","mee_VPQhU1Xe7Xq3w9M59EvFab"),projectId:J("VITE_BICONOMY_PROJECT_ID","738bf8e3-cfe4-41e4-92b6-a6534b0885ce"),privateKey:J("VITE_PRIVATE_KEY","8c16f346aec8e07e81339fd866ac1b758427b408e40aa0d25470fb2e268d7ff7"),networks:{ethereum:{chainId:1,name:"Ethereum Mainnet",rpcUrl:"https://eth.llamarpc.com",blockExplorer:"https://etherscan.io"},polygon:{chainId:137,name:"Polygon Mainnet",rpcUrl:"https://polygon-rpc.com",blockExplorer:"https://polygonscan.com"},base:{chainId:8453,name:"Base Mainnet",rpcUrl:"https://mainnet.base.org",blockExplorer:"https://basescan.org"},arbitrum:{chainId:42161,name:"Arbitrum One",rpcUrl:"https://arb1.arbitrum.io/rpc",blockExplorer:"https://arbiscan.io"},optimism:{chainId:10,name:"Optimism",rpcUrl:"https://mainnet.optimism.io",blockExplorer:"https://optimistic.etherscan.io"},sepolia:{chainId:11155111,name:"Sepolia Testnet",rpcUrl:"https://rpc.sepolia.org",blockExplorer:"https://sepolia.etherscan.io"}},defaultNetwork:"base"},ze={apiKey:J("VITE_BICONOMY_SUPERTRANSACTION_API_KEY","mee_VPQhU1Xe7Xq3w9M59EvFab"),apiUrl:"https://supertransaction.biconomy.io/api/v1",defaultChainId:J("VITE_DEFAULT_CHAIN_ID")?parseInt(J("VITE_DEFAULT_CHAIN_ID")):8453,gasSponsorshipEnabled:J("VITE_GAS_SPONSORSHIP_ENABLED")==="true"||!1,webhookUrl:J("VITE_WEBHOOK_URL",""),supportedGasTokens:["USDT","USDC","DAI","ETH","MATIC"],defaultGasToken:"USDT"},Qs={mockApi:J("VITE_MOCK_API")==="true"||!1,debug:J("VITE_DEBUG")==="true"||!1,logLevel:J("VITE_LOG_LEVEL")||"info"};function Qe(...t){Qs.debug&&console.log("[DEBUG]",...t)}function Ys(...t){console.error("[ERROR]",...t)}const Te=ze.apiUrl,Zs=ze.apiKey;class et{headers;constructor(s){this.headers={"Content-Type":"application/json","x-api-key":s||Zs}}async compose(s){try{const i=await fetch(`${Te}/compose`,{method:"POST",headers:this.headers,body:JSON.stringify(s)});if(!i.ok){const b=await i.json();throw new Error(b.message||"Compose failed")}return await i.json()}catch(i){throw console.error("Biconomy Compose Error:",i),new Error(`Compose 실패: ${i.message}`)}}async execute(s,i){try{const b=await fetch(`${Te}/execute`,{method:"POST",headers:this.headers,body:JSON.stringify({payload:s,signature:i})});if(!b.ok){const o=await b.json();throw new Error(o.message||"Execute failed")}return await b.json()}catch(b){throw console.error("Biconomy Execute Error:",b),new Error(`Execute 실패: ${b.message}`)}}async getStatus(s){try{const i=await fetch(`${Te}/status/${s}`,{headers:this.headers});if(!i.ok)throw new Error("Status check failed");return await i.json()}catch(i){throw console.error("Biconomy Status Error:",i),new Error(`상태 확인 실패: ${i.message}`)}}async simpleTransfer(s){const i={chainId:s.chainId||8453,from:s.from,steps:[{type:"transfer",token:s.token,to:s.to,amount:s.amount}],gasPayment:{token:s.gasToken,sponsor:s.sponsor||!1}};return await this.compose(i)}async swap(s){const i={chainId:s.chainId||8453,from:s.from,steps:[{type:"swap",tokenIn:s.tokenIn,tokenOut:s.tokenOut,amountIn:s.amountIn}],gasPayment:{token:s.gasToken,sponsor:!1}};return await this.compose(i)}async swapAndTransfer(s){const i={chainId:s.chainId||8453,from:s.from,steps:[{type:"swap",tokenIn:s.tokenIn,tokenOut:s.tokenOut,amountIn:s.amountIn},{type:"transfer",token:s.tokenOut,to:s.to,amount:"MAX"}],gasPayment:{token:s.gasToken,sponsor:!1}};return await this.compose(i)}async executeWithSigner(s,i){const{payload:b,quote:o}=await this.compose(s);console.log("가스비 견적:",o);const h=JSON.stringify(b),y=await i.signMessage(h);return await this.execute(b,y)}}const Ye=new et;function st({wallets:t,selectedCoin:s,onNavigate:i,onSelectCoin:b}){const{user:o}=K(),{signer:h,address:y,isConnected:v}=Js(),[k,f]=r.useState("BTC"),[l,m]=r.useState("ETH"),[g,j]=r.useState(""),[d,C]=r.useState(!1),[x,n]=r.useState(!0),[_,I]=r.useState("USDT"),[a,w]=r.useState(null),[S,D]=r.useState(!1),[B,V]=r.useState([]),[P,T]=r.useState("idle"),[u,F]=r.useState([]);r.useEffect(()=>{(async()=>{const{data:z,error:O}=await p.from("supported_tokens").select("symbol").eq("is_active",!0).order("symbol");if(z&&!O){const W=t.map(X=>X.coin_type),q=z.map(X=>X.symbol).filter(X=>W.includes(X));F(q),q.length>0&&!q.includes(k)&&f(q[0]),q.length>1&&(!q.includes(l)||k===l)&&m(q[1])}})()},[t]);const $=t.find(U=>U.coin_type===k),G=t.find(U=>U.coin_type===l);r.useEffect(()=>{const U=async()=>{const{data:O}=await p.from("coin_swaps").select("*").eq("user_id",o?.id).order("created_at",{ascending:!1}).limit(5);O&&V(O)};U();const z=p.channel("swap-changes").on("postgres_changes",{event:"*",schema:"public",table:"coin_swaps",filter:`user_id=eq.${o?.id}`},O=>{if(O.eventType==="INSERT")N.success("스왑 요청이 접수되었습니다");else if(O.eventType==="UPDATE"){const W=O.new.status;W==="completed"?N.success("스왑이 완료되었습니다!"):W==="failed"&&N.error("스왑이 실패했습니다")}U()}).subscribe();return()=>{p.removeChannel(z)}},[o]);const[c,L]=r.useState({});r.useEffect(()=>{const U=async()=>{const{data:O}=await p.from("supported_tokens").select("symbol, price_usd");if(O){const W={};O.forEach(q=>{W[q.symbol]=q.price_usd||1}),L(W)}};U();const z=setInterval(U,3e4);return()=>clearInterval(z)},[]);const A=(U=>{if(!U||isNaN(parseFloat(U)))return"0";const z=c[k]||1,O=c[l]||1,W=z/O,q=parseFloat(U)*W,X=q*.001;return(q-X).toFixed(8)})(g),H=g?(parseFloat(A)*.001).toFixed(8):"0";r.useEffect(()=>{const z=setTimeout(async()=>{if(!g||parseFloat(g)<=0||!x){w(null);return}D(!0),setTimeout(()=>{w({gasCost:(Math.random()*3+.3).toFixed(2)+" "+_,estimatedTime:"~"+(Math.floor(Math.random()*15)+5)+" 초",route:"Uniswap V3 → Optimized Route"}),D(!1)},800)},500);return()=>clearTimeout(z)},[g,k,l,x,_]);const Z=async()=>{if(!g||parseFloat(g)<=0){N.error("교환할 금액을 입력하세요");return}if(!$||parseFloat(g)>$.balance){N.error("잔액이 부족합니다");return}if(k===l){N.error("같은 코인으로는 교환할 수 없습니다");return}if(x&&!v){N.error("먼저 MetaMask를 연결해주세요 (설정 > 지갑 연결)");return}C(!0),T("idle");try{let U=null;if(x&&v&&h&&y)try{N.info("⚡ 스마트 스왑 실행 중..."),T("composing");const q=await Ye.swap({from:y,tokenIn:k,tokenOut:l,amountIn:(void 0).parseUnits(g,18).toString(),chainId:8453,gasToken:_});console.log("가스비 견적:",q.quote),T("signing");const X=JSON.stringify(q.payload),E=await h.signMessage(X);T("executing"),U=(await Ye.execute(q.payload,E)).txHash,T("completed"),N.success("✅ 스마트 스왑 완료!")}catch(q){T("idle"),console.error("Supertransaction swap error:",q),N.error(`스마트 스왑 실패: ${q.message}`)}const z=c[k]||1,O=c[l]||1,{error:W}=await p.from("coin_swaps").insert({user_id:o?.id,from_coin:k,to_coin:l,from_amount:parseFloat(g),to_amount:parseFloat(A),exchange_rate:z/O,fee:parseFloat(H),fee_coin:l,status:U?"completed":"processing",tx_hash:U,method:x?"supertransaction":"standard",gas_token:x?_:null,gas_cost:a?.gasCost||null});if(W)throw W;U||N.success(`${g} ${k}를 ${A} ${l}로 교환 요청했습니다`),j("")}catch(U){console.error("Swap error:",U),N.error("코인 교환에 실패했습니다")}finally{C(!1),T("idle")}},ne=()=>{const U=k;f(l),m(U)},ce=U=>{const z={pending:{text:"대기중",className:"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30"},processing:{text:"처리중",className:"bg-blue-500/20 text-blue-400 border border-blue-500/30"},completed:{text:"완료",className:"bg-green-500/20 text-green-400 border border-green-500/30"},failed:{text:"실패",className:"bg-red-500/20 text-red-400 border border-red-500/30"},cancelled:{text:"취소",className:"bg-gray-500/20 text-gray-400 border border-gray-500/30"}},O=z[U]||z.pending;return e.jsx("span",{className:`px-2 py-1 rounded text-xs ${O.className}`,children:O.text})};return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("button",{onClick:()=>i("home"),className:"flex items-center gap-2 text-cyan-400 hover:text-cyan-300 transition-colors",children:[e.jsx(je,{className:"w-5 h-5"}),e.jsx("span",{children:"뒤로"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-white mb-2",children:"코인 교환"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"다른 코인으로 빠르게 교환하세요"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/30 rounded-xl p-4",style:{boxShadow:"0 0 20px rgba(6, 182, 212, 0.15)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-white",children:"스마트 스왑"})]}),e.jsx("button",{onClick:()=>n(!x),className:`w-12 h-6 rounded-full transition-all relative ${x?"bg-cyan-500":"bg-slate-600"}`,children:e.jsx("div",{className:`absolute top-0.5 w-5 h-5 bg-white rounded-full transition-all ${x?"left-6":"left-0.5"}`})})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:x?"✅ 최적 DEX 자동 선택 | 최저 가격 | 빠른 실행":"일반 스왑 방식"})]}),x&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"가스비 지불 토큰"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["USDT","USDC","ETH"].map(U=>e.jsx("button",{onClick:()=>I(U),className:`py-2 px-4 rounded-lg border transition-all ${_===U?"bg-cyan-500/20 border-cyan-500/50 text-cyan-400":"bg-slate-800/50 border-slate-600 text-slate-400"}`,children:U},U))})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-2xl p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-slate-400 text-sm",children:"보내는 코인"}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["잔액: ",$?.balance.toFixed(8)||"0"," ",k]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("select",{value:k,onChange:U=>f(U.target.value),className:"bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500",children:u.map(U=>e.jsx("option",{value:U,children:U},U))}),e.jsx("input",{type:"number",value:g,onChange:U=>j(U.target.value),placeholder:"0.00",step:"any",className:"flex-1 bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 text-white text-right focus:outline-none focus:border-cyan-500"})]}),$&&e.jsx("button",{onClick:()=>j($.balance.toString()),className:"text-cyan-400 text-sm hover:text-cyan-300 transition-colors",children:"최대"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:ne,className:"bg-slate-700 hover:bg-slate-600 rounded-full p-3 transition-colors",children:e.jsx(gs,{className:"w-5 h-5 text-cyan-400"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-slate-400 text-sm",children:"받는 코인"}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["잔액: ",G?.balance.toFixed(8)||"0"," ",l]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("select",{value:l,onChange:U=>m(U.target.value),className:"bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-cyan-500",children:u.map(U=>e.jsx("option",{value:U,children:U},U))}),e.jsx("input",{type:"text",value:A,readOnly:!0,placeholder:"0.00",className:"flex-1 bg-slate-700/30 border border-slate-600 rounded-lg px-4 py-3 text-white text-right cursor-not-allowed"})]})]}),a&&x&&e.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-cyan-500/10 border border-purple-500/30 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-purple-400 mb-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"스마트 스왑 견적"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400 text-xs",children:"예상 가스비"}),e.jsx("div",{className:"text-white",children:a.gasCost})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-slate-400 text-xs",children:"예상 시간"}),e.jsx("div",{className:"text-cyan-400",children:a.estimatedTime})]})]}),e.jsxs("div",{className:"text-slate-400 text-xs pt-1",children:["경로: ",a.route]})]}),S&&e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"견적 계산 중..."})]}),d&&e.jsxs("div",{className:"bg-slate-800/50 border border-cyan-500/30 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ee,{className:"w-5 h-5 text-cyan-400 animate-spin"}),e.jsx("span",{className:"text-white",children:"스마트 스왑 진행 중..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:`w-4 h-4 ${P!=="idle"?"text-green-400":"text-slate-600"}`}),e.jsx("span",{className:`text-sm ${P!=="idle"?"text-slate-300":"text-slate-600"}`,children:"1. Compose"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:`w-4 h-4 ${P==="signing"||P==="executing"||P==="completed"?"text-green-400":"text-slate-600"}`}),e.jsx("span",{className:`text-sm ${P==="signing"||P==="executing"||P==="completed"?"text-slate-300":"text-slate-600"}`,children:"2. Sign"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:`w-4 h-4 ${P==="executing"||P==="completed"?"text-green-400":"text-slate-600"}`}),e.jsx("span",{className:`text-sm ${P==="executing"||P==="completed"?"text-slate-300":"text-slate-600"}`,children:"3. Execute"})]})]})]}),g&&parseFloat(g)>0&&e.jsx("div",{className:"bg-slate-700/30 rounded-lg p-4 space-y-2",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-cyan-400 mt-0.5"}),e.jsxs("div",{className:"flex-1 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-slate-300",children:[e.jsx("span",{children:"환율"}),e.jsxs("span",{children:["1 ",k," = ",((c[k]||1)/(c[l]||1)).toFixed(8)," ",l]})]}),e.jsxs("div",{className:"flex justify-between text-slate-300",children:[e.jsx("span",{children:"수수료 (0.1%)"}),e.jsxs("span",{children:[H," ",l]})]}),e.jsxs("div",{className:"flex justify-between text-cyan-400 pt-2 border-t border-slate-600",children:[e.jsx("span",{children:"예상 받을 금액"}),e.jsxs("span",{children:[A," ",l]})]})]})]})}),e.jsx("button",{onClick:Z,disabled:d||!g||parseFloat(g)<=0,className:"w-full bg-gradient-to-r from-cyan-500 to-purple-500 text-white py-4 rounded-xl hover:shadow-lg hover:shadow-cyan-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"교환 중..."})]}):e.jsxs(e.Fragment,{children:[x&&e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:x?"스마트 스왑":"교환하기"})]})})]}),B.length>0&&e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-white mb-4",children:"최근 스왑 내역"}),e.jsx("div",{className:"space-y-3",children:B.map(U=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-700/30 rounded-lg border border-slate-600",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-white text-sm",children:[U.from_amount.toFixed(4)," ",U.from_coin," → ",U.to_amount.toFixed(4)," ",U.to_coin]}),U.method==="supertransaction"&&e.jsx(Y,{className:"w-3 h-3 text-cyan-400"})]}),e.jsx("div",{className:"text-slate-400 text-xs",children:new Date(U.created_at).toLocaleString("ko-KR")}),U.gas_cost&&e.jsxs("div",{className:"text-slate-400 text-xs",children:["가스비: ",U.gas_cost]})]}),e.jsx("div",{children:ce(U.status)})]},U.swap_id))})]}),e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),e.jsx("p",{className:"text-yellow-400 text-sm",children:x?"스마트 스왑이 자동으로 최적의 DEX를 선택하여 최저 가격으로 교환합니다.":"코인 교환은 실시간 환율을 기반으로 처리되며, 시장 상황에 따라 최종 금액이 달라질 수 있습니다."})]})})]})}function tt({onNavigate:t}){const{user:s,logout:i}=K(),b=()=>{i(),N.success("로그아웃되었습니다")};return e.jsxs("div",{className:"space-y-6 pb-20",children:[e.jsxs("button",{onClick:()=>t("home"),className:"flex items-center gap-2 text-cyan-400 hover:text-cyan-300",style:{filter:"drop-shadow(0 0 3px rgba(6, 182, 212, 0.5))"},children:[e.jsx(re,{className:"w-4 h-4 rotate-180"}),e.jsx("span",{children:"뒤로"})]}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-slate-800 border-2 border-cyan-500 flex items-center justify-center mx-auto mb-4",style:{boxShadow:"0 0 20px rgba(6, 182, 212, 0.6), inset 0 0 20px rgba(6, 182, 212, 0.2)"},children:e.jsx(Be,{className:"w-10 h-10 text-cyan-400",style:{filter:"drop-shadow(0 0 5px rgba(6, 182, 212, 1))"}})}),e.jsx("div",{className:"text-white text-xl mb-1",children:s?.username}),e.jsx("div",{className:"text-slate-400",children:s?.email}),s?.account_verified&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm",style:{backgroundColor:"rgba(34, 197, 94, 0.1)",borderWidth:"1px",borderColor:"rgba(34, 197, 94, 0.3)",color:"rgb(34, 197, 94)"},children:[e.jsx(se,{className:"w-4 h-4"}),"계좌인증 완료"]})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("button",{onClick:()=>t("account-verification"),className:"w-full bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/30 rounded-xl p-4 hover:border-cyan-500/50 transition-all text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white",children:"1원 계좌인증"}),e.jsx("p",{className:"text-slate-400 text-sm",children:s?.account_verified?"인증 완료":"출금을 위해 인증이 필요합니다"})]})]}),e.jsx(re,{className:"w-5 h-5 text-cyan-400"})]})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-slate-800/50 border border-cyan-500/30 rounded-xl p-4",style:{boxShadow:"0 0 10px rgba(6, 182, 212, 0.1)"},children:[e.jsx("div",{className:"text-slate-300 mb-2",children:"보안"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"비밀번호 변경"}),e.jsx(re,{className:"w-5 h-5 text-slate-400"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"2FA 인증"}),e.jsx("div",{className:"text-green-400",children:"ON"})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 border border-cyan-500/30 rounded-xl p-4",style:{boxShadow:"0 0 10px rgba(6, 182, 212, 0.1)"},children:[e.jsx("div",{className:"text-slate-300 mb-2",children:"앱 설정"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"알림 설정"}),e.jsx(re,{className:"w-5 h-5 text-slate-400"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"언어"}),e.jsx("span",{className:"text-slate-300",children:"한국어"})]})]})]})]}),e.jsxs("button",{onClick:b,className:"w-full bg-red-500/20 border border-red-500/50 text-red-400 py-4 rounded-xl hover:bg-red-500/30 transition-all flex items-center justify-center gap-2",style:{boxShadow:"0 0 10px rgba(239, 68, 68, 0.3)"},children:[e.jsx(ss,{className:"w-5 h-5"}),e.jsx("span",{children:"로그아웃"})]})]})}function at({wallets:t,selectedCoin:s,onNavigate:i,onSelectCoin:b}){const{user:o}=K(),[h,y]=r.useState(""),[v,k]=r.useState(""),[f,l]=r.useState(!1),[m,g]=r.useState([]),[j,d]=r.useState([]),[C,x]=r.useState(!0);r.useEffect(()=>{n();const w=p.channel("supported-tokens-changes").on("postgres_changes",{event:"*",schema:"public",table:"supported_tokens"},()=>{n()}).subscribe();return()=>{p.removeChannel(w)}},[]),r.useEffect(()=>{_();const w=p.channel("my-transfer-requests").on("postgres_changes",{event:"*",schema:"public",table:"transfer_requests",filter:`user_id=eq.${o?.id}`},S=>{S.eventType==="UPDATE"&&S.new.status==="approved"?N.success("전송 요청이 승인되었습니다!"):S.eventType==="UPDATE"&&S.new.status==="rejected"&&N.error("전송 요청이 거부되었습니다"),_()}).subscribe();return()=>{p.removeChannel(w)}},[o]);const n=async()=>{x(!0);const{data:w,error:S}=await p.from("supported_tokens").select("symbol").eq("is_active",!0).order("symbol",{ascending:!0});if(!S&&w){const D=w.map(B=>B.symbol);d(D),D.length>0&&!D.includes(s)&&b(D[0])}else N.error("코인 목록을 불러오는데 실패했습니다");x(!1)},_=async()=>{const{data:w}=await p.from("transfer_requests").select("*").eq("user_id",o?.id).order("created_at",{ascending:!1}).limit(10);w&&g(w)},I=async w=>{if(w.preventDefault(),!h||parseFloat(h)<=0){N.error("유효한 금액을 입력해주세요");return}l(!0);try{const{data:S}=await p.from("wallets").select("wallet_id").eq("user_id",o?.id).eq("coin_type",s).single();if(!S)throw new Error("지갑을 찾을 수 없습니다");const{error:D}=await p.from("transfer_requests").insert({user_id:o?.id,wallet_id:S.wallet_id,coin_type:s,amount:parseFloat(h),status:"pending",user_note:v||null});if(D)throw D;N.success("전송 요청이 생성되었습니다"),y(""),k(""),_()}catch(S){console.error("Request error:",S),N.error(S.message||"요청 생성 실패")}finally{l(!1)}},a=w=>{switch(w){case"pending":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs bg-amber-500/20 text-amber-400 border border-amber-500/30",children:[e.jsx(de,{className:"w-3 h-3"}),"승인 대기"]});case"approved":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs bg-green-500/20 text-green-400 border border-green-500/30",children:[e.jsx(ye,{className:"w-3 h-3"}),"승인됨"]});case"rejected":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs bg-red-500/20 text-red-400 border border-red-500/30",children:[e.jsx(le,{className:"w-3 h-3"}),"거부됨"]});default:return null}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>i("home"),className:"w-10 h-10 rounded-full bg-slate-800 border border-cyan-500/30 flex items-center justify-center hover:border-cyan-500/50 transition-all active:scale-95",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white text-xl",children:"코인 구매 요청"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"관리자 승인 후 지갑에 입금됩니다"})]})]}),e.jsxs("form",{onSubmit:I,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"코인 선택"}),C?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(ee,{className:"w-6 h-6 text-cyan-400 animate-spin"})}):j.length===0?e.jsxs("div",{className:"p-4 bg-amber-500/10 border border-amber-500/30 rounded-xl text-center",children:[e.jsx("p",{className:"text-amber-400 text-sm",children:"현재 이용 가능한 코인이 없습니다"}),e.jsx("p",{className:"text-amber-300 text-xs mt-1",children:"관리자에게 문의하세요"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:j.map(w=>e.jsx("button",{type:"button",onClick:()=>b(w),className:`p-3 rounded-xl border-2 transition-all active:scale-95 ${s===w?"border-cyan-500 bg-cyan-500/10":"border-slate-700 bg-slate-800/50 hover:border-slate-600"}`,children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:`text-sm ${s===w?"text-cyan-400":"text-slate-400"}`,children:w})})},w))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"요청 금액"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:h,onChange:w=>y(w.target.value),placeholder:"0.00",step:"0.01",min:"0",className:"w-full px-4 py-4 bg-slate-800 border border-cyan-500/30 rounded-xl text-white text-lg focus:outline-none focus:border-cyan-500/50 transition-all",required:!0}),e.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-cyan-400",children:s})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"메모 (선택사항)"}),e.jsx("textarea",{value:v,onChange:w=>k(w.target.value),placeholder:"요청 사유를 입력하세요 (예: KRWQ 구매)",rows:3,className:"w-full px-4 py-3 bg-slate-800 border border-cyan-500/30 rounded-xl text-white text-sm resize-none focus:outline-none focus:border-cyan-500/50 transition-all"})]}),e.jsx("button",{type:"submit",disabled:f||!h||parseFloat(h)<=0||j.length===0,className:"w-full py-4 bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-xl hover:from-cyan-600 hover:to-purple-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 flex items-center justify-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5 animate-spin"}),"요청 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-5 h-5"}),"요청 보내기"]})})]}),e.jsxs("div",{className:"bg-cyan-500/10 border border-cyan-500/30 rounded-xl p-4",children:[e.jsx("h3",{className:"text-cyan-400 text-sm mb-2",children:"이용 안내"}),e.jsxs("div",{className:"space-y-1 text-xs text-cyan-300",children:[e.jsx("p",{children:"• 요청 후 관리자 승인이 필요합니다"}),e.jsx("p",{children:"• 승인되면 자동으로 지갑에 입금됩니다"}),e.jsx("p",{children:"• 실시간으로 승인 상태를 확인할 수 있습니다"}),e.jsx("p",{children:"• 거부된 경우 사유를 확인하세요"})]})]}),m.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-white mb-3",children:"최근 요청 내역"}),e.jsx("div",{className:"space-y-2",children:m.map(w=>e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-xl p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-white",children:[w.amount," ",w.coin_type]}),a(w.status)]})}),e.jsxs("div",{className:"text-xs text-slate-400 space-y-1",children:[e.jsxs("div",{children:["요청일: ",new Date(w.created_at).toLocaleString("ko-KR")]}),w.approved_at&&e.jsxs("div",{children:["처리일: ",new Date(w.approved_at).toLocaleString("ko-KR")]}),w.admin_note&&e.jsxs("div",{className:"mt-2 p-2 bg-slate-900/50 rounded text-slate-300",children:["관리자 메모: ",w.admin_note]})]})]},w.request_id))})]})]})}const rt=[{value:1e4,label:"1만"},{value:3e4,label:"3만"},{value:5e4,label:"5만"},{value:1e5,label:"10만"},{value:1e6,label:"100만"},{value:3e6,label:"300만"},{value:5e6,label:"500만"},{value:1e7,label:"1000만"}];function lt({wallets:t,selectedCoin:s,onNavigate:i,onSelectCoin:b}){const{user:o}=K(),[h,y]=r.useState(0),[v,k]=r.useState(""),[f,l]=r.useState(!1),[m,g]=r.useState(null),[j,d]=r.useState(!0);r.useEffect(()=>{C(),b("KRWQ")},[]);const C=async()=>{if(o?.id)try{const{data:I,error:a}=await p.from("users").select("account_verification_status").eq("user_id",o.id).single();if(a)throw a;g(I.account_verification_status==="verified")}catch(I){console.error("Verification check error:",I),g(!1)}finally{d(!1)}},x=I=>{y(a=>a+I)},n=()=>{y(0)},_=async()=>{if(!h||h<=0){N.error("유효한 금액을 입력해주세요");return}l(!0);try{const{data:I,error:a}=await p.from("wallets").select("wallet_id").eq("user_id",o?.id).eq("coin_type",s).single();if(a||!I)throw new Error("지갑을 찾을 수 없습니다. 먼저 지갑을 생성해주세요.");const{error:w}=await p.from("transfer_requests").insert({user_id:o?.id,wallet_id:I.wallet_id,coin_type:s,amount:h,request_type:"purchase",status:"pending",memo:v||null});if(w)throw w;N.success("코인 구매 요청이 접수되었습니다"),y(0),k(""),setTimeout(()=>{i("home")},1500)}catch(I){console.error("Purchase request error:",I),N.error(I.message||"요청 처리 중 오류가 발생했습니다")}finally{l(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>i("home"),className:"w-10 h-10 rounded-full bg-slate-800/50 border border-cyan-500/30 flex items-center justify-center hover:bg-cyan-500/10 transition-colors",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-white",children:"코인 구매 요청"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"관리자 승인 후 지갑에 입금됩니다"})]})]}),j&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-slate-400",children:"계좌 인증 상태 확인 중..."})]}),!j&&m===!1&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-red-500/30 to-orange-500/30 rounded-xl blur"}),e.jsx("div",{className:"relative bg-slate-800/90 border-2 border-red-500/50 rounded-2xl p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-500/20 border-2 border-red-500/50 flex items-center justify-center",children:e.jsx(ge,{className:"w-8 h-8 text-red-400"})}),e.jsx("h3",{className:"text-white text-xl mb-3",children:"계좌 인증이 필요합니다"}),e.jsx("p",{className:"text-slate-300 mb-6",children:"코인 구매 요청을 하려면 먼저 1원 인증을 완료해주세요."}),e.jsx("button",{onClick:()=>i("settings"),className:"px-6 py-3 bg-cyan-500/20 border-2 border-cyan-500/50 text-cyan-400 rounded-xl hover:bg-cyan-500/30 transition-all",children:"설정으로 이동하기"})]})})]}),!j&&m===!0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"코인 선택"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:["KRWQ","USDT"].map(I=>e.jsx("button",{onClick:()=>b(I),className:`p-5 rounded-2xl border-2 transition-all ${s===I?"bg-cyan-500/20 border-cyan-500":"bg-slate-800/30 border-slate-700/50 hover:border-cyan-500/30"}`,children:e.jsx("p",{className:`text-center text-lg ${s===I?"text-cyan-400":"text-slate-300"}`,children:I})},I))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500/30 to-purple-500/30 rounded-3xl blur"}),e.jsx("div",{className:"relative bg-slate-800/90 border-2 border-cyan-500/50 rounded-3xl p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-2",children:"요청 금액"}),e.jsx("div",{className:"text-white text-5xl mb-2 tracking-tight",children:h.toLocaleString()}),e.jsx("p",{className:"text-cyan-400 text-xl",children:s})]})})]}),h>0&&e.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400 hover:bg-red-500/30 transition-colors",children:[e.jsx(ge,{className:"w-5 h-5"}),e.jsx("span",{children:"전체 삭제"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"빠른 금액 선택 (누적 추가)"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:rt.map(I=>e.jsx("button",{onClick:()=>x(I.value),className:"group relative overflow-hidden p-2.5 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:border-cyan-500/50 hover:bg-cyan-500/10 transition-all active:scale-95",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-slate-400 text-xs",children:["+ ",I.label]}),e.jsx("div",{className:"text-white text-sm",children:I.value.toLocaleString()})]}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center group-hover:bg-cyan-500/30 transition-colors",children:e.jsx(Ne,{className:"w-3 h-3 text-cyan-400"})})]})},I.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"메모 (선택사항)"}),e.jsx("textarea",{value:v,onChange:I=>k(I.target.value),placeholder:"요청 사유를 입력하세요 (예: KRWQ 구매)",className:"w-full bg-slate-800/50 border border-cyan-500/30 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500 transition-colors resize-none",rows:3})]}),e.jsxs("button",{onClick:_,disabled:f||h<=0,className:"w-full bg-slate-800/50 border-2 border-cyan-500/50 text-cyan-400 py-5 rounded-2xl flex items-center justify-center gap-2 hover:bg-cyan-500/10 hover:border-cyan-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-lg",children:[e.jsx(ie,{className:"w-6 h-6"}),f?"처리 중...":"요청 보내기"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500/20 to-purple-500/20 rounded-xl blur"}),e.jsxs("div",{className:"relative bg-slate-800/50 border border-cyan-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(be,{className:"w-5 h-5 text-cyan-400 shrink-0 mt-0.5"}),e.jsx("h3",{className:"text-cyan-400",children:"이용 안내"})]}),e.jsxs("ul",{className:"space-y-2 text-slate-300 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"•"}),e.jsx("span",{children:"요청 후 관리자 승인이 필요합니다"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"•"}),e.jsx("span",{children:"승인되면 자동으로 지갑에 입금됩니다"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"•"}),e.jsx("span",{children:"단축 버튼을 여러 번 눌러 원하는 금액을 만드세요"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-cyan-400 shrink-0",children:"•"}),e.jsx("span",{children:"거부된 경우 사유를 확인하세요"})]})]})]})]})]})]})}function nt({onNavigate:t}){const{user:s}=K(),[i,b]=r.useState(""),[o,h]=r.useState(""),[y,v]=r.useState(""),[k,f]=r.useState(""),[l,m]=r.useState(""),[g,j]=r.useState(!1),[d,C]=r.useState(null),[x,n]=r.useState(!0);r.useEffect(()=>{_();const S=p.channel("user_verification_changes").on("postgres_changes",{event:"*",schema:"public",table:"account_verifications",filter:`user_id=eq.${s?.id}`},D=>{console.log("Verification status changed:",D),_(),D.new?.status==="code_sent"&&N.success("통장 인증을 확인해주세요!")}).subscribe();return()=>{p.removeChannel(S)}},[s]);const _=async()=>{if(s)try{const{data:S,error:D}=await p.from("account_verifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(1).single();if(D&&D.code!=="PGRST116")throw D;S&&C(S)}catch(S){console.error("Verification status fetch error:",S)}finally{n(!1)}},I=async()=>{if(!i||!o||!y){N.error("모든 필수 정보를 입력해주세요");return}if(!/^\d{10,14}$/.test(o.replace(/-/g,""))){N.error("올바른 계좌번호 형식이 아닙니다");return}j(!0);try{const{error:S}=await p.from("account_verifications").insert({user_id:s?.id,bank_name:i,account_number:o.replace(/-/g,""),account_holder:y,verification_code:k||null,status:"pending"});if(S)throw S;N.success("1원 계좌인증 신청이 완료되었습니다"),await _(),b(""),h(""),v(""),f("")}catch(S){console.error("Verification submit error:",S),N.error("신청 중 오류가 발생했습니다")}finally{j(!1)}},a=async()=>{if(!l.trim()){N.error("인증 코드를 입력해주세요");return}if(d){j(!0);try{const{error:S}=await p.from("account_verifications").update({user_input_code:l.trim(),status:"code_submitted"}).eq("verification_id",d.verification_id);if(S)throw S;N.success("인증 코드가 제출되었습니다. 관리자 확인을 기다려주세요."),await _(),m("")}catch(S){console.error("Code submit error:",S),N.error("코드 제출 중 오류가 발생했습니다")}finally{j(!1)}}},w=S=>{switch(S){case"verified":return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-green-500/20 border border-green-500/30",children:[e.jsx(se,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-green-400",children:"인증 완료"})]});case"code_submitted":return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-cyan-500/20 border border-cyan-500/30",children:[e.jsx(de,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-cyan-400",children:"승인 요청"})]});case"code_sent":return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/20 border border-purple-500/30",children:[e.jsx(be,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"text-purple-400",children:"코드 확인 필요"})]});case"pending":return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-yellow-500/20 border border-yellow-500/30",children:[e.jsx(de,{className:"w-5 h-5 text-yellow-400"}),e.jsx("span",{className:"text-yellow-400",children:"검토 중"})]});case"rejected":return e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/20 border border-red-500/30",children:[e.jsx(le,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400",children:"거부됨"})]});default:return null}};return x?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-slate-400",children:"로딩 중..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>t("settings"),className:"w-10 h-10 rounded-full bg-slate-800/50 border border-cyan-500/30 flex items-center justify-center hover:bg-cyan-500/10 transition-colors",children:e.jsx(je,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-white",children:"1원 계좌인증"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"KYC 대신 계좌인증으로 간편하게"})]})]}),d&&e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500/30 to-purple-500/30 rounded-2xl blur"}),e.jsxs("div",{className:"relative bg-slate-800/90 border border-cyan-500/50 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white",children:"인증 상태"}),w(d.status)]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"은행"}),e.jsx("span",{className:"text-white",children:d.bank_name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"계좌번호"}),e.jsx("span",{className:"text-white",children:d.account_number})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"예금주"}),e.jsx("span",{className:"text-white",children:d.account_holder})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"신청일"}),e.jsx("span",{className:"text-white",children:new Date(d.created_at).toLocaleDateString("ko-KR")})]}),d.status==="verified"&&d.smart_account_address&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"pt-3 border-t border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-cyan-400 text-sm",children:"Smart Account"})]}),e.jsx("div",{className:"bg-slate-900/50 rounded-lg p-3",children:e.jsx("p",{className:"text-slate-300 text-xs break-all font-mono",children:d.smart_account_address})})]}),e.jsx("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-green-400 text-sm",children:"✅ 코인 지갑이 자동으로 생성되었습니다!"})})]}),d.status==="rejected"&&d.rejection_reason&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-400 text-sm mb-1",children:"거부 사유:"}),e.jsx("p",{className:"text-slate-300 text-sm",children:d.rejection_reason})]}),d.status==="pending"&&e.jsx("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-yellow-400 text-sm",children:"⏳ 관리자 검토 중입니다. 잠시만 기다려주세요."})}),d.status==="code_sent"&&e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-purple-400 text-sm mb-2",children:"📬 통장을 확인해주세요!"}),e.jsx("p",{className:"text-slate-300 text-sm",children:"1원이 입금되었습니다. 입금자명을 확인하고 아래에 입력해주세요."})]}),d.status==="code_submitted"&&e.jsx("div",{className:"bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-3",children:e.jsx("p",{className:"text-cyan-400 text-sm",children:"✅ 인증 코드가 제출되었습니다. 관리자가 확인 중입니다."})})]})]})]}),(!d||d.status==="rejected")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"은행 선택"}),e.jsxs("select",{value:i,onChange:S=>b(S.target.value),className:"w-full bg-slate-800/50 border border-cyan-500/30 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-cyan-500 transition-colors",children:[e.jsx("option",{value:"",children:"은행을 선택하세요"}),e.jsx("option",{value:"KB국민은행",children:"KB국민은행"}),e.jsx("option",{value:"신한은행",children:"신한은행"}),e.jsx("option",{value:"우리은행",children:"우리은행"}),e.jsx("option",{value:"하나은행",children:"하나은행"}),e.jsx("option",{value:"NH농협은행",children:"NH농협은행"}),e.jsx("option",{value:"IBK기업은행",children:"IBK기업은행"}),e.jsx("option",{value:"SC제일은행",children:"SC제일은행"}),e.jsx("option",{value:"카카오뱅크",children:"카카오뱅크"}),e.jsx("option",{value:"토스뱅크",children:"토스뱅크"}),e.jsx("option",{value:"케이뱅크",children:"케이뱅크"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"계좌번호"}),e.jsx("input",{type:"text",value:o,onChange:S=>h(S.target.value),placeholder:"123-456-789012",className:"w-full bg-slate-800/50 border border-cyan-500/30 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"예금주명"}),e.jsx("input",{type:"text",value:y,onChange:S=>v(S.target.value),placeholder:"홍길동",className:"w-full bg-slate-800/50 border border-cyan-500/30 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500 transition-colors"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-slate-300 mb-3",children:["입금자명 (선택사항)",e.jsx("span",{className:"text-slate-500 text-sm ml-2",children:"관리자가 1원 입금 시 사용"})]}),e.jsx("input",{type:"text",value:k,onChange:S=>f(S.target.value),placeholder:"예: 홍길동123",className:"w-full bg-slate-800/50 border border-cyan-500/30 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500 transition-colors"})]})]}),e.jsxs("button",{onClick:I,disabled:g||!i||!o||!y,className:"w-full bg-slate-800/50 border-2 border-cyan-500/50 text-cyan-400 py-5 rounded-2xl flex items-center justify-center gap-2 hover:bg-cyan-500/10 hover:border-cyan-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-lg",children:[e.jsx(ie,{className:"w-6 h-6"}),g?"신청 중...":d?.status==="rejected"?"재신청하기":"인증 신청"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-purple-500/20 to-cyan-500/20 rounded-xl blur"}),e.jsxs("div",{className:"relative bg-slate-800/50 border border-purple-500/30 rounded-xl p-4",children:[e.jsx("h4",{className:"text-purple-400 mb-3",children:"인증 절차"}),e.jsxs("ol",{className:"space-y-2 text-slate-300 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 shrink-0",children:"1."}),e.jsx("span",{children:"계좌 정보를 입력하고 신청"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 shrink-0",children:"2."}),e.jsx("span",{children:"관리자가 해당 계좌로 1원 입금 (입금자명 확인용)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 shrink-0",children:"3."}),e.jsx("span",{children:"관리자가 계좌 확인 후 승인"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-purple-400 shrink-0",children:"4."}),e.jsx("span",{className:"text-cyan-400",children:"Smart Account 자동 생성 및 지갑 활성화 ✨"})]})]})]})]})]}),d&&d.status==="code_sent"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-3",children:"인증 코드 입력"}),e.jsx("input",{type:"text",value:l,onChange:S=>m(S.target.value),placeholder:"인증 코드 입력",className:"w-full bg-slate-800/50 border border-cyan-500/30 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500 transition-colors"})]})}),e.jsxs("button",{onClick:a,disabled:g||!l.trim(),className:"w-full bg-slate-800/50 border-2 border-cyan-500/50 text-cyan-400 py-5 rounded-2xl flex items-center justify-center gap-2 hover:bg-cyan-500/10 hover:border-cyan-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-lg",children:[e.jsx(ie,{className:"w-6 h-6"}),g?"제출 중...":"인증 코드 제출"]})]})]})}function ct({currentScreen:t,onNavigate:s}){return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-slate-900/95 backdrop-blur-xl border-t border-cyan-500/20 z-20",children:e.jsxs("div",{className:"grid grid-cols-4 gap-1 p-2",children:[e.jsxs("button",{onClick:()=>s("home"),className:`flex flex-col items-center gap-1 py-3 rounded-lg transition-all ${t==="home"?"text-cyan-400":"text-slate-400 hover:text-cyan-300"}`,children:[e.jsx(js,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"홈"})]}),e.jsxs("button",{onClick:()=>s("wallets"),className:`flex flex-col items-center gap-1 py-3 rounded-lg transition-all ${t==="wallets"||t==="wallet-detail"?"text-cyan-400":"text-slate-400 hover:text-cyan-300"}`,children:[e.jsx(te,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"지갑"})]}),e.jsxs("button",{onClick:()=>s("transactions"),className:`flex flex-col items-center gap-1 py-3 rounded-lg transition-all ${t==="transactions"?"text-cyan-400":"text-slate-400 hover:text-cyan-300"}`,children:[e.jsx(fs,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"거래"})]}),e.jsxs("button",{onClick:()=>s("settings"),className:`flex flex-col items-center gap-1 py-3 rounded-lg transition-all ${t==="settings"?"text-cyan-400":"text-slate-400 hover:text-cyan-300"}`,children:[e.jsx(Be,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:"더보기"})]})]})})}function Ge(t,s=!1){const[i,b]=r.useState([]);r.useEffect(()=>{if(!t)return;const l=`notifications_${t}`,m=localStorage.getItem(l);if(m)try{const g=JSON.parse(m);b(g)}catch(g){console.error("Failed to parse notifications:",g)}},[t]);const o=r.useCallback(l=>{if(!t)return;const m=`notifications_${t}`,g=l.slice(0,100);localStorage.setItem(m,JSON.stringify(g)),b(g)},[t]),h=r.useCallback(l=>{const m={...l,id:`${Date.now()}_${Math.random()}`,created_at:new Date().toISOString()};b(g=>{const j=[m,...g];return o(j),j});try{const g=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHGS57OihUhELTKXh8bllHAU2jdXzzn0pBSl+zPLaizsIGGK37OihUhEMUKjj8bllHAU2jdXzzn0pBSh+zPLaizsIG2G37OihUhEMUKjj8bllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihUxELT6jj8rllHAU1jdXzzn0pBSh+zPLaizsIG2G37OihU");g.volume=.2,g.play().catch(()=>{})}catch{}},[o]);r.useEffect(()=>{if(!t||!s)return;const l=[],m=p.channel("admin-signups").on("postgres_changes",{event:"INSERT",schema:"public",table:"auth_users"},d=>{h({user_id:t,type:"signup",title:"새 회원 가입",message:`${d.new.username||d.new.email}님이 가입했습니다.`,read:!1,data:d.new})}).subscribe();l.push(m);const g=p.channel("admin-verifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"account_verifications",filter:"status=eq.pending"},d=>{h({user_id:t,type:"verification_request",title:"1원 인증 요청",message:"새로운 계좌 인증 요청이 있습니다.",read:!1,data:d.new})}).subscribe();l.push(g);const j=p.channel("admin-purchases").on("postgres_changes",{event:"INSERT",schema:"public",table:"transfer_requests",filter:"status=eq.pending"},d=>{h({user_id:t,type:"purchase_request",title:"새 구매 요청",message:`${d.new.coin_type} ${d.new.amount.toLocaleString()}원 구매 요청`,read:!1,data:d.new})}).subscribe();return l.push(j),()=>{l.forEach(d=>p.removeChannel(d))}},[t,s,h]),r.useEffect(()=>{if(!t||s)return;const l=[],m=p.channel("user-verifications").on("postgres_changes",{event:"UPDATE",schema:"public",table:"account_verifications",filter:`user_id=eq.${t}`},j=>{j.new.status==="approved"?h({user_id:t,type:"verification_approved",title:"계좌 인증 완료",message:"1원 인증이 승인되었습니다. 이제 모든 기능을 사용할 수 있습니다.",read:!1,data:j.new}):j.new.status==="rejected"&&h({user_id:t,type:"verification_rejected",title:"계좌 인증 거절",message:`인증이 거절되었습니다. 사유: ${j.new.rejection_reason||"확인 필요"}`,read:!1,data:j.new})}).subscribe();l.push(m);const g=p.channel("user-purchases").on("postgres_changes",{event:"UPDATE",schema:"public",table:"transfer_requests",filter:`from_user_id=eq.${t}`},j=>{j.new.status==="approved"?h({user_id:t,type:"purchase_approved",title:"구매 승인",message:`${j.new.coin_type} ${j.new.amount.toLocaleString()}원 구매가 승인되었습니다.`,read:!1,data:j.new}):j.new.status==="completed"?h({user_id:t,type:"purchase_completed",title:"구매 완료",message:`${j.new.coin_type} ${j.new.amount.toLocaleString()}원 구매가 완료되었습니다.`,read:!1,data:j.new}):j.new.status==="rejected"&&h({user_id:t,type:"purchase_rejected",title:"구매 거절",message:`구매 요청이 거절되었습니다. 사유: ${j.new.rejection_reason||"확인 필요"}`,read:!1,data:j.new})}).subscribe();return l.push(g),()=>{l.forEach(j=>p.removeChannel(j))}},[t,s,h]);const y=r.useCallback(async l=>{b(m=>{const g=m.map(j=>j.id===l?{...j,read:!0}:j);return o(g),g})},[o]),v=r.useCallback(async()=>{b(l=>{const m=l.map(g=>({...g,read:!0}));return o(m),m})},[o]),k=r.useCallback(l=>{b(m=>{const g=m.filter(j=>j.id!==l);return o(g),g})},[o]),f=i.filter(l=>!l.read).length;return{notifications:i,unreadCount:f,markAsRead:y,markAllAsRead:v,clearNotification:k}}function os({userId:t,isAdmin:s=!1,categoryFilter:i=null}){const[b,o]=r.useState(!1),h=r.useRef(null),{notifications:y,unreadCount:v,markAsRead:k,markAllAsRead:f,clearNotification:l}=Ge(t,s),m=i?y.filter(x=>i==="signup"?x.type==="signup":i==="verification"?x.type.includes("verification"):i==="purchase"?x.type.includes("purchase"):!0):y,g=i?m.filter(x=>!x.read).length:v;r.useEffect(()=>{const x=n=>{h.current&&!h.current.contains(n.target)&&o(!1)};return b&&document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[b]);const j=x=>{switch(x){case"signup":return e.jsx(as,{className:"w-5 h-5 text-green-400"});case"verification_request":case"verification_approved":case"verification_rejected":return e.jsx(ts,{className:"w-5 h-5 text-blue-400"});case"purchase_request":case"purchase_approved":case"purchase_completed":case"purchase_rejected":return e.jsx(Se,{className:"w-5 h-5 text-purple-400"});default:return e.jsx(Ie,{className:"w-5 h-5 text-cyan-400"})}},d=x=>x.includes("rejected")?"border-red-500/30 bg-red-500/5":x.includes("approved")||x.includes("completed")?"border-green-500/30 bg-green-500/5":x.includes("request")?"border-yellow-500/30 bg-yellow-500/5":"border-cyan-500/30 bg-cyan-500/5",C=x=>{const n=new Date(x),I=new Date().getTime()-n.getTime(),a=Math.floor(I/6e4),w=Math.floor(I/36e5),S=Math.floor(I/864e5);return a<1?"방금 전":a<60?`${a}분 전`:w<24?`${w}시간 전`:S<7?`${S}일 전`:n.toLocaleDateString("ko-KR",{month:"short",day:"numeric"})};return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{onClick:()=>o(!b),className:"relative p-2 text-slate-400 hover:text-cyan-400 transition-all duration-200","aria-label":"알림",style:{filter:b?"drop-shadow(0 0 5px rgba(6, 182, 212, 0.8))":""},children:[e.jsx(Ie,{className:`w-5 h-5 ${b?"text-cyan-400":""}`}),g>0&&e.jsx("span",{className:"absolute top-1 right-1 min-w-[18px] h-[18px] px-1 bg-red-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse",style:{boxShadow:"0 0 10px rgba(239, 68, 68, 0.8)"},children:g>99?"99+":g})]}),b&&e.jsxs("div",{className:"absolute right-0 top-12 w-96 max-h-[600px] rounded-lg overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",style:{zIndex:99999,background:"linear-gradient(135deg, rgba(15, 23, 42, 0.98) 0%, rgba(30, 41, 59, 0.98) 100%)",border:"1px solid rgba(6, 182, 212, 0.3)",boxShadow:"0 0 30px rgba(6, 182, 212, 0.4), inset 0 0 20px rgba(6, 182, 212, 0.05)"},children:[e.jsxs("div",{className:"p-4 border-b border-cyan-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-slate-200",children:["알림 ",e.jsxs("span",{className:"text-cyan-400",children:["(",g,")"]})]}),e.jsx("button",{onClick:()=>o(!1),className:"text-slate-400 hover:text-slate-200 transition-colors","aria-label":"닫기",children:e.jsx(ge,{className:"w-5 h-5"})})]}),g>0&&e.jsxs("button",{onClick:f,className:"flex items-center gap-1 text-sm text-cyan-400 hover:text-cyan-300 transition-colors",children:[e.jsx(ys,{className:"w-4 h-4"}),"모두 읽음으로 표시"]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[500px] custom-scrollbar",children:m.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"알림이 없습니다"})]}):e.jsx("div",{className:"divide-y divide-slate-700/50",children:m.map(x=>e.jsx("div",{className:`p-4 hover:bg-slate-800/50 transition-colors cursor-pointer ${x.read?"":"bg-cyan-500/5"}`,onClick:()=>k(x.id),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-lg border ${d(x.type)} flex items-center justify-center`,children:j(x.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:`text-sm ${x.read?"text-slate-400":"text-slate-200"}`,children:x.title}),!x.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400 flex-shrink-0 mt-1",style:{boxShadow:"0 0 6px rgba(6, 182, 212, 0.8)"}})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 line-clamp-2",children:x.message}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-slate-500",children:C(x.created_at)}),e.jsx("button",{onClick:n=>{n.stopPropagation(),l(x.id)},className:"text-slate-500 hover:text-red-400 transition-colors","aria-label":"삭제",children:e.jsx(ge,{className:"w-3 h-3"})})]})]})]})},x.id))})}),m.length>0&&e.jsx("div",{className:"p-3 border-t border-cyan-500/20 text-center",children:e.jsx("button",{onClick:()=>{m.forEach(x=>l(x.id))},className:"text-sm text-slate-400 hover:text-red-400 transition-colors",children:"모든 알림 지우기"})})]})]})}function it({currentScreen:t}){const{user:s}=K();Ge(s?.id,!1);const i=()=>{switch(t){case"home":return"홈";case"wallets":return"내 지갑";case"wallet-detail":return"지갑 상세";case"deposit":return"입금";case"withdrawal":return"출금";case"swap":return"스왑";case"transactions":return"거래 내역";case"settings":return"설정";case"transfer-request":return"전송 요청";case"coin-purchase":return"코인 구매";case"account-verification":return"계좌 인증";default:return""}};return e.jsx("div",{className:"sticky top-0 bg-slate-900/95 backdrop-blur-xl border-b border-cyan-500/20 p-4 z-10",style:{zIndex:9999},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{window.location.hash="#admin/login"},className:"w-8 h-8 rounded-lg bg-slate-800 border border-cyan-500/50 flex items-center justify-center hover:border-cyan-400 transition-all active:scale-95",style:{boxShadow:"0 0 10px rgba(6, 182, 212, 0.3), inset 0 0 10px rgba(6, 182, 212, 0.1)"},children:e.jsx(te,{className:"w-5 h-5 text-cyan-400",style:{filter:"drop-shadow(0 0 2px rgba(6, 182, 212, 0.8))"}})}),e.jsx("span",{className:"text-white",children:i()})]}),s?.id&&e.jsx(os,{userId:s.id,isAdmin:!1})]})})}function Ze(){const[t,s]=r.useState(""),[i,b]=r.useState(""),[o,h]=r.useState(!1),[y,v]=r.useState(!1),[k,f]=r.useState(!1),[l,m]=r.useState(!1),[g,j]=r.useState({username:"",email:"",password:"",confirmPassword:""}),{login:d}=K(),C=async n=>{n.preventDefault(),v(!0);try{const _=await d(t,i);if(_&&_.role==="admin"){N.error("관리자는 사용자 페이지에 로그인할 수 없습니다"),v(!1);return}k?(localStorage.setItem("rememberMe","true"),localStorage.setItem("savedEmail",t)):(localStorage.removeItem("rememberMe"),localStorage.removeItem("savedEmail")),N.success("로그인 성공! 환영합니다 🎉")}catch(_){N.error(_ instanceof Error?_.message:"로그인에 실패했습니다")}finally{v(!1)}},x=async n=>{if(n.preventDefault(),g.password!==g.confirmPassword){N.error("비밀번호가 일치하지 않습니다");return}if(g.password.length<8){N.error("비밀번호는 8자 이상이어야 합니다");return}try{const{data:_}=await p.from("users").select("email").eq("email",g.email).single();if(_)throw new Error("이미 사용 중인 이메일입니다");const I=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,{error:a}=await p.from("users").insert({user_id:I,email:g.email,username:g.username,password_hash:g.password,role:"user",level:1,total_purchase:0,total_withdrawal:0,created_at:new Date().toISOString()});if(a)throw a;N.success("회원가입이 완료되었습니다! 로그인해주세요"),m(!1),j({username:"",email:"",password:"",confirmPassword:""})}catch(_){console.error("Sign up error:",_),N.error(_.message||"회원가입 중 오류가 발생했습니다")}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 flex flex-col",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}})]}),e.jsxs("div",{className:"relative flex-1 flex flex-col items-center justify-center p-6",children:[e.jsxs("div",{className:"text-center mb-10 animate-fade-in",children:[e.jsxs("div",{className:"relative inline-block mb-5",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-cyan-400 to-purple-500 rounded-2xl blur-lg opacity-40 animate-pulse"}),e.jsx("div",{className:"relative w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-400 to-purple-500 flex items-center justify-center shadow-xl",children:e.jsx(fe,{className:"w-8 h-8 text-white"})})]}),e.jsx("h1",{className:"text-2xl text-white mb-1.5 tracking-tight",children:"GMS Wallet"}),e.jsxs("p",{className:"text-slate-400 text-sm flex items-center justify-center gap-1.5",children:[e.jsx(Ns,{className:"w-3.5 h-3.5 text-cyan-400"}),e.jsx("span",{children:"안전하고 쉬운 암호화폐 관리"})]})]}),e.jsxs("div",{className:"w-full max-w-sm",children:[e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-slate-300 text-xs pl-0.5",children:"이메일"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-500 z-10"}),e.jsx("input",{type:"email",value:t,onChange:n=>s(n.target.value),className:"w-full bg-slate-900/60 border border-slate-700/50 rounded-xl pl-11 pr-4 py-3.5 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 focus:bg-slate-900/80 transition-all",placeholder:"이메일을 입력하세요",required:!0})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"block text-slate-300 text-xs pl-0.5",children:"비밀번호"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-500 z-10"}),e.jsx("input",{type:o?"text":"password",value:i,onChange:n=>b(n.target.value),className:"w-full bg-slate-900/60 border border-slate-700/50 rounded-xl pl-11 pr-11 py-3.5 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 focus:bg-slate-900/80 transition-all",placeholder:"비밀번호를 입력하세요",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!o),className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-slate-500 hover:text-cyan-400 transition-colors",children:o?e.jsx(Pe,{className:"w-4.5 h-4.5"}):e.jsx(pe,{className:"w-4.5 h-4.5"})})]})]}),e.jsx("div",{className:"flex items-center text-xs pt-0.5",children:e.jsxs("label",{className:"flex items-center gap-2 text-slate-400 cursor-pointer hover:text-slate-300 transition-colors",children:[e.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5 rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500/20 focus:ring-offset-0",checked:k,onChange:n=>f(n.target.checked)}),e.jsx("span",{children:"로그인 유지"})]})}),e.jsx("button",{type:"submit",disabled:y,className:"w-full bg-slate-900/50 border border-cyan-500 text-cyan-400 py-3.5 rounded-xl hover:bg-cyan-500/10 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm font-medium mt-6 active:scale-[0.99]",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"로그인 중..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4"}),e.jsx("span",{children:"로그인"})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-slate-400 text-xs",children:["계정이 없으신가요?"," ",e.jsx("button",{className:"text-cyan-400 hover:text-cyan-300 transition-colors font-medium",onClick:()=>m(!0),children:"회원가입"})]})}),e.jsxs("div",{className:"mt-8 flex items-center justify-center gap-2 text-xs text-slate-500",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400/50 animate-pulse"}),e.jsx("span",{children:"256-bit SSL 보안 연결"})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md z-50 flex items-center justify-center p-6 animate-fade-in overflow-y-auto",onClick:()=>m(!1),children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700/50 rounded-2xl p-6 w-full max-w-sm shadow-2xl my-6",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h2",{className:"text-lg text-white",children:"회원가입"}),e.jsx("button",{onClick:()=>m(!1),className:"text-slate-400 hover:text-white transition-colors p-1 hover:bg-slate-800 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-xs mb-1.5",children:"사용자명"}),e.jsx("input",{type:"text",value:g.username,onChange:n=>j({...g,username:n.target.value}),className:"w-full bg-slate-800/60 border border-slate-700/50 rounded-xl px-4 py-3.5 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 focus:bg-slate-800/80 transition-all",placeholder:"사용자명을 입력하세요",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-xs mb-1.5",children:"이메일"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-500 z-10"}),e.jsx("input",{type:"email",value:g.email,onChange:n=>j({...g,email:n.target.value}),className:"w-full bg-slate-800/60 border border-slate-700/50 rounded-xl pl-11 pr-4 py-3.5 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 focus:bg-slate-800/80 transition-all",placeholder:"이메일을 입력하세요",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-xs mb-1.5",children:"비밀번호"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-500 z-10"}),e.jsx("input",{type:"password",value:g.password,onChange:n=>j({...g,password:n.target.value}),className:"w-full bg-slate-800/60 border border-slate-700/50 rounded-xl pl-11 pr-4 py-3.5 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 focus:bg-slate-800/80 transition-all",placeholder:"비밀번호 (8자 이상)",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 text-xs mb-1.5",children:"비밀번호 확인"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-4.5 h-4.5 text-slate-500 z-10"}),e.jsx("input",{type:"password",value:g.confirmPassword,onChange:n=>j({...g,confirmPassword:n.target.value}),className:"w-full bg-slate-800/60 border border-slate-700/50 rounded-xl pl-11 pr-4 py-3.5 text-white text-sm placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 focus:bg-slate-800/80 transition-all",placeholder:"비밀번호 확인",required:!0})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-slate-900/50 border border-cyan-500 text-cyan-400 py-3.5 rounded-xl hover:bg-cyan-500/10 transition-all duration-200 text-sm font-medium flex items-center justify-center gap-2 active:scale-[0.99] mt-2",children:"회원가입"})]})]})}),e.jsx("style",{children:`
        @keyframes fade-in {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .animate-fade-in {
          animation: fade-in 0.3s ease-out;
        }

        /* Touch feedback */
        button:active {
          transform: scale(0.98);
        }

        /* Smooth transitions */
        * {
          -webkit-tap-highlight-color: transparent;
        }

        /* Custom checkbox */
        input[type="checkbox"]:checked {
          background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
      `})]})}function ot(){const{user:t}=K(),[s,i]=r.useState("home"),[b,o]=r.useState([]),[h,y]=r.useState("BTC"),[v,k]=r.useState([]),[f,l]=r.useState(!0);r.useEffect(()=>{t&&t.role==="user"?(m(),g(),We()):l(!1)},[t]);const m=async()=>{const{data:j,error:d}=await p.from("wallets").select("*").eq("user_id",t?.id);!d&&j&&o(j),l(!1)},g=async()=>{const{data:j}=await p.from("deposits").select("*").eq("user_id",t?.id).order("created_at",{ascending:!1}).limit(20),{data:d}=await p.from("withdrawals").select("*").eq("user_id",t?.id).order("created_at",{ascending:!1}).limit(20),C=[...(j||[]).map(x=>({id:x.deposit_id,type:"deposit",coin_type:x.coin_type,amount:parseFloat(x.amount),status:x.status,created_at:x.created_at})),...(d||[]).map(x=>({id:x.withdrawal_id,type:"withdrawal",coin_type:x.coin_type,amount:parseFloat(x.amount),status:x.status,created_at:x.created_at}))].sort((x,n)=>new Date(n.created_at).getTime()-new Date(x.created_at).getTime());k(C)};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"})}):t?t.role==="admin"?e.jsx(Ze,{}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative max-w-md mx-auto min-h-screen bg-slate-900/30 backdrop-blur-xl border-x border-slate-700/50",children:[e.jsx(it,{currentScreen:s}),e.jsxs("div",{className:"p-4 pb-24 overflow-y-auto",children:[s==="home"&&e.jsx(Bs,{wallets:b,transactions:v,onNavigate:i,onSelectCoin:y}),s==="wallets"&&e.jsx(qs,{wallets:b,onNavigate:i,onSelectCoin:y}),s==="wallet-detail"&&e.jsx(Ms,{wallets:b,transactions:v,selectedCoin:h,onNavigate:i}),s==="deposit"&&e.jsx(Os,{wallets:b,selectedCoin:h,onNavigate:i,onSelectCoin:y}),s==="withdrawal"&&e.jsx(Hs,{wallets:b,selectedCoin:h,onNavigate:i,onSelectCoin:y}),s==="swap"&&e.jsx(st,{wallets:b,selectedCoin:h,onNavigate:i,onSelectCoin:y}),s==="transactions"&&e.jsx(Xs,{transactions:v,onNavigate:i}),s==="settings"&&e.jsx(tt,{onNavigate:i}),s==="transfer-request"&&e.jsx(at,{wallets:b,selectedCoin:h,onNavigate:i,onSelectCoin:y}),s==="coin-purchase"&&e.jsx(lt,{wallets:b,selectedCoin:h,onNavigate:i,onSelectCoin:y}),s==="account-verification"&&e.jsx(nt,{onNavigate:i})]})]}),e.jsx(ct,{currentScreen:s,onNavigate:i})]}):e.jsx(Ze,{})}function oe({children:t,className:s=""}){return e.jsxs("div",{className:`relative group ${s}`,children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsx("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-cyan-500/30 rounded-lg p-6",children:t})]})}function dt({title:t,value:s,change:i,trend:b,icon:o,color:h}){const y={cyan:"from-cyan-500 to-blue-500",green:"from-green-500 to-emerald-500",purple:"from-purple-500 to-pink-500",amber:"from-amber-500 to-orange-500"},v={cyan:"text-cyan-400",green:"text-green-400",purple:"text-purple-400",amber:"text-amber-400"},k={cyan:"bg-cyan-500/20",green:"bg-green-500/20",purple:"bg-purple-500/20",amber:"bg-amber-500/20"};return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:`absolute -inset-0.5 bg-gradient-to-r ${y[h]} rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity`}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-6 hover:border-cyan-500/30 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg ${k[h]} flex items-center justify-center`,children:e.jsx(o,{className:`w-6 h-6 ${v[h]}`})}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${b==="up"?"bg-green-500/20 text-green-400":b==="down"?"bg-red-500/20 text-red-400":"bg-amber-500/20 text-amber-400"}`,children:i})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:t}),e.jsx("p",{className:`text-2xl ${v[h]}`,children:s})]})]})]})}function xt(){const[t,s]=r.useState({totalUsers:0,todayDeposits:0,todayWithdrawals:0,pendingApprovals:0,depositChange:0,withdrawalChange:0,userChange:0}),[i,b]=r.useState([]),[o,h]=r.useState({hotWallet:0,coldWallet:0,total:0}),[y,v]=r.useState(!1);r.useEffect(()=>{k();const a=p.channel("dashboard-changes").on("postgres_changes",{event:"*",schema:"public",table:"withdrawals"},()=>{k()}).on("postgres_changes",{event:"*",schema:"public",table:"deposits"},()=>{k()}).on("postgres_changes",{event:"*",schema:"public",table:"users"},()=>{k()}).subscribe();return()=>{p.removeChannel(a)}},[]);const k=async()=>{try{await Promise.all([f(),l(),m(),g()])}catch(a){console.error("Dashboard data fetch error:",a)}finally{v(!1)}},f=async()=>{const{count:a}=await p.from("users").select("*",{count:"exact",head:!0}).eq("role","user"),w=new Date;w.setMonth(w.getMonth()-1);const{count:S}=await p.from("users").select("*",{count:"exact",head:!0}).eq("role","user").lte("created_at",w.toISOString()),D=a&&S?((a-S)/S*100).toFixed(1):0;s(B=>({...B,totalUsers:a||0,userChange:Number(D)}))},l=async()=>{const a=new Date;a.setHours(0,0,0,0);const w=new Date(a);w.setDate(w.getDate()-1);const{data:S}=await p.from("deposits").select("amount").eq("status","confirmed").gte("created_at",a.toISOString()),D=S?.reduce((A,H)=>A+Number(H.amount),0)||0,{data:B}=await p.from("deposits").select("amount").eq("status","confirmed").gte("created_at",w.toISOString()).lt("created_at",a.toISOString()),V=B?.reduce((A,H)=>A+Number(H.amount),0)||0,P=V>0?((D-V)/V*100).toFixed(1):0,{data:T}=await p.from("withdrawals").select("amount").in("status",["completed","processing"]).gte("created_at",a.toISOString()),u=T?.reduce((A,H)=>A+Number(H.amount),0)||0,{data:F}=await p.from("withdrawals").select("amount").in("status",["completed","processing"]).gte("created_at",w.toISOString()).lt("created_at",a.toISOString()),$=F?.reduce((A,H)=>A+Number(H.amount),0)||0,G=$>0?((u-$)/$*100).toFixed(1):0,{count:c}=await p.from("withdrawals").select("*",{count:"exact",head:!0}).eq("status","pending"),{count:L}=await p.from("deposits").select("*",{count:"exact",head:!0}).eq("status","pending"),R=(c||0)+(L||0);s(A=>({...A,todayDeposits:D,todayWithdrawals:u,pendingApprovals:R,depositChange:Number(P),withdrawalChange:Number(G)}))},m=async()=>{const{data:a}=await p.from("deposits").select(`
        deposit_id,
        coin_type,
        amount,
        status,
        created_at,
        users!inner(username)
      `).order("created_at",{ascending:!1}).limit(3),{data:w}=await p.from("withdrawals").select(`
        withdrawal_id,
        coin_type,
        amount,
        status,
        created_at,
        users!inner(username)
      `).order("created_at",{ascending:!1}).limit(3),S=[...a?.map(D=>({id:D.deposit_id,user:{username:D.users.username},type:"deposit",coin_type:D.coin_type,amount:Number(D.amount),status:D.status,created_at:D.created_at}))||[],...w?.map(D=>({id:D.withdrawal_id,user:{username:D.users.username},type:"withdrawal",coin_type:D.coin_type,amount:Number(D.amount),status:D.status,created_at:D.created_at}))||[]].sort((D,B)=>new Date(B.created_at).getTime()-new Date(D.created_at).getTime()).slice(0,5);b(S)},g=async()=>{const{data:a}=await p.from("wallets").select("balance").eq("wallet_type","hot"),w=a?.reduce((V,P)=>V+Number(P.balance),0)||0,{data:S}=await p.from("wallets").select("balance").eq("wallet_type","cold"),D=S?.reduce((V,P)=>V+Number(P.balance),0)||0,B=w+D;h({hotWallet:w,coldWallet:D,total:B})},j=a=>`₩${a.toLocaleString("ko-KR",{maximumFractionDigits:0})}`,d=a=>a>=1e9?`${(a/1e9).toFixed(1)}B`:a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toFixed(2),C=a=>{const w=new Date().getTime(),S=new Date(a).getTime(),D=Math.floor((w-S)/1e3/60);return D<1?"방금 전":D<60?`${D}분 전`:D<1440?`${Math.floor(D/60)}시간 전`:`${Math.floor(D/1440)}일 전`},x=a=>({confirmed:"완료",completed:"완료",pending:"대기",processing:"처리중",failed:"실패",rejected:"거부됨"})[a]||a,n=[{title:"총 사용자",value:t.totalUsers.toLocaleString(),change:`${t.userChange>=0?"+":""}${t.userChange}%`,trend:t.userChange>=0?"up":"down",icon:qe,color:"cyan"},{title:"오늘 입금",value:j(t.todayDeposits),change:`${t.depositChange>=0?"+":""}${t.depositChange}%`,trend:t.depositChange>=0?"up":"down",icon:Fe,color:"green"},{title:"오늘 출금",value:j(t.todayWithdrawals),change:`${t.withdrawalChange>=0?"+":""}${t.withdrawalChange}%`,trend:t.withdrawalChange>=0?"up":"down",icon:vs,color:"purple"},{title:"대기 승인",value:t.pendingApprovals.toString(),change:"처리 필요",trend:"warning",icon:we,color:"amber"}],_=o.total>0?Math.round(o.hotWallet/o.total*100):0,I=o.total>0?Math.round(o.coldWallet/o.total*100):0;return y?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-cyan-400 mb-1",children:"시스템 대시보드"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"실시간 운영 현황 모니터링"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:n.map((a,w)=>e.jsx(dt,{...a},w))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(oe,{className:"lg:col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-slate-200",children:"최근 거래"})]}),e.jsx("button",{className:"text-cyan-400 text-sm hover:text-cyan-300 transition-colors",children:"전체보기"})]}),e.jsx("div",{className:"space-y-2",children:i.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-800/30 border border-slate-700/50 hover:border-cyan-500/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${a.type==="deposit"?"bg-green-500/20 text-green-400":"bg-purple-500/20 text-purple-400"}`,children:a.coin_type}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 text-sm",children:a.user.username}),e.jsx("p",{className:"text-slate-500 text-xs",children:a.id})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-sm ${a.type==="deposit"?"text-green-400":"text-purple-400"}`,children:[a.type==="deposit"?"+":"-",d(a.amount)," ",a.coin_type]}),e.jsx("p",{className:"text-slate-500 text-xs",children:C(a.created_at)})]}),e.jsx("div",{children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs ${a.status==="confirmed"||a.status==="completed"?"bg-green-500/20 text-green-400 border border-green-500/30":a.status==="pending"?"bg-amber-500/20 text-amber-400 border border-amber-500/30":"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30"}`,children:x(a.status)})})]},a.id))})]}),e.jsxs(oe,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(te,{className:"w-5 h-5 text-cyan-400"}),e.jsx("h3",{className:"text-slate-200",children:"지갑 현황"})]}),e.jsxs("div",{className:"space-y-6",children:[[{type:"Hot Wallet",balance:o.hotWallet,percentage:_},{type:"Cold Wallet",balance:o.coldWallet,percentage:I}].map((a,w)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:a.type}),e.jsx("span",{className:"text-slate-200",children:j(a.balance)})]}),e.jsx("div",{className:"relative h-2 bg-slate-800 rounded-full overflow-hidden",children:e.jsx("div",{className:`absolute inset-y-0 left-0 bg-gradient-to-r ${a.type==="Hot Wallet"?"from-orange-500 to-red-500":"from-cyan-500 to-blue-500"} rounded-full shadow-lg`,style:{width:`${a.percentage}%`}})}),e.jsxs("p",{className:"text-slate-500 text-xs mt-1",children:[a.percentage,"% of total"]})]},w)),e.jsx("div",{className:"pt-4 border-t border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"총 보유액"}),e.jsx("span",{className:"text-cyan-400",children:j(o.total)})]})}),e.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-slate-300 text-sm",children:"시스템 상태"})]}),e.jsx("p",{className:"text-slate-400 text-xs",children:"모든 노드 정상 작동 중"})]})]})]})]})]})}function mt(){const{user:t}=K(),[s,i]=r.useState([]),[b,o]=r.useState([]),[h,y]=r.useState([]),[v,k]=r.useState("transfer_requests"),[f,l]=r.useState(""),[m,g]=r.useState("all"),[j,d]=r.useState(1),C=10,[x,n]=r.useState(null),[_,I]=r.useState(""),[a,w]=r.useState(!1);r.useEffect(()=>{S();const c=p.channel("deposit-withdrawal-changes").on("postgres_changes",{event:"*",schema:"public",table:"transfer_requests"},()=>S()).on("postgres_changes",{event:"*",schema:"public",table:"deposits"},()=>S()).on("postgres_changes",{event:"*",schema:"public",table:"withdrawals"},()=>S()).subscribe();return()=>{p.removeChannel(c)}},[]);const S=async()=>{const{data:c}=await p.from("transfer_requests").select(`
        *,
        users!transfer_requests_user_id_fkey(username, email)
      `).order("created_at",{ascending:!1});c&&i(c.map(A=>({...A,username:A.users?.username,email:A.users?.email})));const{data:L}=await p.from("deposits").select(`
        *,
        users!deposits_user_id_fkey(username, email)
      `).order("created_at",{ascending:!1});L&&o(L.map(A=>({...A,username:A.users?.username,email:A.users?.email})));const{data:R}=await p.from("withdrawals").select(`
        *,
        users!withdrawals_user_id_fkey(username, email)
      `).order("created_at",{ascending:!1});R&&y(R.map(A=>({...A,username:A.users?.username,email:A.users?.email})))},D=async c=>{if(!_.trim()){N.error("관리자 메모를 입력해주세요");return}if(!t?.id){N.error("로그인 정보를 찾을 수 없습니다");return}w(!0);try{const L=t.id;console.log("🔍 관리자 지갑 조회:",{adminId:L,coin_type:c.coin_type});const{data:R}=await p.from("wallets").select("*").eq("user_id",L);console.log("👛 관리자의 전체 지갑 목록:",R);const{data:A,error:H}=await p.from("wallets").select("address").eq("user_id",L).eq("coin_type",c.coin_type).single();if(console.log("📦 관리자 지갑 조회 결과:",{adminWalletData:A,adminWalletError:H}),H||!A){const xe=`관리자의 ${c.coin_type} 지갑을 찾을 수 없습니다. 지갑 관리에서 ${c.coin_type} 지갑을 먼저 생성해주세요.`;throw console.error("❌ 관리자 지갑 없음:",xe,{adminId:L,coin_type:c.coin_type}),new Error(xe)}const{data:Z,error:ne}=await p.from("wallets").select("address, balance").eq("wallet_id",c.wallet_id).single();if(ne||!Z)throw new Error("사용자 지갑을 찾을 수 없습니다");const{data:ce,error:U}=await p.from("supported_tokens").select("chain_id, contract_address, decimals").eq("symbol",c.coin_type).single();if(U||!ce)throw new Error("코인 정보를 찾을 수 없습니다");N.info("블록체인 전송을 시작합니다...");const z=`${Je.backendUrl}/api/biconomy/transfer`;console.log("🌐 Backend URL:",z);const O=await fetch(z,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Je.anonKey}`},body:JSON.stringify({chainId:ce.chain_id,from:A.address,to:Z.address,token:c.coin_type,amount:c.amount.toString(),gasPayment:{sponsor:!0}})});console.log("📡 Transfer Response Status:",O.status);const W=await O.json();if(console.log("📦 Transfer Result:",W),!O.ok||!W.success){if(W.code==="INSUFFICIENT_BALANCE"&&W.details){const{required:xe,available:ke,shortage:me,token:ue}=W.details;N.error(e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"💰 관리자 지갑 잔액 부족"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["• 필요한 수량: ",e.jsxs("span",{className:"font-mono",children:[xe.toFixed(8)," ",ue]})]}),e.jsxs("div",{children:["• 현재 보유: ",e.jsxs("span",{className:"font-mono",children:[ke.toFixed(8)," ",ue]})]}),e.jsxs("div",{children:["• 부족한 수량: ",e.jsxs("span",{className:"font-mono text-red-400",children:[me.toFixed(8)," ",ue]})]})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 pt-2 border-t border-gray-700",children:["💡 관리자 지갑 주소: ",e.jsx("span",{className:"font-mono",children:A.address})]})]}),{duration:1e4}),setTimeout(()=>{N.info(`관리자 지갑에 ${me.toFixed(2)} ${ue} 이상을 충전한 후 다시 승인해주세요.`,{duration:8e3})},500);return}throw new Error(W.error||"블록체인 전송에 실패했습니다")}const q=W.txHash;N.success("블록체인 전송 완료! 잔액을 업데이트합니다...");const{error:X}=await p.from("transfer_requests").update({status:"approved",admin_note:_,approved_by:L,approved_at:new Date().toISOString()}).eq("request_id",c.request_id);if(X)throw X;const E=parseFloat(Z.balance)+c.amount,{error:M}=await p.from("wallets").update({balance:E}).eq("wallet_id",c.wallet_id);if(M)throw M;const{error:Q}=await p.from("deposits").insert({user_id:c.user_id,wallet_id:c.wallet_id,coin_type:c.coin_type,amount:c.amount,tx_hash:q,confirmations:1,required_confirmations:1,status:"confirmed",from_address:A.address,method:"supertransaction",created_at:new Date().toISOString(),confirmed_at:new Date().toISOString()});if(Q)throw Q;const{error:ae}=await p.from("transactions").insert({user_id:c.user_id,wallet_id:c.wallet_id,type:"deposit",coin_type:c.coin_type,amount:c.amount,balance_before:parseFloat(Z.balance),balance_after:E,reference_id:c.request_id,tx_hash:q,description:`코인 구매 승인 - ${_}`,metadata:{method:"supertransaction",gas_sponsored:!0,admin_wallet:A.address},created_at:new Date().toISOString()});if(ae)throw ae;N.success(`✅ 승인 완료! TX: ${q.substring(0,10)}...`),n(null),I(""),S()}catch(L){console.error("Approve error:",L),N.error(L.message||"승인 처리 중 오류가 발생했습니다")}finally{w(!1)}},B=async c=>{if(!_.trim()){N.error("거부 사유를 입력해주세요");return}w(!0);try{const{data:L}=await p.auth.getUser(),R=L.user?.id,{error:A}=await p.from("transfer_requests").update({status:"rejected",admin_note:_,approved_by:R,approved_at:new Date().toISOString()}).eq("request_id",c.request_id);if(A)throw A;N.success("코인 구매 요청이 거부되었습니다"),n(null),I(""),S()}catch(L){console.error("Reject error:",L),N.error(L.message||"거부 처리 중 오류가 발생했습니다")}finally{w(!1)}},P=(()=>{let c=[];return v==="transfer_requests"?c=s:v==="deposits"?c=b:c=h,c.filter(L=>{const R=L.username?.toLowerCase().includes(f.toLowerCase())||L.email?.toLowerCase().includes(f.toLowerCase())||L.coin_type?.toLowerCase().includes(f.toLowerCase()),A=m==="all"||L.status===m;return R&&A})})(),T=Math.ceil(P.length/C),u=(j-1)*C,F=P.slice(u,u+C),$={pending:s.filter(c=>c.status==="pending").length,approved:s.filter(c=>c.status==="approved").length,rejected:s.filter(c=>c.status==="rejected").length,totalDeposits:b.length,totalWithdrawals:h.length},G=c=>{const L={pending:"bg-amber-500/20 text-amber-400 border-amber-500/30",approved:"bg-green-500/20 text-green-400 border-green-500/30",rejected:"bg-red-500/20 text-red-400 border-red-500/30",confirmed:"bg-green-500/20 text-green-400 border-green-500/30",processing:"bg-blue-500/20 text-blue-400 border-blue-500/30",completed:"bg-green-500/20 text-green-400 border-green-500/30",failed:"bg-red-500/20 text-red-400 border-red-500/30"},R={pending:"대기중",approved:"승인됨",rejected:"거부됨",confirmed:"확인됨",processing:"처리중",completed:"완료",failed:"실패"};return e.jsx("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs border ${L[c]||L.pending}`,children:R[c]||c})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-cyan-400 mb-1",children:"구매 요청 관리"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"사용자의 코인 구매 요청을 승인하고 입출금 내역을 확인합니다"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"대기중 요청"}),e.jsx("p",{className:"text-amber-400 text-2xl",children:$.pending})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"승인됨"}),e.jsx("p",{className:"text-green-400 text-2xl",children:$.approved})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"거부됨"}),e.jsx("p",{className:"text-red-400 text-2xl",children:$.rejected})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 입금"}),e.jsx("p",{className:"text-cyan-400 text-2xl",children:$.totalDeposits})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 출금"}),e.jsx("p",{className:"text-purple-400 text-2xl",children:$.totalWithdrawals})]})]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-slate-700/50",children:[e.jsx("button",{onClick:()=>{k("transfer_requests"),d(1),g("all")},className:`px-6 py-3 border-b-2 transition-colors ${v==="transfer_requests"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-5 h-5"}),e.jsx("span",{children:"코인 구매 요청"}),$.pending>0&&e.jsx("span",{className:"px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full",children:$.pending})]})}),e.jsx("button",{onClick:()=>{k("deposits"),d(1),g("all")},className:`px-6 py-3 border-b-2 transition-colors ${v==="deposits"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5"}),e.jsx("span",{children:"입금 내역"})]})}),e.jsx("button",{onClick:()=>{k("withdrawals"),d(1),g("all")},className:`px-6 py-3 border-b-2 transition-colors ${v==="withdrawals"?"border-cyan-500 text-cyan-400":"border-transparent text-slate-400 hover:text-slate-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-5 h-5"}),e.jsx("span",{children:"출금 내역"})]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Me,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"사용자 이름, 이메일, 코인으로 검색...",value:f,onChange:c=>{l(c.target.value),d(1)},className:"w-full pl-12 pr-4 py-3 bg-slate-900/50 border border-cyan-500/30 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors"})]}),e.jsxs("select",{value:m,onChange:c=>{g(c.target.value),d(1)},className:"px-4 py-3 bg-slate-900/50 border border-cyan-500/30 rounded-lg text-slate-200 focus:outline-none focus:border-cyan-500/50 transition-colors",children:[e.jsx("option",{value:"all",children:"전체 상태"}),v==="transfer_requests"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"pending",children:"대기중"}),e.jsx("option",{value:"approved",children:"승인됨"}),e.jsx("option",{value:"rejected",children:"거부됨"})]}),v==="deposits"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"pending",children:"대기중"}),e.jsx("option",{value:"confirmed",children:"확인됨"}),e.jsx("option",{value:"failed",children:"실패"})]}),v==="withdrawals"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"pending",children:"대기중"}),e.jsx("option",{value:"processing",children:"처리중"}),e.jsx("option",{value:"completed",children:"완료"}),e.jsx("option",{value:"rejected",children:"거부됨"}),e.jsx("option",{value:"failed",children:"실패"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-xl opacity-20 blur"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-800/50 border-b border-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"사용자"}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"코인"}),e.jsx("th",{className:"px-6 py-4 text-right text-slate-300",children:"수량"}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"상태"}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"생성일"}),e.jsx("th",{className:"px-6 py-4 text-right text-slate-300",children:"액션"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700/50",children:F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-slate-400",children:"데이터가 없습니다"})}):F.map(c=>e.jsxs("tr",{className:"hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-200",children:c.username||"Unknown"}),e.jsx("p",{className:"text-slate-400 text-sm",children:c.email||""})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center",children:e.jsx("span",{className:"text-cyan-400 text-xs",children:c.coin_type})}),e.jsx("span",{className:"text-slate-200",children:c.coin_type})]})}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsx("p",{className:"text-slate-200",children:parseFloat(c.amount).toFixed(8)}),c.fee&&c.fee>0&&e.jsxs("p",{className:"text-slate-400 text-sm",children:["수수료: ",parseFloat(c.fee).toFixed(8)]})]}),e.jsx("td",{className:"px-6 py-4",children:G(c.status)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(c.created_at).toLocaleString("ko-KR")})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[v==="transfer_requests"&&c.status==="pending"&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>{n(c),I("")},className:"p-2 rounded-lg bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/30 transition-all",title:"상세보기",children:e.jsx(pe,{className:"w-4 h-4"})})}),v!=="transfer_requests"&&e.jsx("button",{className:"p-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400 transition-all",title:"상세보기",children:e.jsx(pe,{className:"w-4 h-4"})})]})})]},c.request_id||c.deposit_id||c.withdrawal_id))})]})}),T>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-slate-700/50 bg-slate-800/30",children:[e.jsxs("div",{className:"text-slate-400 text-sm",children:[P.length,"개 중 ",u+1,"-",Math.min(u+C,P.length),"개 표시"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(c=>Math.max(1,c-1)),disabled:j===1,className:"p-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:T},(c,L)=>L+1).map(c=>c===1||c===T||c>=j-1&&c<=j+1?e.jsx("button",{onClick:()=>d(c),className:`min-w-[40px] h-10 px-3 rounded-lg transition-all ${j===c?"bg-cyan-500 text-white":"bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400"}`,children:c},c):c===j-2||c===j+2?e.jsx("span",{className:"text-slate-500",children:"..."},c):null)}),e.jsx("button",{onClick:()=>d(c=>Math.min(T,c+1)),disabled:j===T,className:"p-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(re,{className:"w-5 h-5"})})]})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:()=>{n(null),I("")},children:e.jsxs("div",{className:"relative w-full max-w-lg",onClick:c=>c.stopPropagation(),children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-2xl opacity-30 blur"}),e.jsxs("div",{className:"relative bg-slate-900 border border-cyan-500/30 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-white text-xl mb-6",children:"코인 구매 요청 처리"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"사용자"}),e.jsx("span",{className:"text-white",children:x.username})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"이메일"}),e.jsx("span",{className:"text-white",children:x.email})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"코인"}),e.jsx("span",{className:"text-cyan-400",children:x.coin_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"수량"}),e.jsx("span",{className:"text-white",children:parseFloat(x.amount.toString()).toFixed(8)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"요청일시"}),e.jsx("span",{className:"text-white",children:new Date(x.created_at).toLocaleString("ko-KR")})]}),x.user_note&&e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400 block mb-1",children:"사용자 메모"}),e.jsx("p",{className:"text-white bg-slate-900/50 rounded p-2 text-sm",children:x.user_note})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"관리자 메모 *"}),e.jsx("textarea",{value:_,onChange:c=>I(c.target.value),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors",placeholder:"승인/거부 사유를 입력하세요...",rows:3})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>D(x),disabled:a,className:"flex-1 bg-green-500/20 border border-green-500 text-green-400 py-3 rounded-lg hover:bg-green-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:"승인"})]}),e.jsxs("button",{onClick:()=>B(x),disabled:a,className:"flex-1 bg-red-500/20 border border-red-500 text-red-400 py-3 rounded-lg hover:bg-red-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"거부"})]}),e.jsx("button",{onClick:()=>{n(null),I("")},disabled:a,className:"px-6 py-3 bg-slate-800 border border-slate-700 text-slate-400 rounded-lg hover:border-cyan-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"취소"})]})]})]})})]})}function ut(){const[t,s]=r.useState([]),[i,b]=r.useState(null),[o,h]=r.useState([]),[y,v]=r.useState(!0),[k,f]=r.useState(""),[l,m]=r.useState("all"),[g,j]=r.useState("info"),[d,C]=r.useState({totalUsers:0,verifiedUsers:0,totalWallets:0,totalValue:0}),[x,n]=r.useState(null),[_,I]=r.useState(!1),[a,w]=r.useState([]),[S,D]=r.useState([]),[B,V]=r.useState(!1),[P,T]=r.useState(1),[u,F]=r.useState(20);r.useEffect(()=>{$();const E=p.channel("user-wallet-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},()=>$()).on("postgres_changes",{event:"*",schema:"public",table:"wallets"},()=>{$(),i&&G(i.user_id)}).subscribe();return()=>{p.removeChannel(E)}},[]);const $=async()=>{v(!0);const{data:E}=await p.from("users").select("*").order("created_at",{ascending:!1});E&&s(E);const{data:M}=await p.from("wallets").select("balance, coin_type"),Q=E?.length||0,ae=E?.filter(me=>me.account_verification_status==="verified").length||0,xe=M?.length||0,ke=M?.reduce((me,ue)=>me+(ue.balance||0),0)||0;C({totalUsers:Q,verifiedUsers:ae,totalWallets:xe,totalValue:ke}),v(!1)},G=async E=>{const{data:M}=await p.from("wallets").select("*").eq("user_id",E).order("created_at",{ascending:!1});M&&h(M)},c=async E=>{b(E),j("info"),await G(E.user_id)},L=async(E,M)=>{const{error:Q}=await p.from("users").update({status:M}).eq("user_id",E);if(Q){N.error("상태 변경 실패"),console.error("Status change error:",Q);return}N.success(`사용자 상태가 ${M==="active"?"활성":M==="suspended"?"정지":M==="blocked"?"차단":"비활성"}로 변경되었습니다`),await $(),i?.user_id===E&&b({...i,status:M})},R=async()=>{if(!i)return;const{data:E}=await p.from("supported_tokens").select("symbol").eq("is_active",!0),M=o.map(ae=>ae.coin_type),Q=E?.map(ae=>ae.symbol).filter(ae=>!M.includes(ae))||[];w(Q),D([]),I(!0)},A=async()=>{if(!(!i||S.length===0)){V(!0);try{for(const E of S){const M="0x"+Array.from({length:40},()=>Math.floor(Math.random()*16).toString(16)).join("");await p.from("wallets").insert({user_id:i.user_id,coin_type:E,address:M,balance:0,wallet_type:"hot"})}N.success(`${S.length}개의 코인 지갑이 추가되었습니다`),I(!1),await G(i.user_id)}catch(E){N.error("코인 추가 실패"),console.error(E)}finally{V(!1)}}},H=(E,M)=>{navigator.clipboard.writeText(E),n(M),N.success("주소가 복사되었습니다"),setTimeout(()=>n(null),2e3)},Z=t.filter(E=>{const M=E.username.toLowerCase().includes(k.toLowerCase())||E.email.toLowerCase().includes(k.toLowerCase()),Q=l==="all"||E.status===l;return M&&Q}),ne=Math.ceil(Z.length/u),ce=(P-1)*u,U=ce+u,z=Z.slice(ce,U);r.useEffect(()=>{T(1)},[k,l,u]);const O=E=>{switch(E){case"active":return"text-green-400 bg-green-500/20 border-green-500/50";case"suspended":return"text-yellow-400 bg-yellow-500/20 border-yellow-500/50";case"blocked":return"text-red-400 bg-red-500/20 border-red-500/50";default:return"text-slate-400 bg-slate-500/20 border-slate-500/50"}},W=E=>{switch(E){case"active":return"활성";case"suspended":return"정지";case"blocked":return"차단";default:return E}},q=E=>{switch(E){case"verified":return"text-green-400 bg-green-500/20";case"pending":return"text-yellow-400 bg-yellow-500/20";case"rejected":return"text-red-400 bg-red-500/20";default:return"text-slate-400 bg-slate-500/20"}},X=E=>{switch(E){case"verified":return"인증";case"pending":return"대기";case"rejected":return"거절";case"not_submitted":return"미제출";default:return E}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 사용자"}),e.jsx("p",{className:"text-cyan-400 text-2xl",children:d.totalUsers.toLocaleString()})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"인증 완료"}),e.jsx("p",{className:"text-green-400 text-2xl",children:d.verifiedUsers.toLocaleString()})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 지갑"}),e.jsx("p",{className:"text-purple-400 text-2xl",children:d.totalWallets.toLocaleString()})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 자산 가치"}),e.jsxs("p",{className:"text-yellow-400 text-2xl",children:["₩",d.totalValue.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-xl opacity-20 blur"}),e.jsxs("div",{className:"relative bg-slate-900/90 backdrop-blur-xl border border-slate-700/50 rounded-xl p-6 h-[calc(100vh-300px)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl text-cyan-400",children:"사용자 목록"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:u,onChange:E=>F(Number(E.target.value)),className:"px-2 py-1 bg-slate-800 border border-slate-700 rounded text-xs text-slate-300 focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:20,children:"20개"}),e.jsx("option",{value:30,children:"30개"}),e.jsx("option",{value:50,children:"50개"})]}),e.jsxs("select",{value:l,onChange:E=>m(E.target.value),className:"px-3 py-1.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-300 focus:outline-none focus:border-cyan-500",children:[e.jsx("option",{value:"all",children:"전체"}),e.jsx("option",{value:"active",children:"활성"}),e.jsx("option",{value:"suspended",children:"정지"}),e.jsx("option",{value:"blocked",children:"차단"})]})]})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"사용자명 또는 이메일 검색...",value:k,onChange:E=>f(E.target.value),className:"w-full pl-10 pr-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-300 focus:outline-none focus:border-cyan-500"})]}),e.jsx("div",{className:"space-y-1.5 overflow-y-auto h-[calc(100%-180px)]",children:y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ee,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):z.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"검색 결과가 없습니다"}):z.map(E=>e.jsx("button",{onClick:()=>c(E),className:`w-full p-2.5 rounded-lg border transition-all text-left ${i?.user_id===E.user_id?"bg-cyan-500/20 border-cyan-500/50":"bg-slate-800/70 border-slate-700 hover:bg-slate-800 hover:border-slate-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-slate-300 text-sm font-medium truncate",children:E.username}),e.jsx("p",{className:"text-slate-500 text-xs truncate",children:E.email})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs border ${O(E.status)}`,children:W(E.status)}),e.jsx("span",{className:`px-1.5 py-0.5 rounded text-xs ${q(E.account_verification_status)}`,children:X(E.account_verification_status)})]})]})},E.user_id))}),ne>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-slate-700 pt-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:[ce+1,"-",Math.min(U,Z.length)," / ",Z.length,"명"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>T(E=>Math.max(1,E-1)),disabled:P===1,className:"p-1.5 bg-slate-800 border border-slate-700 rounded hover:bg-slate-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Oe,{className:"w-4 h-4 text-slate-400"})}),e.jsxs("span",{className:"text-sm text-slate-300 px-2",children:[P," / ",ne]}),e.jsx("button",{onClick:()=>T(E=>Math.min(ne,E+1)),disabled:P===ne,className:"p-1.5 bg-slate-800 border border-slate-700 rounded hover:bg-slate-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(re,{className:"w-4 h-4 text-slate-400"})})]})]})]})]})}),e.jsx("div",{className:"lg:col-span-3",children:i?e.jsxs(oe,{className:"p-6 h-[calc(100vh-300px)] bg-slate-900/90",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j("info"),className:`px-4 py-2 rounded-lg transition-all ${g==="info"?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50":"text-slate-400 hover:text-slate-300"}`,children:"사용자 정보"}),e.jsxs("button",{onClick:()=>j("wallets"),className:`px-4 py-2 rounded-lg transition-all ${g==="wallets"?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/50":"text-slate-400 hover:text-slate-300"}`,children:["지갑 관리 (",o.length,")"]})]}),g==="wallets"&&e.jsxs("button",{onClick:R,className:"flex items-center gap-2 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-all border border-cyan-500/50",children:[e.jsx(Ne,{className:"w-4 h-4"}),"코인 추가"]})]}),e.jsx("div",{className:"overflow-y-auto h-[calc(100%-80px)]",children:g==="info"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/70 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg text-cyan-400 mb-4 flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"기본 정보"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"사용자명"}),e.jsx("p",{className:"text-slate-300",children:i.username})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"이메일"}),e.jsx("p",{className:"text-slate-300",children:i.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"계좌인증 상태"}),e.jsx("span",{className:`inline-block px-3 py-1 rounded text-sm ${q(i.account_verification_status)}`,children:X(i.account_verification_status)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"계정 상태"}),e.jsx("span",{className:`inline-block px-3 py-1 rounded text-sm border ${O(i.status)}`,children:W(i.status)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"가입일"}),e.jsx("p",{className:"text-slate-300",children:new Date(i.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"마지막 로그인"}),e.jsx("p",{className:"text-slate-300",children:i.last_login?new Date(i.last_login).toLocaleDateString():"-"})]})]})]}),e.jsxs("div",{className:"bg-slate-800/70 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg text-cyan-400 mb-4 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"상태 관리"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>L(i.user_id,"active"),disabled:i.status==="active",className:"flex items-center gap-2 px-4 py-2 bg-green-500/20 text-green-400 rounded-lg hover:bg-green-500/30 transition-all border border-green-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ee,{className:"w-4 h-4"}),"활성화"]}),e.jsxs("button",{onClick:()=>L(i.user_id,"suspended"),disabled:i.status==="suspended",className:"flex items-center gap-2 px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-lg hover:bg-yellow-500/30 transition-all border border-yellow-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(he,{className:"w-4 h-4"}),"정지"]}),e.jsxs("button",{onClick:()=>L(i.user_id,"blocked"),disabled:i.status==="blocked",className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-all border border-red-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ss,{className:"w-4 h-4"}),"차단"]})]})]}),e.jsxs("div",{className:"bg-slate-800/70 rounded-lg p-6 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg text-cyan-400 mb-4 flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"지갑 요약"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 지갑 수"}),e.jsx("p",{className:"text-2xl text-cyan-400",children:o.length})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 자산 가치"}),e.jsxs("p",{className:"text-2xl text-green-400",children:["₩",o.reduce((E,M)=>E+M.balance,0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"보유 코인 종류"}),e.jsx("p",{className:"text-2xl text-purple-400",children:o.length})]})]})]})]}):e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(te,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"지갑이 없습니다"}),e.jsx("button",{onClick:R,className:"mt-4 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-all border border-cyan-500/50",children:"코인 추가하기"})]}):o.map(E=>e.jsx("div",{className:"bg-slate-800/70 rounded-lg p-4 border border-slate-700 hover:border-slate-600 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-500/50",children:e.jsx(_e,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-slate-300 font-medium",children:E.coin_type}),E.wallet_type&&e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${E.wallet_type==="hot"?"bg-orange-500/20 text-orange-400 border border-orange-500/50":"bg-blue-500/20 text-blue-400 border border-blue-500/50"}`,children:E.wallet_type==="hot"?"Hot":"Cold"})]}),e.jsxs("p",{className:"text-slate-500 text-sm font-mono",children:[E.address.slice(0,20),"..."]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg text-cyan-400 font-mono",children:E.balance.toFixed(8)}),e.jsxs("p",{className:"text-slate-500 text-sm",children:["≈ ₩",(E.balance*1e3).toLocaleString()]})]}),e.jsx("button",{onClick:()=>H(E.address,E.wallet_id),className:"p-2 text-slate-400 hover:text-cyan-400 transition-colors",children:x===E.wallet_id?e.jsx(Cs,{className:"w-5 h-5 text-green-400"}):e.jsx(Re,{className:"w-5 h-5"})})]})]})},E.wallet_id))})})]}):e.jsx(oe,{className:"p-12 h-[calc(100vh-300px)] flex items-center justify-center bg-slate-900/90",children:e.jsxs("div",{className:"text-center text-slate-400",children:[e.jsx(Ee,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"사용자를 선택해주세요"})]})})})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-slate-900 rounded-lg border border-cyan-500/30 shadow-xl max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl text-cyan-400 mb-4",children:"코인 추가"}),a.length===0?e.jsx("p",{className:"text-slate-400 text-center py-8",children:"추가할 수 있는 코인이 없습니다"}):e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:a.map(E=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-800 rounded-lg border border-slate-700 hover:border-cyan-500/50 cursor-pointer transition-all",children:[e.jsx("input",{type:"checkbox",checked:S.includes(E),onChange:M=>{M.target.checked?D([...S,E]):D(S.filter(Q=>Q!==E))},className:"w-4 h-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-500"}),e.jsx("span",{className:"text-slate-300",children:E})]},E))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>I(!1),className:"flex-1 px-4 py-2 bg-slate-800 text-slate-300 rounded-lg hover:bg-slate-700 transition-all",children:"취소"}),e.jsx("button",{onClick:A,disabled:S.length===0||B,className:"flex-1 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-lg hover:bg-cyan-500/30 transition-all border border-cyan-500/50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),"추가 중..."]}):`추가 (${S.length})`})]})]})})})]})}function ht(){const[t,s]=r.useState([]),[i,b]=r.useState([]),[o,h]=r.useState(!1),[y,v]=r.useState({high:0,medium:0,resolved:0,activeIPs:0});r.useEffect(()=>{k();const n=p.channel("security-changes").on("postgres_changes",{event:"*",schema:"public",table:"security_logs"},()=>{f(),m()}).on("postgres_changes",{event:"*",schema:"public",table:"ip_whitelist"},()=>{l()}).subscribe();return()=>{p.removeChannel(n)}},[]);const k=async()=>{try{await Promise.all([f(),l(),m()])}catch(n){console.error("Security data fetch error:",n)}finally{h(!1)}},f=async()=>{const{data:n,error:_}=await p.from("security_logs").select("*").order("created_at",{ascending:!1}).limit(10);if(_){console.error("Security alerts fetch error:",_),N.error("보안 알림을 불러오는데 실패했습니다");return}s(n||[])},l=async()=>{const{data:n,error:_}=await p.from("ip_whitelist").select("*").order("last_access",{ascending:!1});if(_){console.error("IP whitelist fetch error:",_);return}b(n||[])},m=async()=>{const{count:n}=await p.from("security_logs").select("*",{count:"exact",head:!0}).eq("severity","high").neq("status","resolved"),{count:_}=await p.from("security_logs").select("*",{count:"exact",head:!0}).eq("severity","medium").neq("status","resolved"),{count:I}=await p.from("security_logs").select("*",{count:"exact",head:!0}).eq("status","resolved"),{count:a}=await p.from("ip_whitelist").select("*",{count:"exact",head:!0}).eq("status","active");v({high:n||0,medium:_||0,resolved:I||0,activeIPs:a||0})},g=async n=>{const{error:_}=await p.from("security_logs").update({status:"resolved"}).eq("log_id",n);if(_){N.error("알림을 해결하는데 실패했습니다");return}N.success("보안 알림이 해결되었습니다"),f(),m()},j=n=>{switch(n){case"critical":case"high":return"bg-red-500/20 text-red-400 border-red-500/30";case"medium":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"low":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";default:return"bg-slate-500/20 text-slate-400 border-slate-500/30"}},d=n=>{switch(n){case"pending":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"blocked":return"bg-red-500/20 text-red-400 border-red-500/30";case"resolved":return"bg-green-500/20 text-green-400 border-green-500/30";case"monitoring":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";default:return"bg-slate-500/20 text-slate-400 border-slate-500/30"}},C=n=>({critical:"위급",high:"높음",medium:"중간",low:"낮음"})[n]||n,x=n=>({pending:"대기중",blocked:"차단됨",resolved:"해결됨",monitoring:"모니터링"})[n]||n;return o?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-cyan-400 mb-1",children:"보안 모니터"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"실시간 보안 이벤트 및 이상 거래 탐지"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-green-500/20 border border-green-500/30",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-400 text-sm",children:"시스템 정상"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(we,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400 text-2xl",children:y.high})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"높은 위험도"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-amber-500 to-orange-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"w-5 h-5 text-amber-400"}),e.jsx("span",{className:"text-amber-400 text-2xl",children:y.medium})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"중간 위험도"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx($e,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-green-400 text-2xl",children:y.resolved})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"해결됨"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(fe,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-cyan-400 text-2xl",children:y.activeIPs})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"활성 IP"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs("h3",{className:"text-slate-200 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-amber-400"}),"보안 알림"]}),t.map(n=>e.jsx(oe,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs border ${j(n.severity)}`,children:C(n.severity)}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs border ${d(n.status)}`,children:x(n.status)})]}),e.jsx("h4",{className:"text-slate-200 mb-1",children:n.event_type}),e.jsx("p",{className:"text-slate-400 text-sm",children:n.description})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-700/50",children:[e.jsx("span",{className:"text-slate-500 text-xs",children:n.created_at}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-3 py-1 rounded-lg bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/30 transition-all text-xs",children:"상세보기"}),n.status==="pending"&&e.jsx("button",{className:"px-3 py-1 rounded-lg bg-green-500/20 border border-green-500/30 text-green-400 hover:bg-green-500/30 transition-all text-xs",onClick:()=>g(n.log_id),children:"해결"})]})]})]})},n.log_id))]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-slate-200 flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5 text-cyan-400"}),"IP 화이트리스트"]}),e.jsx("button",{className:"px-3 py-1 rounded-lg bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/30 transition-all text-xs",children:"추가"})]}),e.jsx(oe,{children:e.jsx("div",{className:"space-y-3",children:i.map((n,_)=>e.jsxs("div",{className:`p-3 rounded-lg border ${n.status==="active"?"bg-slate-800/30 border-slate-700/50":"bg-slate-800/20 border-slate-700/30 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.status==="active"?"bg-green-400 animate-pulse":"bg-slate-500"}`}),e.jsx("code",{className:"text-cyan-400 text-sm",children:n.ip_address})]}),e.jsx(he,{className:"w-4 h-4 text-slate-500"})]}),e.jsx("p",{className:"text-slate-400 text-xs mb-1",children:n.label}),e.jsxs("p",{className:"text-slate-500 text-xs",children:["마지막 접근: ",n.last_access]})]},_))})}),e.jsx(oe,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-slate-200 text-sm flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-green-400"}),"보안 설정"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-slate-800/30",children:[e.jsx("span",{className:"text-slate-400",children:"2FA 필수"}),e.jsx("span",{className:"text-green-400",children:"활성화"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-slate-800/30",children:[e.jsx("span",{className:"text-slate-400",children:"IP 제한"}),e.jsx("span",{className:"text-green-400",children:"활성화"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-slate-800/30",children:[e.jsx("span",{className:"text-slate-400",children:"다중 서명"}),e.jsx("span",{className:"text-green-400",children:"활성화"})]}),e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-slate-800/30",children:[e.jsx("span",{className:"text-slate-400",children:"자동 탐지"}),e.jsx("span",{className:"text-green-400",children:"활성화"})]})]}),e.jsx("button",{className:"w-full px-4 py-2 rounded-lg bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/30 transition-all text-sm",children:"보안 설정 관리"})]})})]})]})]})}function pt(){const[t,s]=r.useState([]),[i,b]=r.useState("all"),[o,h]=r.useState("all"),[y,v]=r.useState(""),[k,f]=r.useState(!1),[l,m]=r.useState("created_at"),[g,j]=r.useState("desc"),[d,C]=r.useState(1),x=20,[n,_]=r.useState({total:0,completed:0,pending:0,failed:0});r.useEffect(()=>{I(),a();const c=p.channel("swap-changes").on("postgres_changes",{event:"*",schema:"public",table:"coin_swaps"},()=>{I(),a()}).subscribe();return()=>{p.removeChannel(c)}},[]);const I=async()=>{try{const{data:c,error:L}=await p.from("coin_swaps").select(`
          swap_id,
          user_id,
          from_coin,
          to_coin,
          from_amount,
          to_amount,
          exchange_rate,
          fee,
          status,
          created_at,
          completed_at,
          method,
          tx_hash,
          users!inner(username)
        `).order("created_at",{ascending:!1});if(L)throw L;const R=c.map(A=>({swap_id:A.swap_id,user_id:A.user_id,username:A.users.username,from_coin:A.from_coin,to_coin:A.to_coin,from_amount:Number(A.from_amount),to_amount:Number(A.to_amount),exchange_rate:Number(A.exchange_rate),fee:Number(A.fee),status:A.status,created_at:A.created_at,completed_at:A.completed_at,method:A.method,tx_hash:A.tx_hash}));s(R)}catch(c){console.error("Swap fetch error:",c),N.error("스왑 데이터를 불러오는데 실패했습니다")}finally{f(!1)}},a=async()=>{const{count:c}=await p.from("coin_swaps").select("*",{count:"exact",head:!0}),{count:L}=await p.from("coin_swaps").select("*",{count:"exact",head:!0}).eq("status","completed"),{count:R}=await p.from("coin_swaps").select("*",{count:"exact",head:!0}).in("status",["pending","processing"]),{count:A}=await p.from("coin_swaps").select("*",{count:"exact",head:!0}).in("status",["failed","cancelled"]);_({total:c||0,completed:L||0,pending:R||0,failed:A||0})},w=c=>{l===c?j(g==="asc"?"desc":"asc"):(m(c),j("desc"))},S=c=>l!==c?e.jsx(Es,{className:"w-4 h-4"}):g==="asc"?e.jsx(As,{className:"w-4 h-4"}):e.jsx(Ts,{className:"w-4 h-4"}),D=c=>{switch(c){case"completed":return e.jsx(se,{className:"w-4 h-4 text-green-400"});case"pending":case"processing":return e.jsx(de,{className:"w-4 h-4 text-yellow-400 animate-pulse"});case"failed":case"cancelled":return e.jsx(le,{className:"w-4 h-4 text-red-400"});default:return e.jsx(ve,{className:"w-4 h-4 text-slate-400"})}},B=c=>({pending:"대기 중",processing:"처리 중",completed:"완료",failed:"실패",cancelled:"취소됨"})[c]||c,P=[...t.filter(c=>{const L=i==="all"||c.status===i,R=o==="all"||c.from_coin===o||c.to_coin===o;return L&&R})].sort((c,L)=>{let R,A;switch(l){case"username":R=c.username,A=L.username;break;case"from_amount":R=c.from_amount,A=L.from_amount;break;case"to_amount":R=c.to_amount,A=L.to_amount;break;case"created_at":R=new Date(c.created_at).getTime(),A=new Date(L.created_at).getTime();break;case"status":R=c.status,A=L.status;break;default:R=c.created_at,A=L.created_at}return R<A?g==="asc"?-1:1:R>A?g==="asc"?1:-1:0}),T=Math.ceil(P.length/x),u=(d-1)*x,F=u+x,$=P.slice(u,F),G=Array.from(new Set([...t.map(c=>c.from_coin),...t.map(c=>c.to_coin)]));return k?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-cyan-400 mb-1",children:"스왑 관리"}),e.jsxs("p",{className:"text-slate-400 text-sm",children:["코인 교환 내역 관리 (",P.length,"건)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"전체 스왑"}),e.jsx("p",{className:"text-cyan-400 text-2xl",children:n.total})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"완료"}),e.jsx("p",{className:"text-green-400 text-2xl",children:n.completed})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-amber-500 to-yellow-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"대기/처리 중"}),e.jsx("p",{className:"text-amber-400 text-2xl",children:n.pending})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"실패/취소"}),e.jsx("p",{className:"text-red-400 text-2xl",children:n.failed})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Me,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"사용자, 코인, TX 해시로 검색...",value:y,onChange:c=>{v(c.target.value),C(1)},className:"w-full pl-12 pr-4 py-3 bg-slate-900/50 border border-cyan-500/30 rounded-lg text-slate-200 placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 transition-colors"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("select",{value:i,onChange:c=>{b(c.target.value),C(1)},className:"px-4 py-3 bg-slate-900/50 border border-cyan-500/30 rounded-lg text-slate-200 focus:outline-none focus:border-cyan-500/50 transition-colors",children:[e.jsx("option",{value:"all",children:"전체 상태"}),e.jsx("option",{value:"pending",children:"대기 중"}),e.jsx("option",{value:"processing",children:"처리 중"}),e.jsx("option",{value:"completed",children:"완료"}),e.jsx("option",{value:"failed",children:"실패"}),e.jsx("option",{value:"cancelled",children:"취소됨"})]}),e.jsxs("select",{value:o,onChange:c=>{h(c.target.value),C(1)},className:"px-4 py-3 bg-slate-900/50 border border-cyan-500/30 rounded-lg text-slate-200 focus:outline-none focus:border-cyan-500/50 transition-colors",children:[e.jsx("option",{value:"all",children:"전체 코인"}),G.map(c=>e.jsx("option",{value:c,children:c},c))]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-xl opacity-20 blur"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-800/50 border-b border-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-slate-300 cursor-pointer hover:text-cyan-400 transition-colors",onClick:()=>w("username"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["사용자",S("username")]})}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"교환"}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300 cursor-pointer hover:text-cyan-400 transition-colors",onClick:()=>w("from_amount"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["보낸 금액",S("from_amount")]})}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300 cursor-pointer hover:text-cyan-400 transition-colors",onClick:()=>w("to_amount"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["받은 금액",S("to_amount")]})}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"환율"}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300",children:"수수료"}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300 cursor-pointer hover:text-cyan-400 transition-colors",onClick:()=>w("status"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["상태",S("status")]})}),e.jsx("th",{className:"px-6 py-4 text-left text-slate-300 cursor-pointer hover:text-cyan-400 transition-colors",onClick:()=>w("created_at"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["생성일",S("created_at")]})})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700/50",children:$.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-slate-400",children:"스왑 내역이 없습니다"})}):$.map(c=>e.jsxs("tr",{className:"hover:bg-slate-800/30 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-800 border-2 border-cyan-500 flex items-center justify-center shrink-0",style:{boxShadow:"0 0 10px rgba(6, 182, 212, 0.4)"},children:e.jsx(Is,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-slate-200 text-sm truncate",children:c.username}),e.jsxs("p",{className:"text-slate-400 text-xs truncate",children:[c.user_id.slice(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 rounded text-sm",children:c.from_coin}),e.jsx(ve,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"px-2 py-1 bg-purple-500/20 border border-purple-500/30 text-purple-400 rounded text-sm",children:c.to_coin})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-white",children:c.from_amount}),e.jsx("p",{className:"text-xs text-slate-400",children:c.from_coin})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-white",children:c.to_amount.toFixed(8)}),e.jsx("p",{className:"text-xs text-slate-400",children:c.to_coin})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-slate-300 text-sm",children:c.exchange_rate.toFixed(8)})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-orange-400",children:c.fee.toFixed(8)}),e.jsx("p",{className:"text-xs text-slate-400",children:c.to_coin})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs border ${c.status==="completed"?"bg-green-500/20 text-green-400 border-green-500/30":c.status==="pending"||c.status==="processing"?"bg-amber-500/20 text-amber-400 border-amber-500/30":"bg-red-500/20 text-red-400 border-red-500/30"}`,children:[D(c.status),B(c.status)]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-slate-300 text-sm",children:new Date(c.created_at).toLocaleDateString("ko-KR")}),e.jsx("p",{className:"text-slate-500 text-xs",children:new Date(c.created_at).toLocaleTimeString("ko-KR")}),c.completed_at&&e.jsxs("p",{className:"text-green-400 text-xs mt-1",children:["완료: ",new Date(c.completed_at).toLocaleTimeString("ko-KR")]})]})]},c.swap_id))})]})}),T>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-slate-700/50 bg-slate-800/30",children:[e.jsxs("div",{className:"text-slate-400 text-sm",children:[P.length,"개 중 ",u+1,"-",Math.min(F,P.length),"개 표시"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>C(c=>Math.max(1,c-1)),disabled:d===1,className:"p-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:T},(c,L)=>L+1).map(c=>c===1||c===T||c>=d-1&&c<=d+1?e.jsx("button",{onClick:()=>C(c),className:`min-w-[40px] h-10 px-3 rounded-lg transition-all ${d===c?"bg-cyan-500 text-white":"bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400"}`,children:c},c):c===d-2||c===d+2?e.jsx("span",{className:"text-slate-500",children:"..."},c):null)}),e.jsx("button",{onClick:()=>C(c=>Math.min(T,c+1)),disabled:d===T,className:"p-2 rounded-lg bg-slate-800 border border-slate-700 text-slate-400 hover:border-cyan-500/50 hover:text-cyan-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(re,{className:"w-5 h-5"})})]})]})]})]})]})}function bt(){const[t,s]=r.useState([]),[i,b]=r.useState(!1),[o,h]=r.useState(!1),[y,v]=r.useState(null),[k,f]=r.useState(!1),[l,m]=r.useState({symbol:"",name:"",network:"",contract_address:"",decimals:"18",chain_id:"1",rpc_url:"",explorer_url:"",min_deposit:"0",min_withdrawal:"0",withdrawal_fee:"0",is_active:!0,icon_url:""});r.useEffect(()=>{g();const a=p.channel("coin-changes").on("postgres_changes",{event:"*",schema:"public",table:"supported_tokens"},()=>{g()}).subscribe();return()=>{p.removeChannel(a)}},[]);const g=async()=>{const{data:a,error:w}=await p.from("supported_tokens").select("*").order("created_at",{ascending:!1});!w&&a&&s(a),b(!1)},j=async()=>{if(!l.symbol||!l.name||!l.network){N.error("필수 필드를 입력해주세요");return}f(!0);try{const{error:a}=await p.from("supported_tokens").insert({symbol:l.symbol.toUpperCase(),name:l.name,network:l.network,contract_address:l.contract_address||null,decimals:parseInt(l.decimals),chain_id:parseInt(l.chain_id),rpc_url:l.rpc_url||null,explorer_url:l.explorer_url||null,min_deposit:parseFloat(l.min_deposit),min_withdrawal:parseFloat(l.min_withdrawal),withdrawal_fee:parseFloat(l.withdrawal_fee),is_active:l.is_active,icon_url:l.icon_url||null,created_at:new Date().toISOString()});if(a)throw a;N.success(`${l.symbol} 코인이 추가되었습니다`),_(),h(!1),g()}catch(a){console.error("Add coin error:",a),N.error(a.message||"코인 추가 중 오류가 발생했습니다")}finally{f(!1)}},d=async()=>{if(y){f(!0);try{const{error:a}=await p.from("supported_tokens").update({name:l.name,network:l.network,contract_address:l.contract_address||null,decimals:parseInt(l.decimals),chain_id:parseInt(l.chain_id),rpc_url:l.rpc_url||null,explorer_url:l.explorer_url||null,min_deposit:parseFloat(l.min_deposit),min_withdrawal:parseFloat(l.min_withdrawal),withdrawal_fee:parseFloat(l.withdrawal_fee),is_active:l.is_active,icon_url:l.icon_url||null}).eq("symbol",y.symbol);if(a)throw a;N.success(`${y.symbol} 코인이 수정되었습니다`),_(),v(null),g()}catch(a){console.error("Update coin error:",a),N.error(a.message||"코인 수정 중 오류가 발생했습니다")}finally{f(!1)}}},C=async a=>{const{error:w}=await p.from("supported_tokens").update({is_active:!a.is_active}).eq("symbol",a.symbol);w?N.error("상태 변경 실패"):(N.success(`${a.symbol} ${a.is_active?"비활성화":"활성화"}되었습니다`),g())},x=async a=>{if(confirm(`정말 ${a.symbol} 코인을 삭제하시겠습니까?

⚠️ 경고: 이 코인으로 발행된 모든 사용자 지갑도 함께 삭제됩니다!`))try{const{count:w}=await p.from("wallets").select("*",{count:"exact",head:!0}).eq("coin_type",a.symbol),{error:S}=await p.from("wallets").delete().eq("coin_type",a.symbol);if(S)throw S;const{error:D}=await p.from("supported_tokens").delete().eq("symbol",a.symbol);if(D)throw D;N.success(`${a.symbol} 코인과 관련 지갑 ${w||0}개가 삭제되었습니다`),g()}catch(w){console.error("Delete error:",w),N.error("삭제 실패: "+(w.message||"알 수 없는 오류"))}},n=a=>{v(a),m({symbol:a.symbol,name:a.name,network:a.network,contract_address:a.contract_address||"",decimals:(a.decimals??18).toString(),chain_id:(a.chain_id??1).toString(),rpc_url:a.rpc_url||"",explorer_url:a.explorer_url||"",min_deposit:(a.min_deposit??0).toString(),min_withdrawal:(a.min_withdrawal??0).toString(),withdrawal_fee:(a.withdrawal_fee??0).toString(),is_active:a.is_active??!0,icon_url:a.icon_url||""})},_=()=>{m({symbol:"",name:"",network:"",contract_address:"",decimals:"18",chain_id:"1",rpc_url:"",explorer_url:"",min_deposit:"0",min_withdrawal:"0",withdrawal_fee:"0",is_active:!0,icon_url:""})},I=async()=>{const a=[{symbol:"BTC",name:"Bitcoin",network:"Bitcoin",decimals:8,chain_id:0,min_deposit:1e-4,min_withdrawal:.001,withdrawal_fee:5e-4,is_active:!0},{symbol:"ETH",name:"Ethereum",network:"Ethereum",decimals:18,chain_id:1,min_deposit:.01,min_withdrawal:.01,withdrawal_fee:.005,is_active:!0},{symbol:"USDT",name:"Tether USD",network:"Ethereum (ERC-20)",contract_address:"0xdAC17F958D2ee523a2206206994597C13D831ec7",decimals:6,chain_id:1,min_deposit:10,min_withdrawal:10,withdrawal_fee:1,is_active:!0},{symbol:"USDC",name:"USD Coin",network:"Ethereum (ERC-20)",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",decimals:6,chain_id:1,min_deposit:10,min_withdrawal:10,withdrawal_fee:1,is_active:!0},{symbol:"BNB",name:"BNB",network:"BNB Smart Chain",decimals:18,chain_id:56,min_deposit:.01,min_withdrawal:.01,withdrawal_fee:.005,is_active:!0},{symbol:"KRWQ",name:"Korean Won Quantum",network:"KRWQ Network",decimals:18,chain_id:12345,min_deposit:1e3,min_withdrawal:1e3,withdrawal_fee:0,is_active:!0}];f(!0);try{const{error:w}=await p.from("supported_tokens").insert(a.map(S=>({...S,created_at:new Date().toISOString()})));if(w)throw w;N.success("기본 코인이 추가되었습니다"),g()}catch(w){console.error("Add default coins error:",w),N.error(w.message||"기본 코인 추가 중 오류가 발생했습니다")}finally{f(!1)}};return i?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-cyan-400 mb-1",children:"코인 관리"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"지원 코인 추가 및 설정 관리"})]}),e.jsxs("div",{className:"flex gap-2",children:[t.length===0&&e.jsxs("button",{onClick:I,disabled:k,className:"flex items-center gap-2 px-4 py-2 bg-green-500/20 border border-green-500/50 text-green-400 rounded-lg hover:bg-green-500/30 hover:border-green-500/70 transition-all disabled:opacity-50",children:[e.jsx(_e,{className:"w-4 h-4"}),"기본 코인 추가"]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-lg hover:bg-cyan-500/30 hover:border-cyan-500/70 transition-all",children:[e.jsx(Ne,{className:"w-4 h-4"}),"추가"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"총 코인"}),e.jsx("p",{className:"text-cyan-400 text-2xl",children:t.length})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-green-500 to-emerald-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"활성화"}),e.jsx("p",{className:"text-green-400 text-2xl",children:t.filter(a=>a.is_active).length})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-red-500 to-pink-500 rounded-lg opacity-20 group-hover:opacity-30 blur transition-opacity"}),e.jsxs("div",{className:"relative bg-slate-900/80 backdrop-blur-xl border border-slate-700/50 rounded-lg p-4",children:[e.jsx("p",{className:"text-slate-400 text-sm mb-1",children:"비활성화"}),e.jsx("p",{className:"text-red-400 text-2xl",children:t.filter(a=>!a.is_active).length})]})]})]}),e.jsx("div",{className:"space-y-4",children:t.length===0?e.jsxs("div",{className:"text-center py-12 bg-slate-800/30 border border-slate-700/50 rounded-xl",children:[e.jsx(_e,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"등록된 코인이 없습니다"}),e.jsx("button",{onClick:I,disabled:k,className:"px-6 py-2 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-lg hover:bg-cyan-500/30 hover:border-cyan-500/70 transition-all disabled:opacity-50",children:"기본 코인 추가하기"})]}):t.map(a=>e.jsx(oe,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-800 border-2 border-cyan-500 flex items-center justify-center",style:{boxShadow:"0 0 15px rgba(6, 182, 212, 0.6)"},children:e.jsx("span",{className:"text-cyan-400 text-sm",children:a.symbol})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-white",children:a.name}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs border ${a.is_active?"bg-green-500/20 text-green-400 border-green-500/30":"bg-red-500/20 text-red-400 border-red-500/30"}`,children:a.is_active?"활성":"비활성"})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:a.network}),a.contract_address&&e.jsxs("p",{className:"text-slate-500 text-xs font-mono mt-1",children:[a.contract_address.substring(0,10),"..."]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 rounded-lg bg-slate-800/30 border border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"최소 입금"}),e.jsxs("p",{className:"text-white text-sm",children:[a.min_deposit," ",a.symbol]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"최소 출금"}),e.jsxs("p",{className:"text-white text-sm",children:[a.min_withdrawal," ",a.symbol]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"출금 수수료"}),e.jsxs("p",{className:"text-white text-sm",children:[a.withdrawal_fee," ",a.symbol]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-xs mb-1",children:"등록일"}),e.jsx("p",{className:"text-white text-sm",children:new Date(a.created_at).toLocaleDateString("ko-KR")})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>n(a),className:"px-4 py-2 rounded-lg bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 hover:bg-cyan-500/30 hover:border-cyan-500/70 transition-all text-sm flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),"수정"]}),e.jsxs("button",{onClick:()=>C(a),className:`px-4 py-2 rounded-lg border text-sm flex items-center gap-2 transition-all ${a.is_active?"bg-red-500/20 border-red-500/50 text-red-400 hover:bg-red-500/30 hover:border-red-500/70":"bg-green-500/20 border-green-500/50 text-green-400 hover:bg-green-500/30 hover:border-green-500/70"}`,children:[a.is_active?e.jsx(le,{className:"w-4 h-4"}):e.jsx(se,{className:"w-4 h-4"}),a.is_active?"비활성화":"활성화"]}),e.jsxs("button",{onClick:()=>x(a),className:"px-4 py-2 rounded-lg bg-red-500/20 border border-red-500/50 text-red-400 hover:bg-red-500/30 hover:border-red-500/70 transition-all text-sm flex items-center gap-2",children:[e.jsx(Ds,{className:"w-4 h-4"}),"삭제"]})]})]})},a.symbol))}),(o||y)&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-hidden",onClick:a=>{a.target===a.currentTarget&&(h(!1),v(null),_())},children:e.jsx("div",{className:"relative w-full max-w-2xl max-h-[85vh]",children:e.jsxs("div",{className:"relative bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border border-cyan-500/30 rounded-xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-cyan-500/20 bg-slate-900/50",children:[e.jsx("h3",{className:"text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400",children:y?"코인 수정":"새 코인 추가"}),e.jsx("button",{onClick:()=>{h(!1),v(null),_()},className:"w-8 h-8 rounded-lg bg-slate-800/50 border border-slate-700/50 flex items-center justify-center hover:border-cyan-500/50 hover:bg-cyan-500/10 transition-all",children:e.jsx(ge,{className:"w-5 h-5 text-slate-400"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(85vh-140px)] p-5",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"심볼 *"}),e.jsx("input",{type:"text",value:l.symbol,onChange:a=>m({...l,symbol:a.target.value}),disabled:!!y,className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all disabled:opacity-50",placeholder:"BTC"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"이름 *"}),e.jsx("input",{type:"text",value:l.name,onChange:a=>m({...l,name:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"Bitcoin"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"네트워크 *"}),e.jsx("input",{type:"text",value:l.network,onChange:a=>m({...l,network:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"Bitcoin / Ethereum (ERC-20)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"컨트랙트 주소"}),e.jsx("input",{type:"text",value:l.contract_address,onChange:a=>m({...l,contract_address:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"0x..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"10진수"}),e.jsx("input",{type:"number",step:"1",value:l.decimals,onChange:a=>m({...l,decimals:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"18"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"체인 ID"}),e.jsx("input",{type:"number",step:"1",value:l.chain_id,onChange:a=>m({...l,chain_id:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"RPC URL"}),e.jsx("input",{type:"text",value:l.rpc_url,onChange:a=>m({...l,rpc_url:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"https://mainnet.infura.io/v3/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"블록체인 탐색기 URL"}),e.jsx("input",{type:"text",value:l.explorer_url,onChange:a=>m({...l,explorer_url:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"https://etherscan.io/..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"최소 입금액"}),e.jsx("input",{type:"number",step:"any",value:l.min_deposit,onChange:a=>m({...l,min_deposit:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"최소 출금액"}),e.jsx("input",{type:"number",step:"any",value:l.min_withdrawal,onChange:a=>m({...l,min_withdrawal:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"출금 수수료"}),e.jsx("input",{type:"number",step:"any",value:l.withdrawal_fee,onChange:a=>m({...l,withdrawal_fee:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"활성 상태"}),e.jsxs("select",{value:l.is_active?"true":"false",onChange:a=>m({...l,is_active:a.target.value==="true"}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",children:[e.jsx("option",{value:"true",children:"활성화"}),e.jsx("option",{value:"false",children:"비활성화"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"심볼 URL"}),e.jsx("input",{type:"text",value:l.icon_url,onChange:a=>m({...l,icon_url:a.target.value}),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"https://example.com/icon.png"})]})]})}),e.jsxs("div",{className:"p-5 border-t border-cyan-500/20 bg-slate-900/50 flex gap-2",children:[e.jsx("button",{onClick:y?d:j,disabled:k,className:"flex-1 px-4 py-2.5 bg-cyan-500/20 border border-cyan-500/50 text-cyan-400 rounded-lg hover:bg-cyan-500/30 hover:border-cyan-500/70 transition-all disabled:opacity-50 flex items-center justify-center gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:y?"수정 중...":"추가 중..."})]}):e.jsxs(e.Fragment,{children:[y?e.jsx(Ve,{className:"w-4 h-4"}):e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{children:y?"수정":"추가"})]})}),e.jsx("button",{onClick:()=>{h(!1),v(null),_()},className:"px-6 py-2.5 bg-slate-800/50 border border-slate-700/50 text-slate-300 rounded-lg hover:border-slate-600/50 hover:bg-slate-700/50 transition-all",children:"취소"})]})]})})})]})}async function gt(t){try{Qe("Creating Smart Account for user:",t.userId);const s=t.chainId||ze.defaultChainId,i=new(void 0).JsonRpcProvider(Ae.networks[Ae.defaultNetwork].rpcUrl),b=new us(Ae.privateKey,i),o=(void 0).getContractAddress({from:b.address,nonce:await i.getTransactionCount(b.address)});return Qe("Smart Account created:",{address:o,chainId:s,owner:b.address}),{address:o,chainId:s,owner:b.address,status:"active",createdAt:new Date().toISOString()}}catch(s){throw Ys("Smart Account creation failed:",s),new Error(`Smart Account 생성 실패: ${s.message}`)}}function jt(){const[t,s]=r.useState([]),[i,b]=r.useState(!1),[o,h]=r.useState(null),[y,v]=r.useState(""),[k,f]=r.useState(!1),[l,m]=r.useState(null),[g,j]=r.useState("all"),[d,C]=r.useState(!1),[x,n]=r.useState("");r.useEffect(()=>{_();const u=p.channel("account_verifications_changes").on("postgres_changes",{event:"*",schema:"public",table:"account_verifications"},()=>{_()}).subscribe();return()=>{u.unsubscribe()}},[]);const _=async()=>{try{const{data:u,error:F}=await p.from("account_verifications").select(`
          *,
          users (
            username,
            email
          )
        `).order("created_at",{ascending:!1});if(F)throw F;s(u||[])}catch(u){console.error("Fetch error:",u),N.error("데이터 로드 실패")}finally{b(!1)}},I=async()=>{if(!l||!y.trim()){N.error("거부 사유를 입력해주세요");return}h(l.verification_id);try{const{error:u}=await p.from("account_verifications").update({status:"rejected",rejection_reason:y}).eq("verification_id",l.verification_id);if(u)throw u;N.success("계좌인증이 거부되었습니다"),f(!1),v(""),m(null),await _()}catch(u){console.error("Rejection error:",u),N.error("거부 처리 실패")}finally{h(null)}},a=u=>{m(u),f(!0)},w=()=>{const u="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let F="VERIFY";for(let $=0;$<6;$++)F+=u.charAt(Math.floor(Math.random()*u.length));return F},S=u=>{m(u),n(w()),C(!0)},D=async()=>{if(!l||!x.trim()){N.error("인증 코드를 입력해주세요");return}h(l.verification_id);try{await new Promise(F=>setTimeout(F,1e3));const{error:u}=await p.from("account_verifications").update({status:"code_sent",verification_code_sent:x,code_sent_at:new Date().toISOString()}).eq("verification_id",l.verification_id);if(u)throw u;N.success(`인증 코드가 전송되었습니다: ${x}`),C(!1),n(""),m(null),await _()}catch(u){console.error("Code send error:",u),N.error("코드 전송 실패")}finally{h(null)}},B=async u=>{if(!(u.verification_code_sent===u.user_input_code)){N.error("인증 코드가 일치하지 않습니다");return}if(confirm(`${u.users?.username}의 계좌인증을 최종 승인하시겠습니까?
Smart Account가 자동으로 생성됩니다.`)){h(u.verification_id);try{N.info("⚡ Smart Account 생성 중...");const $=await gt({userId:u.user_id,username:u.users?.username||"Unknown",chainId:8453});N.success(`✅ Smart Account 생성 완료: ${$.address.slice(0,10)}...`);const{error:G}=await p.from("account_verifications").update({status:"verified",verified_at:new Date().toISOString(),code_verified:!0,smart_account_address:$.address,smart_account_chain_id:$.chainId}).eq("verification_id",u.verification_id);if(G)throw G;const{error:c}=await p.from("users").update({account_verification_status:"verified"}).eq("user_id",u.user_id);c&&console.error("User status update error:",c);const L=[{user_id:u.user_id,coin_type:"KRWQ",address:$.address,balance:0,status:"active"},{user_id:u.user_id,coin_type:"USDT",address:$.address,balance:0,status:"active"}],{error:R}=await p.from("wallets").insert(L);R&&console.error("Wallet creation error:",R),N.success("계좌인증 승인 및 지갑 생성 완료!"),await _()}catch($){console.error("Final approval error:",$),N.error(`승인 실패: ${$.message}`)}finally{h(null)}}},V=u=>{switch(u){case"verified":return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs bg-green-500/20 text-green-400 border border-green-500/30",children:"승인됨"});case"pending":return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs bg-yellow-500/20 text-yellow-400 border border-yellow-500/30",children:"대기중"});case"rejected":return e.jsx("span",{className:"px-3 py-1 rounded-full text-xs bg-red-500/20 text-red-400 border border-red-500/30",children:"거부됨"});default:return null}},P=t.filter(u=>g==="all"?!0:u.status===g),T={total:t.length,pending:t.filter(u=>u.status==="pending").length,verified:t.filter(u=>u.status==="verified").length,rejected:t.filter(u=>u.status==="rejected").length};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"로딩 중..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-white text-3xl mb-2",children:"계좌인증 관리"}),e.jsx("p",{className:"text-slate-400",children:"1원 계좌인증 요청을 검토하고 Smart Account를 생성합니다"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"전체"}),e.jsx(te,{className:"w-5 h-5 text-slate-400"})]}),e.jsx("div",{className:"text-white text-2xl",children:T.total})]}),e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-yellow-400 text-sm",children:"대기중"}),e.jsx(de,{className:"w-5 h-5 text-yellow-400"})]}),e.jsx("div",{className:"text-white text-2xl",children:T.pending})]}),e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-green-400 text-sm",children:"승인됨"}),e.jsx(se,{className:"w-5 h-5 text-green-400"})]}),e.jsx("div",{className:"text-white text-2xl",children:T.verified})]}),e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-red-400 text-sm",children:"거부됨"}),e.jsx(le,{className:"w-5 h-5 text-red-400"})]}),e.jsx("div",{className:"text-white text-2xl",children:T.rejected})]})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","code_sent","code_submitted","verified","rejected"].map(u=>e.jsx("button",{onClick:()=>j(u),className:`px-4 py-2 rounded-lg transition-all ${g===u?"bg-cyan-500 text-white":"bg-slate-800/50 text-slate-400 hover:bg-slate-700/50"}`,children:u==="all"?"전체":u==="pending"?"대기중":u==="code_sent"?"코드 전송됨":u==="code_submitted"?"코드 제출됨":u==="verified"?"승인됨":"거부됨"},u))}),e.jsx("div",{className:"space-y-4",children:P.length===0?e.jsx("div",{className:"bg-slate-800/30 border border-slate-700/50 rounded-xl p-12 text-center",children:e.jsx("p",{className:"text-slate-400",children:"표시할 인증 요청이 없습니다"})}):P.map(u=>e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 hover:border-cyan-500/50 rounded-xl p-6 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-white text-lg",children:u.users?.username}),V(u.status),u.smart_account_address&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-400",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsx("span",{children:"Smart Account"})]})]}),e.jsx("p",{className:"text-slate-400 text-sm",children:u.users?.email})]}),e.jsx("span",{className:"text-slate-500 text-sm",children:new Date(u.created_at).toLocaleString("ko-KR")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"은행"}),e.jsx("span",{className:"text-white",children:u.bank_name})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"계좌번호"}),e.jsx("span",{className:"text-white font-mono",children:u.account_number})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"예금주"}),e.jsx("span",{className:"text-white",children:u.account_holder})]}),u.verification_code&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"입금자명"}),e.jsx("span",{className:"text-cyan-400",children:u.verification_code})]})]}),u.smart_account_address&&e.jsxs("div",{className:"bg-slate-900/50 border border-cyan-500/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-cyan-400 text-sm",children:"Smart Account Address"})]}),e.jsx("p",{className:"text-slate-300 text-xs break-all font-mono",children:u.smart_account_address}),e.jsxs("p",{className:"text-slate-500 text-xs mt-1",children:["Chain ID: ",u.smart_account_chain_id||8453]})]})]}),u.rejection_reason&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"text-red-400 text-sm mb-1",children:"거부 사유:"}),e.jsx("p",{className:"text-slate-300 text-sm",children:u.rejection_reason})]}),u.status==="code_sent"&&e.jsxs("div",{className:"bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-cyan-400 text-sm",children:"인증 코드 전송됨"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"전송한 코드:"}),e.jsx("span",{className:"text-white font-mono",children:u.verification_code_sent})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"전송 시간:"}),e.jsx("span",{className:"text-white",children:u.code_sent_at?new Date(u.code_sent_at).toLocaleString("ko-KR"):"-"})]})]}),e.jsx("div",{className:"mt-3 text-xs text-cyan-300",children:"⏳ 사용자의 코드 입력을 기다리는 중입니다..."})]}),u.status==="code_submitted"&&e.jsxs("div",{className:`border rounded-lg p-3 mb-4 ${u.verification_code_sent===u.user_input_code?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:u.verification_code_sent===u.user_input_code?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-green-400 text-sm",children:"✅ 인증 코드 일치"})]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-red-400 text-sm",children:"❌ 인증 코드 불일치"})]})}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"전송한 코드:"}),e.jsx("span",{className:"text-white font-mono",children:u.verification_code_sent})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"사용자 입력:"}),e.jsx("span",{className:`font-mono ${u.verification_code_sent===u.user_input_code?"text-green-400":"text-red-400"}`,children:u.user_input_code})]})]})]}),u.status==="pending"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>S(u),disabled:o===u.verification_id,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-green-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),o===u.verification_id?"처리 중...":"인증 처리 (코드 전송)"]}),e.jsxs("button",{onClick:()=>a(u),disabled:o===u.verification_id,className:"flex-1 bg-gradient-to-r from-red-500 to-pink-600 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-red-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"거부"]})]}),u.status==="code_sent"&&e.jsxs("div",{className:"bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-center",children:[e.jsx(de,{className:"w-8 h-8 text-cyan-400 mx-auto mb-2"}),e.jsx("p",{className:"text-slate-300 text-sm",children:"사용자가 코드를 입력하면 자동으로 업데이트됩니다"})]}),u.status==="code_submitted"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>B(u),disabled:o===u.verification_id||u.verification_code_sent!==u.user_input_code,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-green-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),o===u.verification_id?"처리 중...":"최종 승인 및 Smart Account 생성"]}),e.jsxs("button",{onClick:()=>a(u),disabled:o===u.verification_id,className:"flex-1 bg-gradient-to-r from-red-500 to-pink-600 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-red-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"거부"]})]})]},u.verification_id))}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-red-500/30 rounded-2xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 border border-red-500/30 flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-lg",children:"계좌인증 거부"}),e.jsx("p",{className:"text-slate-400 text-sm",children:l?.users?.username})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"거부 사유"}),e.jsx("textarea",{value:y,onChange:u=>v(u.target.value),placeholder:"거부 사유를 입력하세요 (예: 계좌번호 불일치)",className:"w-full bg-slate-900/50 border border-red-500/30 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-red-500 transition-colors resize-none",rows:4})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{f(!1),v(""),m(null)},className:"flex-1 bg-slate-700 text-white py-3 rounded-lg hover:bg-slate-600 transition-colors",children:"취소"}),e.jsx("button",{onClick:I,disabled:!y.trim()||o!==null,className:"flex-1 bg-gradient-to-r from-red-500 to-pink-600 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-red-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?"처리 중...":"거부하기"})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 border border-cyan-500/30 rounded-2xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-lg",children:"인증 코드 전송"}),e.jsx("p",{className:"text-slate-400 text-sm",children:l?.users?.username})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"인증 코드"}),e.jsx("input",{value:x,readOnly:!0,className:"w-full bg-slate-900/50 border border-cyan-500/30 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500 transition-colors"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{C(!1),n(""),m(null)},className:"flex-1 bg-slate-700 text-white py-3 rounded-lg hover:bg-slate-600 transition-colors",children:"취소"}),e.jsx("button",{onClick:D,disabled:o!==null,className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-green-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:o?"처리 중...":"전송하기"})]})]})})]})}function ft(){const[t,s]=r.useState([]),[i,b]=r.useState(!0),[o,h]=r.useState(!1),[y,v]=r.useState(null);r.useEffect(()=>{k()},[]);const k=async()=>{try{const{data:d,error:C}=await p.from("gas_sponsorship_policies").select("*").order("user_level",{ascending:!1});if(C)throw C;s(d||[])}catch(d){console.error("Fetch error:",d),N.error("정책 로드 실패")}finally{b(!1)}},f=async d=>{h(!0);try{const{error:C}=await p.from("gas_sponsorship_policies").update({sponsor_mode:d.sponsor_mode,max_user_payment:d.max_user_payment,gas_token:d.gas_token,description:d.description,is_active:d.is_active}).eq("policy_id",d.policy_id);if(C)throw C;N.success("정책이 저장되었습니다"),v(null)}catch(C){console.error("Save error:",C),N.error("저장 실패"),await k()}finally{h(!1)}},l=async(d,C)=>{try{const{error:x}=await p.from("gas_sponsorship_policies").update({is_active:C}).eq("policy_id",d.policy_id);if(x)throw x;s(t.map(n=>n.policy_id===d.policy_id?{...n,is_active:C}:n)),N.success(C?"정책이 활성화되었습니다":"정책이 비활성화되었습니다")}catch(x){console.error("Toggle error:",x),N.error("상태 변경 실패"),await k()}},m=d=>{switch(d){case"VIP":return e.jsx(Ke,{className:"w-6 h-6 text-yellow-400"});case"Premium":return e.jsx(He,{className:"w-6 h-6 text-purple-400"});case"Standard":return e.jsx(Ls,{className:"w-6 h-6 text-cyan-400"});case"Basic":return e.jsx(qe,{className:"w-6 h-6 text-slate-400"});default:return null}},g=d=>{switch(d){case"VIP":return"from-yellow-500/20 to-orange-500/20 border-yellow-500/30";case"Premium":return"from-purple-500/20 to-pink-500/20 border-purple-500/30";case"Standard":return"from-cyan-500/20 to-blue-500/20 border-cyan-500/30";case"Basic":return"from-slate-500/20 to-slate-600/20 border-slate-500/30";default:return"from-slate-500/20 to-slate-600/20 border-slate-500/30"}},j=d=>{switch(d){case"operator":return"100% 운영자 부담";case"partial":return"부분 지원";case"user":return"100% 사용자 부담";default:return d}};return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"로딩 중..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-white text-3xl mb-2",children:"가스비 스폰서십 정책"}),e.jsx("p",{className:"text-slate-400",children:"사용자 레벨별 가스비 지원 정책을 설정합니다"})]}),e.jsx("div",{className:"bg-gradient-to-r from-cyan-500/10 to-purple-500/10 border border-cyan-500/30 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(be,{className:"w-5 h-5 text-cyan-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-cyan-400 mb-2",children:"가스비 스폰서십이란?"}),e.jsxs("ul",{className:"space-y-1 text-slate-300 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-400 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"100% 운영자 부담:"})," 사용자는 가스비를 전혀 지불하지 않음"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-400 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"부분 지원:"})," 사용자는 일정 금액까지만 부담, 초과분은 운영자가 부담"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-400 shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"100% 사용자 부담:"})," 사용자가 USDT 등 ERC-20 토큰으로 가스비 지불"]})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:"활성 정책"}),e.jsx(Y,{className:"w-5 h-5 text-cyan-400"})]}),e.jsxs("div",{className:"text-white text-2xl",children:[t.filter(d=>d.is_active).length," / ",t.length]})]}),e.jsxs("div",{className:"bg-green-500/10 border border-green-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-green-400 text-sm",children:"100% 스폰서"}),e.jsx(Ke,{className:"w-5 h-5 text-green-400"})]}),e.jsxs("div",{className:"text-white text-2xl",children:[t.filter(d=>d.sponsor_mode==="operator"&&d.is_active).length,"개"]})]}),e.jsxs("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-purple-400 text-sm",children:"부분 스폰서"}),e.jsx(He,{className:"w-5 h-5 text-purple-400"})]}),e.jsxs("div",{className:"text-white text-2xl",children:[t.filter(d=>d.sponsor_mode==="partial"&&d.is_active).length,"개"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.map(d=>e.jsxs("div",{className:`bg-gradient-to-br ${g(d.user_level)} border rounded-2xl p-6 transition-all hover:shadow-lg`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m(d.user_level),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white text-xl",children:d.user_level}),e.jsx("p",{className:"text-slate-400 text-sm",children:d.description})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d.is_active,onChange:C=>l(d,C.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-700 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-slate-300 text-sm",children:"활성"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"스폰서 모드"}),e.jsxs("select",{value:d.sponsor_mode,onChange:C=>{const x={...d,sponsor_mode:C.target.value,max_user_payment:C.target.value==="partial"?d.max_user_payment||1:null};s(t.map(n=>n.policy_id===d.policy_id?x:n)),v(x)},className:"w-full bg-slate-800/80 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-cyan-500 transition-colors",children:[e.jsx("option",{value:"operator",children:"100% 운영자 부담"}),e.jsx("option",{value:"partial",children:"부분 지원"}),e.jsx("option",{value:"user",children:"100% 사용자 부담"})]})]}),d.sponsor_mode==="partial"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-slate-300 mb-2 text-sm",children:["최대 사용자 부담액 (",d.gas_token,")"]}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:d.max_user_payment||0,onChange:C=>{const x={...d,max_user_payment:parseFloat(C.target.value)};s(t.map(n=>n.policy_id===d.policy_id?x:n)),v(x)},className:"w-full bg-slate-800/80 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-cyan-500 transition-colors"}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"초과분은 운영자가 부담합니다"})]}),d.sponsor_mode!=="operator"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"가스비 토큰"}),e.jsx("select",{value:d.gas_token,onChange:C=>{const x={...d,gas_token:C.target.value};s(t.map(n=>n.policy_id===d.policy_id?x:n)),v(x)},className:"w-full bg-slate-800/80 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-cyan-500 transition-colors",children:e.jsx("option",{value:"USDC",children:"USDC (Biconomy 지원)"})}),e.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"Biconomy는 USDC만 가스비 토큰으로 지원합니다"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2 text-sm",children:"설명"}),e.jsx("textarea",{value:d.description,onChange:C=>{const x={...d,description:C.target.value};s(t.map(n=>n.policy_id===d.policy_id?x:n)),v(x)},rows:2,className:"w-full bg-slate-800/80 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-cyan-500 transition-colors resize-none"})]}),y?.policy_id===d.policy_id&&e.jsxs("button",{onClick:()=>f(d),disabled:o,className:"w-full bg-gradient-to-r from-cyan-500 to-purple-500 text-white py-3 rounded-lg hover:shadow-lg hover:shadow-cyan-500/50 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(Us,{className:"w-5 h-5"}),o?"저장 중...":"저장하기"]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-slate-400",children:"현재 정책:"}),e.jsxs("span",{className:"text-white",children:[j(d.sponsor_mode),d.sponsor_mode==="partial"&&d.max_user_payment&&e.jsxs("span",{className:"text-cyan-400 ml-1",children:["(최대 ",d.max_user_payment," ",d.gas_token,")"]})]})]})})]},d.policy_id))}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-amber-400 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-400 mb-2",children:"주의사항"}),e.jsxs("ul",{className:"space-y-1 text-amber-300 text-sm",children:[e.jsx("li",{children:"• 정책 변경은 즉시 적용됩니다"}),e.jsx("li",{children:"• VIP/Premium 회원의 가스비는 운영자 부담이 권장됩니다"}),e.jsx("li",{children:"• 부분 지원 시 최대 부담액을 적절히 설정하세요"}),e.jsx("li",{children:"• 가스비 토큰은 사용자가 보유한 토큰으로 설정하세요"})]})]})]})})]})}function yt({activeTab:t,setActiveTab:s}){const i=[{id:"dashboard",label:"대시보드",icon:$s},{id:"users-wallets",label:"사용자 & 지갑",icon:qe},{id:"deposit-withdrawal",label:"구매 요청 관리",icon:Se},{id:"swaps",label:"스왑 관리",icon:ve},{id:"account-verifications",label:"계좌인증 관리",icon:se},{id:"coins",label:"코인 관리",icon:_e},{id:"gas-policy",label:"가스비 정책",icon:Y},{id:"security",label:"보안 모니터",icon:$e}];return e.jsx("aside",{className:"w-64 bg-slate-900/50 backdrop-blur-xl border-r border-cyan-500/20",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("button",{onClick:()=>{window.location.hash="#",window.location.reload()},className:"flex items-center gap-3 mb-8 group w-full hover:scale-105 transition-transform",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-800 border-2 border-cyan-500 flex items-center justify-center transition-all",style:{boxShadow:"0 0 15px rgba(6, 182, 212, 0.6), inset 0 0 15px rgba(6, 182, 212, 0.2)"},children:e.jsx(fe,{className:"w-6 h-6 text-cyan-400",style:{filter:"drop-shadow(0 0 3px rgba(6, 182, 212, 1))"}})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-cyan-400 group-hover:text-cyan-300 transition-colors",children:"GMS"}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Crypto Management"})]})]}),e.jsx("nav",{className:"space-y-2",children:i.map(b=>{const o=b.icon,h=t===b.id;return e.jsxs("button",{onClick:()=>s(b.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-300 ${h?"bg-cyan-500/20 border border-cyan-500/50 shadow-lg shadow-cyan-500/20 text-cyan-400":"text-slate-400 hover:bg-slate-800/50 hover:text-cyan-300 border border-transparent"}`,children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{children:b.label})]},b.id)})})]})})}const Nt={green:{text:"#22c55e",bg:"#22c55e",glow:"rgba(34, 197, 94, 0.6)",glowStrong:"rgba(34, 197, 94, 1)"},blue:{text:"#3b82f6",bg:"#3b82f6",glow:"rgba(59, 130, 246, 0.6)",glowStrong:"rgba(59, 130, 246, 1)"},purple:{text:"#a855f7",bg:"#a855f7",glow:"rgba(168, 85, 247, 0.6)",glowStrong:"rgba(168, 85, 247, 1)"}};function vt({notifications:t,onCategoryClick:s,selectedCategory:i,isAdmin:b=!1}){const[o,h]=r.useState(null),y=t.filter(l=>!l.read&&l.type==="signup").length,v=t.filter(l=>!l.read&&l.type.includes("verification")).length,k=t.filter(l=>!l.read&&l.type.includes("purchase")).length;r.useEffect(()=>{const l=t[0];if(l&&!l.read){l.type==="signup"?h("signup"):l.type.includes("verification")?h("verification"):l.type.includes("purchase")&&h("purchase");const m=setTimeout(()=>h(null),2e3);return()=>clearTimeout(m)}},[t]);const f=({icon:l,count:m,colorKey:g,category:j,label:d})=>{const C=o===j,x=i===j,n=Nt[g],_=m>0;return e.jsxs("button",{onClick:()=>s(x?null:j),className:`relative p-2 transition-all duration-200 ${C?"animate-bounce":""} ${x?"bg-slate-800/50 rounded-lg":""}`,"aria-label":d,style:{filter:_?`drop-shadow(0 0 5px ${n.glow})`:""},children:[e.jsx(l,{className:"w-5 h-5",style:{color:_||x?n.text:"#94a3b8"}}),m>0&&e.jsx("span",{className:`absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 text-white text-[10px] rounded-full flex items-center justify-center font-medium ${C?"animate-pulse":""}`,style:{backgroundColor:n.bg,boxShadow:C?`0 0 15px ${n.glowStrong}`:`0 0 10px ${n.glow}`},children:m>99?"99+":m})]})};return e.jsxs("div",{className:"flex items-center gap-1",children:[b&&e.jsx(f,{icon:as,count:y,colorKey:"green",category:"signup",label:"회원가입 알림"}),e.jsx(f,{icon:ts,count:v,colorKey:"blue",category:"verification",label:"1원인증 알림"}),e.jsx(f,{icon:Se,count:k,colorKey:"purple",category:"purchase",label:"구매요청 알림"})]})}function wt({onNavigate:t}){const{user:s,logout:i}=K(),[b,o]=r.useState([]),[h,y]=r.useState(!0),[v,k]=r.useState(null),{notifications:f}=Ge(s?.id,s?.role==="admin");r.useEffect(()=>{if(s?.id){l();const C=p.channel("wallet-balance-changes").on("postgres_changes",{event:"*",schema:"public",table:"wallets"},()=>l()).subscribe();return()=>{p.removeChannel(C)}}},[s?.id]);const l=async()=>{if(!s?.id)return;const{data:C}=await p.from("wallets").select("coin_type, balance, wallet_type").eq("user_id",s.id).order("balance",{ascending:!1});C&&o(C),y(!1)},m=()=>{i(),N.success("로그아웃되었습니다")},g=C=>{!t||!C||(C==="signup"?t("users-wallets"):C==="verification"?t("account-verifications"):C==="purchase"&&t("deposit-withdrawal"),k(null))},j=b.filter(C=>C.wallet_type==="hot").reduce((C,x)=>C+x.balance,0),d=b.filter(C=>C.wallet_type==="cold").reduce((C,x)=>C+x.balance,0);return e.jsxs("header",{className:"h-16 bg-slate-900/50 backdrop-blur-xl border-b border-cyan-500/20 flex items-center justify-between px-6",style:{position:"relative",zIndex:9999},children:[e.jsx("div",{className:"flex items-center gap-6",children:!h&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-orange-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Hot Wallet"}),e.jsx("p",{className:"text-sm text-orange-400 font-mono",children:j>0?`₩${j.toLocaleString()}`:"₩0"})]})]}),e.jsx("div",{className:"h-8 w-px bg-slate-700"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Cold Wallet"}),e.jsx("p",{className:"text-sm text-blue-400 font-mono",children:d>0?`₩${d.toLocaleString()}`:"₩0"})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[s?.id&&s.role==="admin"&&e.jsx(vt,{notifications:f,selectedCategory:v,onCategoryClick:g,isAdmin:!0}),s?.id&&e.jsx(os,{userId:s.id,isAdmin:s.role==="admin",categoryFilter:v}),e.jsx("div",{className:"h-8 w-px bg-slate-700"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-800 border-2 border-cyan-500 flex items-center justify-center",style:{boxShadow:"0 0 10px rgba(6, 182, 212, 0.6), inset 0 0 10px rgba(6, 182, 212, 0.2)"},children:e.jsx(Be,{className:"w-4 h-4 text-cyan-400",style:{filter:"drop-shadow(0 0 2px rgba(6, 182, 212, 1))"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-300",children:s?.username||"Admin"}),e.jsx("p",{className:"text-xs text-slate-500",children:"관리자"})]})]}),e.jsx("button",{onClick:m,className:"p-2 text-slate-400 hover:text-red-400 transition-colors",children:e.jsx(ss,{className:"w-5 h-5"})})]})]})}function _t(){const[t,s]=r.useState("dashboard");return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-cyan-500/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/5 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative flex h-screen",children:[e.jsx(yt,{activeTab:t,setActiveTab:s}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(wt,{onNavigate:s}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-6",children:[t==="dashboard"&&e.jsx(xt,{}),t==="users-wallets"&&e.jsx(ut,{}),t==="account-verifications"&&e.jsx(jt,{}),t==="gas-policy"&&e.jsx(ft,{}),t==="deposit-withdrawal"&&e.jsx(mt,{}),t==="swaps"&&e.jsx(pt,{}),t==="coins"&&e.jsx(bt,{}),t==="security"&&e.jsx(ht,{})]})]})]})]})}function St({onLoginSuccess:t}){const[s,i]=r.useState(""),[b,o]=r.useState(""),[h,y]=r.useState(!1),{login:v}=K(),k=async f=>{f.preventDefault(),y(!0);try{await v(s,b),N.success("로그인 성공"),t?.()}catch(l){N.error(l instanceof Error?l.message:"로그인 실패")}finally{y(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"relative w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center gap-3 mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-slate-800 border-2 border-cyan-500 flex items-center justify-center",style:{boxShadow:"0 0 20px rgba(6, 182, 212, 0.8), inset 0 0 20px rgba(6, 182, 212, 0.3)"},children:e.jsx(fe,{className:"w-8 h-8 text-cyan-400",style:{filter:"drop-shadow(0 0 5px rgba(6, 182, 212, 1))"}})})}),e.jsx("h1",{className:"text-cyan-400 text-2xl mb-2",children:"Admin Console"}),e.jsx("p",{className:"text-slate-400",children:"관리자 전용 페이지"})]}),e.jsx("div",{className:"bg-slate-900/50 backdrop-blur-xl border border-cyan-500/20 rounded-2xl p-8 shadow-2xl",children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"이메일"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"email",value:s,onChange:f=>i(f.target.value),className:"w-full bg-slate-800/50 border border-cyan-500/20 rounded-lg pl-12 pr-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"관리자 이메일",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-300 mb-2",children:"비밀번호"}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"password",value:b,onChange:f=>o(f.target.value),className:"w-full bg-slate-800/50 border border-cyan-500/20 rounded-lg pl-12 pr-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 focus:ring-2 focus:ring-cyan-500/20 transition-all",placeholder:"비밀번호",required:!0})]})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full bg-slate-900/50 border border-cyan-500 text-cyan-400 py-3 rounded-lg hover:bg-cyan-500/10 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:h?e.jsx("div",{className:"w-5 h-5 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-5 h-5"}),e.jsx("span",{children:"관리자 로그인"})]})})]})})]})]})}const Ct={async checkUsers(){console.log("🔍 Checking all users...");const{data:t,error:s}=await p.from("users").select("*");return s?console.error("❌ Error:",s):(console.log("✅ Users found:",t),console.table(t)),t},async findByEmail(t){console.log(`🔍 Looking for user: ${t}`);const{data:s,error:i}=await p.from("users").select("*").eq("email",t);return i?console.error("❌ Error:",i):!s||s.length===0?console.log("❌ User not found"):console.log("✅ User found:",s[0]),s},async createTestUser(t="hong@example.com",s="Hong"){console.log(`🔨 Creating test user: ${t}`);const i={username:s,email:t,password_hash:"password123",role:"user",kyc_status:"approved",status:"active"},{data:b,error:o}=await p.from("users").insert([i]).select();if(o){console.error("❌ Error creating user:",o),console.log("🔄 Trying to update existing user...");const{data:h,error:y}=await p.from("users").update({password_hash:"password123"}).eq("email",t).select();y?console.error("❌ Update error:",y):console.log("✅ User updated:",h)}else console.log("✅ User created:",b);return b},async createAdmin(t="admin@example.com",s="Admin"){console.log(`🔨 Creating admin: ${t}`);const i={username:s,email:t,password_hash:"password123",role:"admin",kyc_status:"approved",status:"active"},{data:b,error:o}=await p.from("users").insert([i]).select();if(o){console.error("❌ Error creating admin:",o),console.log("🔄 Trying to update existing admin...");const{data:h,error:y}=await p.from("users").update({password_hash:"password123",role:"admin"}).eq("email",t).select();y?console.error("❌ Update error:",y):console.log("✅ Admin updated:",h)}else console.log("✅ Admin created:",b);return b},async checkTableStructure(){console.log("🔍 Checking users table structure...");const{data:t,error:s}=await p.from("users").select("*").limit(1);return s?console.error("❌ Error:",s):t&&t.length>0?(console.log("✅ Table columns:",Object.keys(t[0])),console.log("Sample data:",t[0])):console.log("⚠️ Table is empty"),t}};typeof window<"u"&&(window.debugUsers=Ct);function kt(){const{user:t,isLoading:s}=K(),[i,b]=r.useState("user");return r.useEffect(()=>{const o=window.location.hash.slice(1);o.startsWith("admin/login")?b("admin-login"):o.startsWith("admin")?b("admin"):b("user");const h=()=>{const y=window.location.hash.slice(1);y.startsWith("admin/login")?b("admin-login"):y.startsWith("admin")?b("admin"):b("user")};return window.addEventListener("hashchange",h),()=>window.removeEventListener("hashchange",h)},[]),r.useEffect(()=>{i==="admin"&&!s&&(!t||t.role!=="admin")&&(b("admin-login"),window.location.hash="#admin/login",N.error("관리자 권한이 필요합니다"))},[i,t,s]),s?e.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center",children:e.jsx("div",{className:"text-cyan-400",children:"Loading..."})}):i==="admin-login"?e.jsx(St,{onLoginSuccess:()=>{b("admin"),window.location.hash="#admin"}}):i==="admin"?!t||t.role!=="admin"?(b("admin-login"),window.location.hash="#admin/login",null):e.jsx(_t,{}):e.jsx(ot,{})}function It(){return e.jsxs(Rs,{children:[e.jsx(kt,{}),e.jsx(hs,{position:"top-center",toastOptions:{style:{background:"rgb(15 23 42)",color:"rgb(148 163 184)",border:"1px solid rgba(6, 182, 212, 0.3)",boxShadow:"0 0 15px rgba(6, 182, 212, 0.2)"}}})]})}ds.createRoot(document.getElementById("root")).render(e.jsx(It,{}));
